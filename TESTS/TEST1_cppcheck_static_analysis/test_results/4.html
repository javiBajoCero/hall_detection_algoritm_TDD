
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - htmlREPORTcppcheck</title>
    <link rel="stylesheet" href="style.css">
    <style>
pre { line-height: 125%; margin: 0; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script>
      function getStyle(el, styleProp) {
        var y;

        if (el.currentStyle) {
          y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
          y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }

        return y;
      }

      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;

        if (el.style.display === "block") {
          el.style.display = "none";
          mark.textContent = "[+]";
        } else {
          el.style.display = "block";
          mark.textContent = "[-]";
        }
      }

      function initExpandables() {
        var elements = document.querySelectorAll(".expandable");

        for (var i = 0, len = elements.length; i < len; i++) {
          var el = elements[i];
          var clickable = el.querySelector("span");
          var marker = clickable.querySelector(".marker");
          var content = el.querySelector(".content");
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.addEventListener("click", toggle);
        }
      }

      function toggleDisplay(id) {
        var elements = document.querySelectorAll("." + id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("d-none");
        }
      }

      function toggleAll() {
        var elements = document.querySelectorAll("input");

        // starting from 1 since 0 is the "toggle all" input
        for (var i = 1, len = elements.length; i < len; i++) {
          var el = elements[i];

          if (el.checked) {
            el.checked = false;
          } else {
            el.checked = true;
          }

          toggleDisplay(el.id);
        }
      }
      window.addEventListener("load", initExpandables);
    </script>
  </head>
  <body>
    <div id="header" class="header">
      <h1>Cppcheck report - htmlREPORTcppcheck: target_code_to_be_tested/hall_detection_algoritm/Drivers/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_flash.c</h1>
    </div>
    <div class="wrapper">
      <div id="menu">
       <p id="filename"><a href="index.html">Defects:</a> stm32f4xx_hal_flash.c</p>
<a href="4.html#line-154"> unusedFunction 154</a><a href="4.html#line-212"> unusedFunction 212</a><a href="4.html#line-259"> unusedFunction 259</a><a href="4.html#line-261"> unreadVariable 261</a><a href="4.html#line-431"> unusedFunction 431</a><a href="4.html#line-455"> unusedFunction 455</a><a href="4.html#line-467"> unusedFunction 467</a><a href="4.html#line-487"> unusedFunction 487</a><a href="4.html#line-499"> unusedFunction 499</a><a href="4.html#line-536"> unusedFunction 536</a>
    </div>
    <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cm">/**</span>
<a name="line-2"></a><span class="cm">  ******************************************************************************</span>
<a name="line-3"></a><span class="cm">  * @file    stm32f4xx_hal_flash.c</span>
<a name="line-4"></a><span class="cm">  * @author  MCD Application Team</span>
<a name="line-5"></a><span class="cm">  * @brief   FLASH HAL module driver.</span>
<a name="line-6"></a><span class="cm">  *          This file provides firmware functions to manage the following </span>
<a name="line-7"></a><span class="cm">  *          functionalities of the internal FLASH memory:</span>
<a name="line-8"></a><span class="cm">  *           + Program operations functions</span>
<a name="line-9"></a><span class="cm">  *           + Memory Control functions </span>
<a name="line-10"></a><span class="cm">  *           + Peripheral Errors functions</span>
<a name="line-11"></a><span class="cm">  *         </span>
<a name="line-12"></a><span class="cm">  @verbatim</span>
<a name="line-13"></a><span class="cm">  ==============================================================================</span>
<a name="line-14"></a><span class="cm">                        ##### FLASH peripheral features #####</span>
<a name="line-15"></a><span class="cm">  ==============================================================================</span>
<a name="line-16"></a><span class="cm">           </span>
<a name="line-17"></a><span class="cm">  [..] The Flash memory interface manages CPU AHB I-Code and D-Code accesses </span>
<a name="line-18"></a><span class="cm">       to the Flash memory. It implements the erase and program Flash memory operations </span>
<a name="line-19"></a><span class="cm">       and the read and write protection mechanisms.</span>
<a name="line-20"></a><span class="cm">      </span>
<a name="line-21"></a><span class="cm">  [..] The Flash memory interface accelerates code execution with a system of instruction</span>
<a name="line-22"></a><span class="cm">       prefetch and cache lines. </span>
<a name="line-23"></a>
<a name="line-24"></a><span class="cm">  [..] The FLASH main features are:</span>
<a name="line-25"></a><span class="cm">      (+) Flash memory read operations</span>
<a name="line-26"></a><span class="cm">      (+) Flash memory program/erase operations</span>
<a name="line-27"></a><span class="cm">      (+) Read / write protections</span>
<a name="line-28"></a><span class="cm">      (+) Prefetch on I-Code</span>
<a name="line-29"></a><span class="cm">      (+) 64 cache lines of 128 bits on I-Code</span>
<a name="line-30"></a><span class="cm">      (+) 8 cache lines of 128 bits on D-Code</span>
<a name="line-31"></a><span class="cm">      </span>
<a name="line-32"></a><span class="cm">      </span>
<a name="line-33"></a><span class="cm">                     ##### How to use this driver #####</span>
<a name="line-34"></a><span class="cm">  ==============================================================================</span>
<a name="line-35"></a><span class="cm">    [..]                             </span>
<a name="line-36"></a><span class="cm">      This driver provides functions and macros to configure and program the FLASH </span>
<a name="line-37"></a><span class="cm">      memory of all STM32F4xx devices.</span>
<a name="line-38"></a><span class="cm">    </span>
<a name="line-39"></a><span class="cm">      (#) FLASH Memory IO Programming functions: </span>
<a name="line-40"></a><span class="cm">           (++) Lock and Unlock the FLASH interface using HAL_FLASH_Unlock() and </span>
<a name="line-41"></a><span class="cm">                HAL_FLASH_Lock() functions</span>
<a name="line-42"></a><span class="cm">           (++) Program functions: byte, half word, word and double word</span>
<a name="line-43"></a><span class="cm">           (++) There Two modes of programming :</span>
<a name="line-44"></a><span class="cm">            (+++) Polling mode using HAL_FLASH_Program() function</span>
<a name="line-45"></a><span class="cm">            (+++) Interrupt mode using HAL_FLASH_Program_IT() function</span>
<a name="line-46"></a><span class="cm">    </span>
<a name="line-47"></a><span class="cm">      (#) Interrupts and flags management functions : </span>
<a name="line-48"></a><span class="cm">           (++) Handle FLASH interrupts by calling HAL_FLASH_IRQHandler()</span>
<a name="line-49"></a><span class="cm">           (++) Wait for last FLASH operation according to its status</span>
<a name="line-50"></a><span class="cm">           (++) Get error flag status by calling HAL_SetErrorCode()          </span>
<a name="line-51"></a>
<a name="line-52"></a><span class="cm">    [..] </span>
<a name="line-53"></a><span class="cm">      In addition to these functions, this driver includes a set of macros allowing</span>
<a name="line-54"></a><span class="cm">      to handle the following operations:</span>
<a name="line-55"></a><span class="cm">       (+) Set the latency</span>
<a name="line-56"></a><span class="cm">       (+) Enable/Disable the prefetch buffer</span>
<a name="line-57"></a><span class="cm">       (+) Enable/Disable the Instruction cache and the Data cache</span>
<a name="line-58"></a><span class="cm">       (+) Reset the Instruction cache and the Data cache</span>
<a name="line-59"></a><span class="cm">       (+) Enable/Disable the FLASH interrupts</span>
<a name="line-60"></a><span class="cm">       (+) Monitor the FLASH flags status</span>
<a name="line-61"></a><span class="cm">          </span>
<a name="line-62"></a><span class="cm">  @endverbatim</span>
<a name="line-63"></a><span class="cm">  ******************************************************************************</span>
<a name="line-64"></a><span class="cm">  * @attention</span>
<a name="line-65"></a><span class="cm">  *</span>
<a name="line-66"></a><span class="cm">  * Copyright (c) 2017 STMicroelectronics.</span>
<a name="line-67"></a><span class="cm">  * All rights reserved.</span>
<a name="line-68"></a><span class="cm">  *</span>
<a name="line-69"></a><span class="cm">  * This software is licensed under terms that can be found in the LICENSE file in</span>
<a name="line-70"></a><span class="cm">  * the root directory of this software component.</span>
<a name="line-71"></a><span class="cm">  * If no LICENSE file comes with this software, it is provided AS-IS.</span>
<a name="line-72"></a><span class="cm">  ******************************************************************************</span>
<a name="line-73"></a><span class="cm">  */</span> 
<a name="line-74"></a>
<a name="line-75"></a><span class="cm">/* Includes ------------------------------------------------------------------*/</span>
<a name="line-76"></a><span class="cp">#include</span> <span class="cpf">&quot;stm32f4xx_hal.h&quot;</span><span class="cp"></span>
<a name="line-77"></a>
<a name="line-78"></a><span class="cm">/** @addtogroup STM32F4xx_HAL_Driver</span>
<a name="line-79"></a><span class="cm">  * @{</span>
<a name="line-80"></a><span class="cm">  */</span>
<a name="line-81"></a>
<a name="line-82"></a><span class="cm">/** @defgroup FLASH FLASH</span>
<a name="line-83"></a><span class="cm">  * @brief FLASH HAL module driver</span>
<a name="line-84"></a><span class="cm">  * @{</span>
<a name="line-85"></a><span class="cm">  */</span>
<a name="line-86"></a>
<a name="line-87"></a><span class="cp">#ifdef HAL_FLASH_MODULE_ENABLED</span>
<a name="line-88"></a>
<a name="line-89"></a><span class="cm">/* Private typedef -----------------------------------------------------------*/</span>
<a name="line-90"></a><span class="cm">/* Private define ------------------------------------------------------------*/</span>
<a name="line-91"></a><span class="cm">/** @addtogroup FLASH_Private_Constants</span>
<a name="line-92"></a><span class="cm">  * @{</span>
<a name="line-93"></a><span class="cm">  */</span>
<a name="line-94"></a><span class="cp">#define FLASH_TIMEOUT_VALUE       50000U </span><span class="cm">/* 50 s */</span><span class="cp"></span>
<a name="line-95"></a><span class="cm">/**</span>
<a name="line-96"></a><span class="cm">  * @}</span>
<a name="line-97"></a><span class="cm">  */</span>         
<a name="line-98"></a><span class="cm">/* Private macro -------------------------------------------------------------*/</span>
<a name="line-99"></a><span class="cm">/* Private variables ---------------------------------------------------------*/</span>
<a name="line-100"></a><span class="cm">/** @addtogroup FLASH_Private_Variables</span>
<a name="line-101"></a><span class="cm">  * @{</span>
<a name="line-102"></a><span class="cm">  */</span>
<a name="line-103"></a><span class="cm">/* Variable used for Erase sectors under interruption */</span>
<a name="line-104"></a><span class="n">FLASH_ProcessTypeDef</span> <span class="n">pFlash</span><span class="p">;</span>
<a name="line-105"></a><span class="cm">/**</span>
<a name="line-106"></a><span class="cm">  * @}</span>
<a name="line-107"></a><span class="cm">  */</span>
<a name="line-108"></a>
<a name="line-109"></a><span class="cm">/* Private function prototypes -----------------------------------------------*/</span>
<a name="line-110"></a><span class="cm">/** @addtogroup FLASH_Private_Functions</span>
<a name="line-111"></a><span class="cm">  * @{</span>
<a name="line-112"></a><span class="cm">  */</span>
<a name="line-113"></a><span class="cm">/* Program operations */</span>
<a name="line-114"></a><span class="k">static</span> <span class="kt">void</span>   <span class="n">FLASH_Program_DoubleWord</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-115"></a><span class="k">static</span> <span class="kt">void</span>   <span class="n">FLASH_Program_Word</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-116"></a><span class="k">static</span> <span class="kt">void</span>   <span class="n">FLASH_Program_HalfWord</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-117"></a><span class="k">static</span> <span class="kt">void</span>   <span class="n">FLASH_Program_Byte</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-118"></a><span class="k">static</span> <span class="kt">void</span>   <span class="n">FLASH_SetErrorCode</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="line-119"></a>
<a name="line-120"></a><span class="n">HAL_StatusTypeDef</span> <span class="nf">FLASH_WaitForLastOperation</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Timeout</span><span class="p">);</span>
<a name="line-121"></a><span class="cm">/**</span>
<a name="line-122"></a><span class="cm">  * @}</span>
<a name="line-123"></a><span class="cm">  */</span>
<a name="line-124"></a>
<a name="line-125"></a><span class="cm">/* Exported functions --------------------------------------------------------*/</span>
<a name="line-126"></a><span class="cm">/** @defgroup FLASH_Exported_Functions FLASH Exported Functions</span>
<a name="line-127"></a><span class="cm">  * @{</span>
<a name="line-128"></a><span class="cm">  */</span>
<a name="line-129"></a>  
<a name="line-130"></a><span class="cm">/** @defgroup FLASH_Exported_Functions_Group1 Programming operation functions </span>
<a name="line-131"></a><span class="cm"> *  @brief   Programming operation functions </span>
<a name="line-132"></a><span class="cm"> *</span>
<a name="line-133"></a><span class="cm">@verbatim   </span>
<a name="line-134"></a><span class="cm"> ===============================================================================</span>
<a name="line-135"></a><span class="cm">                  ##### Programming operation functions #####</span>
<a name="line-136"></a><span class="cm"> ===============================================================================  </span>
<a name="line-137"></a><span class="cm">    [..]</span>
<a name="line-138"></a><span class="cm">    This subsection provides a set of functions allowing to manage the FLASH </span>
<a name="line-139"></a><span class="cm">    program operations.</span>
<a name="line-140"></a>
<a name="line-141"></a><span class="cm">@endverbatim</span>
<a name="line-142"></a><span class="cm">  * @{</span>
<a name="line-143"></a><span class="cm">  */</span>
<a name="line-144"></a>
<a name="line-145"></a><span class="cm">/**</span>
<a name="line-146"></a><span class="cm">  * @brief  Program byte, halfword, word or double word at a specified address</span>
<a name="line-147"></a><span class="cm">  * @param  TypeProgram  Indicate the way to program at a specified address.</span>
<a name="line-148"></a><span class="cm">  *                           This parameter can be a value of @ref FLASH_Type_Program</span>
<a name="line-149"></a><span class="cm">  * @param  Address  specifies the address to be programmed.</span>
<a name="line-150"></a><span class="cm">  * @param  Data specifies the data to be programmed</span>
<a name="line-151"></a><span class="cm">  * </span>
<a name="line-152"></a><span class="cm">  * @retval HAL_StatusTypeDef HAL Status</span>
<a name="line-153"></a><span class="cm">  */</span>
<a name="line-154"></a><span class="hll"><span class="n">HAL_StatusTypeDef</span> <span class="nf">HAL_FLASH_Program</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">TypeProgram</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">Data</span><span class="p">)</span><span class="error2">&lt;--- The function 'HAL_FLASH_Program' is never used.</span>
</span><a name="line-155"></a><span class="p">{</span>
<a name="line-156"></a>  <span class="n">HAL_StatusTypeDef</span> <span class="n">status</span> <span class="o">=</span> <span class="n">HAL_ERROR</span><span class="p">;</span>
<a name="line-157"></a>  
<a name="line-158"></a>  <span class="cm">/* Process Locked */</span>
<a name="line-159"></a>  <span class="n">__HAL_LOCK</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pFlash</span><span class="p">);</span>
<a name="line-160"></a>  
<a name="line-161"></a>  <span class="cm">/* Check the parameters */</span>
<a name="line-162"></a>  <span class="n">assert_param</span><span class="p">(</span><span class="n">IS_FLASH_TYPEPROGRAM</span><span class="p">(</span><span class="n">TypeProgram</span><span class="p">));</span>
<a name="line-163"></a>  
<a name="line-164"></a>  <span class="cm">/* Wait for last operation to be completed */</span>
<a name="line-165"></a>  <span class="n">status</span> <span class="o">=</span> <span class="n">FLASH_WaitForLastOperation</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">FLASH_TIMEOUT_VALUE</span><span class="p">);</span>
<a name="line-166"></a>  
<a name="line-167"></a>  <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">HAL_OK</span><span class="p">)</span>
<a name="line-168"></a>  <span class="p">{</span>
<a name="line-169"></a>    <span class="k">if</span><span class="p">(</span><span class="n">TypeProgram</span> <span class="o">==</span> <span class="n">FLASH_TYPEPROGRAM_BYTE</span><span class="p">)</span>
<a name="line-170"></a>    <span class="p">{</span>
<a name="line-171"></a>      <span class="cm">/*Program byte (8-bit) at a specified address.*/</span>
<a name="line-172"></a>      <span class="n">FLASH_Program_Byte</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-173"></a>    <span class="p">}</span>
<a name="line-174"></a>    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">TypeProgram</span> <span class="o">==</span> <span class="n">FLASH_TYPEPROGRAM_HALFWORD</span><span class="p">)</span>
<a name="line-175"></a>    <span class="p">{</span>
<a name="line-176"></a>      <span class="cm">/*Program halfword (16-bit) at a specified address.*/</span>
<a name="line-177"></a>      <span class="n">FLASH_Program_HalfWord</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-178"></a>    <span class="p">}</span>
<a name="line-179"></a>    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">TypeProgram</span> <span class="o">==</span> <span class="n">FLASH_TYPEPROGRAM_WORD</span><span class="p">)</span>
<a name="line-180"></a>    <span class="p">{</span>
<a name="line-181"></a>      <span class="cm">/*Program word (32-bit) at a specified address.*/</span>
<a name="line-182"></a>      <span class="n">FLASH_Program_Word</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-183"></a>    <span class="p">}</span>
<a name="line-184"></a>    <span class="k">else</span>
<a name="line-185"></a>    <span class="p">{</span>
<a name="line-186"></a>      <span class="cm">/*Program double word (64-bit) at a specified address.*/</span>
<a name="line-187"></a>      <span class="n">FLASH_Program_DoubleWord</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-188"></a>    <span class="p">}</span>
<a name="line-189"></a>    
<a name="line-190"></a>    <span class="cm">/* Wait for last operation to be completed */</span>
<a name="line-191"></a>    <span class="n">status</span> <span class="o">=</span> <span class="n">FLASH_WaitForLastOperation</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">FLASH_TIMEOUT_VALUE</span><span class="p">);</span>
<a name="line-192"></a>    
<a name="line-193"></a>    <span class="cm">/* If the program operation is completed, disable the PG Bit */</span>
<a name="line-194"></a>    <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">FLASH_CR_PG</span><span class="p">);</span>  
<a name="line-195"></a>  <span class="p">}</span>
<a name="line-196"></a>  
<a name="line-197"></a>  <span class="cm">/* Process Unlocked */</span>
<a name="line-198"></a>  <span class="n">__HAL_UNLOCK</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pFlash</span><span class="p">);</span>
<a name="line-199"></a>  
<a name="line-200"></a>  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<a name="line-201"></a><span class="p">}</span>
<a name="line-202"></a>
<a name="line-203"></a><span class="cm">/**</span>
<a name="line-204"></a><span class="cm">  * @brief   Program byte, halfword, word or double word at a specified address  with interrupt enabled.</span>
<a name="line-205"></a><span class="cm">  * @param  TypeProgram  Indicate the way to program at a specified address.</span>
<a name="line-206"></a><span class="cm">  *                           This parameter can be a value of @ref FLASH_Type_Program</span>
<a name="line-207"></a><span class="cm">  * @param  Address  specifies the address to be programmed.</span>
<a name="line-208"></a><span class="cm">  * @param  Data specifies the data to be programmed</span>
<a name="line-209"></a><span class="cm">  * </span>
<a name="line-210"></a><span class="cm">  * @retval HAL Status</span>
<a name="line-211"></a><span class="cm">  */</span>
<a name="line-212"></a><span class="hll"><span class="n">HAL_StatusTypeDef</span> <span class="nf">HAL_FLASH_Program_IT</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">TypeProgram</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">Data</span><span class="p">)</span><span class="error2">&lt;--- The function 'HAL_FLASH_Program_IT' is never used.</span>
</span><a name="line-213"></a><span class="p">{</span>
<a name="line-214"></a>  <span class="n">HAL_StatusTypeDef</span> <span class="n">status</span> <span class="o">=</span> <span class="n">HAL_OK</span><span class="p">;</span>
<a name="line-215"></a>  
<a name="line-216"></a>  <span class="cm">/* Process Locked */</span>
<a name="line-217"></a>  <span class="n">__HAL_LOCK</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pFlash</span><span class="p">);</span>
<a name="line-218"></a>
<a name="line-219"></a>  <span class="cm">/* Check the parameters */</span>
<a name="line-220"></a>  <span class="n">assert_param</span><span class="p">(</span><span class="n">IS_FLASH_TYPEPROGRAM</span><span class="p">(</span><span class="n">TypeProgram</span><span class="p">));</span>
<a name="line-221"></a>
<a name="line-222"></a>  <span class="cm">/* Enable End of FLASH Operation interrupt */</span>
<a name="line-223"></a>  <span class="n">__HAL_FLASH_ENABLE_IT</span><span class="p">(</span><span class="n">FLASH_IT_EOP</span><span class="p">);</span>
<a name="line-224"></a>  
<a name="line-225"></a>  <span class="cm">/* Enable Error source interrupt */</span>
<a name="line-226"></a>  <span class="n">__HAL_FLASH_ENABLE_IT</span><span class="p">(</span><span class="n">FLASH_IT_ERR</span><span class="p">);</span>
<a name="line-227"></a>
<a name="line-228"></a>  <span class="n">pFlash</span><span class="p">.</span><span class="n">ProcedureOnGoing</span> <span class="o">=</span> <span class="n">FLASH_PROC_PROGRAM</span><span class="p">;</span>
<a name="line-229"></a>  <span class="n">pFlash</span><span class="p">.</span><span class="n">Address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">;</span>
<a name="line-230"></a>
<a name="line-231"></a>  <span class="k">if</span><span class="p">(</span><span class="n">TypeProgram</span> <span class="o">==</span> <span class="n">FLASH_TYPEPROGRAM_BYTE</span><span class="p">)</span>
<a name="line-232"></a>  <span class="p">{</span>
<a name="line-233"></a>    <span class="cm">/*Program byte (8-bit) at a specified address.*/</span>
<a name="line-234"></a>      <span class="n">FLASH_Program_Byte</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-235"></a>  <span class="p">}</span>
<a name="line-236"></a>  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">TypeProgram</span> <span class="o">==</span> <span class="n">FLASH_TYPEPROGRAM_HALFWORD</span><span class="p">)</span>
<a name="line-237"></a>  <span class="p">{</span>
<a name="line-238"></a>    <span class="cm">/*Program halfword (16-bit) at a specified address.*/</span>
<a name="line-239"></a>    <span class="n">FLASH_Program_HalfWord</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-240"></a>  <span class="p">}</span>
<a name="line-241"></a>  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">TypeProgram</span> <span class="o">==</span> <span class="n">FLASH_TYPEPROGRAM_WORD</span><span class="p">)</span>
<a name="line-242"></a>  <span class="p">{</span>
<a name="line-243"></a>    <span class="cm">/*Program word (32-bit) at a specified address.*/</span>
<a name="line-244"></a>    <span class="n">FLASH_Program_Word</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-245"></a>  <span class="p">}</span>
<a name="line-246"></a>  <span class="k">else</span>
<a name="line-247"></a>  <span class="p">{</span>
<a name="line-248"></a>    <span class="cm">/*Program double word (64-bit) at a specified address.*/</span>
<a name="line-249"></a>    <span class="n">FLASH_Program_DoubleWord</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="n">Data</span><span class="p">);</span>
<a name="line-250"></a>  <span class="p">}</span>
<a name="line-251"></a>
<a name="line-252"></a>  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<a name="line-253"></a><span class="p">}</span>
<a name="line-254"></a>
<a name="line-255"></a><span class="cm">/**</span>
<a name="line-256"></a><span class="cm">  * @brief This function handles FLASH interrupt request.</span>
<a name="line-257"></a><span class="cm">  * @retval None</span>
<a name="line-258"></a><span class="cm">  */</span>
<a name="line-259"></a><span class="hll"><span class="kt">void</span> <span class="nf">HAL_FLASH_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="error2">&lt;--- The function 'HAL_FLASH_IRQHandler' is never used.</span>
</span><a name="line-260"></a><span class="p">{</span>
<a name="line-261"></a><span class="hll">  <span class="kt">uint32_t</span> <span class="n">addresstmp</span> <span class="o">=</span> <span class="mi">0U</span><span class="p">;</span><span class="error2">&lt;--- Variable 'addresstmp' is assigned a value that is never used.</span>
</span><a name="line-262"></a>  
<a name="line-263"></a>  <span class="cm">/* Check FLASH operation error flags */</span>
<a name="line-264"></a><span class="cp">#if defined(FLASH_SR_RDERR) </span>
<a name="line-265"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">((</span><span class="n">FLASH_FLAG_OPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_WRPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_PGAERR</span> <span class="o">|</span> \
<a name="line-266"></a>    <span class="n">FLASH_FLAG_PGPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_PGSERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_RDERR</span><span class="p">))</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-267"></a><span class="cp">#else</span>
<a name="line-268"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">((</span><span class="n">FLASH_FLAG_OPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_WRPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_PGAERR</span> <span class="o">|</span> \
<a name="line-269"></a>    <span class="n">FLASH_FLAG_PGPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_PGSERR</span><span class="p">))</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-270"></a><span class="cp">#endif </span><span class="cm">/* FLASH_SR_RDERR */</span><span class="cp"></span>
<a name="line-271"></a>  <span class="p">{</span>
<a name="line-272"></a>    <span class="k">if</span><span class="p">(</span><span class="n">pFlash</span><span class="p">.</span><span class="n">ProcedureOnGoing</span> <span class="o">==</span> <span class="n">FLASH_PROC_SECTERASE</span><span class="p">)</span>
<a name="line-273"></a>    <span class="p">{</span>
<a name="line-274"></a>      <span class="cm">/*return the faulty sector*/</span>
<a name="line-275"></a>      <span class="n">addresstmp</span> <span class="o">=</span> <span class="n">pFlash</span><span class="p">.</span><span class="n">Sector</span><span class="p">;</span>
<a name="line-276"></a>      <span class="n">pFlash</span><span class="p">.</span><span class="n">Sector</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFU</span><span class="p">;</span>
<a name="line-277"></a>    <span class="p">}</span>
<a name="line-278"></a>    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">pFlash</span><span class="p">.</span><span class="n">ProcedureOnGoing</span> <span class="o">==</span> <span class="n">FLASH_PROC_MASSERASE</span><span class="p">)</span>
<a name="line-279"></a>    <span class="p">{</span>
<a name="line-280"></a>      <span class="cm">/*return the faulty bank*/</span>
<a name="line-281"></a>      <span class="n">addresstmp</span> <span class="o">=</span> <span class="n">pFlash</span><span class="p">.</span><span class="n">Bank</span><span class="p">;</span>
<a name="line-282"></a>    <span class="p">}</span>
<a name="line-283"></a>    <span class="k">else</span>
<a name="line-284"></a>    <span class="p">{</span>
<a name="line-285"></a>      <span class="cm">/*return the faulty address*/</span>
<a name="line-286"></a>      <span class="n">addresstmp</span> <span class="o">=</span> <span class="n">pFlash</span><span class="p">.</span><span class="n">Address</span><span class="p">;</span>
<a name="line-287"></a>    <span class="p">}</span>
<a name="line-288"></a>    
<a name="line-289"></a>    <span class="cm">/*Save the Error code*/</span>
<a name="line-290"></a>    <span class="n">FLASH_SetErrorCode</span><span class="p">();</span>
<a name="line-291"></a>    
<a name="line-292"></a>    <span class="cm">/* FLASH error interrupt user callback */</span>
<a name="line-293"></a>    <span class="n">HAL_FLASH_OperationErrorCallback</span><span class="p">(</span><span class="n">addresstmp</span><span class="p">);</span>
<a name="line-294"></a>    
<a name="line-295"></a>    <span class="cm">/*Stop the procedure ongoing*/</span>
<a name="line-296"></a>    <span class="n">pFlash</span><span class="p">.</span><span class="n">ProcedureOnGoing</span> <span class="o">=</span> <span class="n">FLASH_PROC_NONE</span><span class="p">;</span>
<a name="line-297"></a>  <span class="p">}</span>
<a name="line-298"></a>  
<a name="line-299"></a>  <span class="cm">/* Check FLASH End of Operation flag  */</span>
<a name="line-300"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_EOP</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-301"></a>  <span class="p">{</span>
<a name="line-302"></a>    <span class="cm">/* Clear FLASH End of Operation pending bit */</span>
<a name="line-303"></a>    <span class="n">__HAL_FLASH_CLEAR_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_EOP</span><span class="p">);</span>
<a name="line-304"></a>    
<a name="line-305"></a>    <span class="k">if</span><span class="p">(</span><span class="n">pFlash</span><span class="p">.</span><span class="n">ProcedureOnGoing</span> <span class="o">==</span> <span class="n">FLASH_PROC_SECTERASE</span><span class="p">)</span>
<a name="line-306"></a>    <span class="p">{</span>
<a name="line-307"></a>      <span class="cm">/*Nb of sector to erased can be decreased*/</span>
<a name="line-308"></a>      <span class="n">pFlash</span><span class="p">.</span><span class="n">NbSectorsToErase</span><span class="o">--</span><span class="p">;</span>
<a name="line-309"></a>      
<a name="line-310"></a>      <span class="cm">/* Check if there are still sectors to erase*/</span>
<a name="line-311"></a>      <span class="k">if</span><span class="p">(</span><span class="n">pFlash</span><span class="p">.</span><span class="n">NbSectorsToErase</span> <span class="o">!=</span> <span class="mi">0U</span><span class="p">)</span>
<a name="line-312"></a>      <span class="p">{</span>
<a name="line-313"></a>        <span class="n">addresstmp</span> <span class="o">=</span> <span class="n">pFlash</span><span class="p">.</span><span class="n">Sector</span><span class="p">;</span>
<a name="line-314"></a>        <span class="cm">/*Indicate user which sector has been erased*/</span>
<a name="line-315"></a>        <span class="n">HAL_FLASH_EndOfOperationCallback</span><span class="p">(</span><span class="n">addresstmp</span><span class="p">);</span>
<a name="line-316"></a>        
<a name="line-317"></a>        <span class="cm">/*Increment sector number*/</span>
<a name="line-318"></a>        <span class="n">pFlash</span><span class="p">.</span><span class="n">Sector</span><span class="o">++</span><span class="p">;</span>
<a name="line-319"></a>        <span class="n">addresstmp</span> <span class="o">=</span> <span class="n">pFlash</span><span class="p">.</span><span class="n">Sector</span><span class="p">;</span>
<a name="line-320"></a>        <span class="n">FLASH_Erase_Sector</span><span class="p">(</span><span class="n">addresstmp</span><span class="p">,</span> <span class="n">pFlash</span><span class="p">.</span><span class="n">VoltageForErase</span><span class="p">);</span>
<a name="line-321"></a>      <span class="p">}</span>
<a name="line-322"></a>      <span class="k">else</span>
<a name="line-323"></a>      <span class="p">{</span>
<a name="line-324"></a>        <span class="cm">/*No more sectors to Erase, user callback can be called.*/</span>
<a name="line-325"></a>        <span class="cm">/*Reset Sector and stop Erase sectors procedure*/</span>
<a name="line-326"></a>        <span class="n">pFlash</span><span class="p">.</span><span class="n">Sector</span> <span class="o">=</span> <span class="n">addresstmp</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFU</span><span class="p">;</span>
<a name="line-327"></a>        <span class="n">pFlash</span><span class="p">.</span><span class="n">ProcedureOnGoing</span> <span class="o">=</span> <span class="n">FLASH_PROC_NONE</span><span class="p">;</span>
<a name="line-328"></a>        
<a name="line-329"></a>        <span class="cm">/* Flush the caches to be sure of the data consistency */</span>
<a name="line-330"></a>        <span class="n">FLASH_FlushCaches</span><span class="p">()</span> <span class="p">;</span>
<a name="line-331"></a>                
<a name="line-332"></a>        <span class="cm">/* FLASH EOP interrupt user callback */</span>
<a name="line-333"></a>        <span class="n">HAL_FLASH_EndOfOperationCallback</span><span class="p">(</span><span class="n">addresstmp</span><span class="p">);</span>
<a name="line-334"></a>      <span class="p">}</span>
<a name="line-335"></a>    <span class="p">}</span>
<a name="line-336"></a>    <span class="k">else</span> 
<a name="line-337"></a>    <span class="p">{</span>
<a name="line-338"></a>      <span class="k">if</span><span class="p">(</span><span class="n">pFlash</span><span class="p">.</span><span class="n">ProcedureOnGoing</span> <span class="o">==</span> <span class="n">FLASH_PROC_MASSERASE</span><span class="p">)</span> 
<a name="line-339"></a>      <span class="p">{</span>
<a name="line-340"></a>        <span class="cm">/* MassErase ended. Return the selected bank */</span>
<a name="line-341"></a>        <span class="cm">/* Flush the caches to be sure of the data consistency */</span>
<a name="line-342"></a>        <span class="n">FLASH_FlushCaches</span><span class="p">()</span> <span class="p">;</span>
<a name="line-343"></a>
<a name="line-344"></a>        <span class="cm">/* FLASH EOP interrupt user callback */</span>
<a name="line-345"></a>        <span class="n">HAL_FLASH_EndOfOperationCallback</span><span class="p">(</span><span class="n">pFlash</span><span class="p">.</span><span class="n">Bank</span><span class="p">);</span>
<a name="line-346"></a>      <span class="p">}</span>
<a name="line-347"></a>      <span class="k">else</span>
<a name="line-348"></a>      <span class="p">{</span>
<a name="line-349"></a>        <span class="cm">/*Program ended. Return the selected address*/</span>
<a name="line-350"></a>        <span class="cm">/* FLASH EOP interrupt user callback */</span>
<a name="line-351"></a>        <span class="n">HAL_FLASH_EndOfOperationCallback</span><span class="p">(</span><span class="n">pFlash</span><span class="p">.</span><span class="n">Address</span><span class="p">);</span>
<a name="line-352"></a>      <span class="p">}</span>
<a name="line-353"></a>      <span class="n">pFlash</span><span class="p">.</span><span class="n">ProcedureOnGoing</span> <span class="o">=</span> <span class="n">FLASH_PROC_NONE</span><span class="p">;</span>
<a name="line-354"></a>    <span class="p">}</span>
<a name="line-355"></a>  <span class="p">}</span>
<a name="line-356"></a>  
<a name="line-357"></a>  <span class="k">if</span><span class="p">(</span><span class="n">pFlash</span><span class="p">.</span><span class="n">ProcedureOnGoing</span> <span class="o">==</span> <span class="n">FLASH_PROC_NONE</span><span class="p">)</span>
<a name="line-358"></a>  <span class="p">{</span>
<a name="line-359"></a>    <span class="cm">/* Operation is completed, disable the PG, SER, SNB and MER Bits */</span>
<a name="line-360"></a>    <span class="n">CLEAR_BIT</span><span class="p">(</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">,</span> <span class="p">(</span><span class="n">FLASH_CR_PG</span> <span class="o">|</span> <span class="n">FLASH_CR_SER</span> <span class="o">|</span> <span class="n">FLASH_CR_SNB</span> <span class="o">|</span> <span class="n">FLASH_MER_BIT</span><span class="p">));</span>
<a name="line-361"></a>
<a name="line-362"></a>    <span class="cm">/* Disable End of FLASH Operation interrupt */</span>
<a name="line-363"></a>    <span class="n">__HAL_FLASH_DISABLE_IT</span><span class="p">(</span><span class="n">FLASH_IT_EOP</span><span class="p">);</span>
<a name="line-364"></a>    
<a name="line-365"></a>    <span class="cm">/* Disable Error source interrupt */</span>
<a name="line-366"></a>    <span class="n">__HAL_FLASH_DISABLE_IT</span><span class="p">(</span><span class="n">FLASH_IT_ERR</span><span class="p">);</span>
<a name="line-367"></a>    
<a name="line-368"></a>    <span class="cm">/* Process Unlocked */</span>
<a name="line-369"></a>    <span class="n">__HAL_UNLOCK</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pFlash</span><span class="p">);</span>
<a name="line-370"></a>  <span class="p">}</span>
<a name="line-371"></a><span class="p">}</span>
<a name="line-372"></a>
<a name="line-373"></a><span class="cm">/**</span>
<a name="line-374"></a><span class="cm">  * @brief  FLASH end of operation interrupt callback</span>
<a name="line-375"></a><span class="cm">  * @param  ReturnValue The value saved in this parameter depends on the ongoing procedure</span>
<a name="line-376"></a><span class="cm">  *                  Mass Erase: Bank number which has been requested to erase</span>
<a name="line-377"></a><span class="cm">  *                  Sectors Erase: Sector which has been erased </span>
<a name="line-378"></a><span class="cm">  *                    (if 0xFFFFFFFFU, it means that all the selected sectors have been erased)</span>
<a name="line-379"></a><span class="cm">  *                  Program: Address which was selected for data program</span>
<a name="line-380"></a><span class="cm">  * @retval None</span>
<a name="line-381"></a><span class="cm">  */</span>
<a name="line-382"></a><span class="n">__weak</span> <span class="kt">void</span> <span class="n">HAL_FLASH_EndOfOperationCallback</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">ReturnValue</span><span class="p">)</span>
<a name="line-383"></a><span class="p">{</span>
<a name="line-384"></a>  <span class="cm">/* Prevent unused argument(s) compilation warning */</span>
<a name="line-385"></a>  <span class="n">UNUSED</span><span class="p">(</span><span class="n">ReturnValue</span><span class="p">);</span>
<a name="line-386"></a>  <span class="cm">/* NOTE : This function Should not be modified, when the callback is needed,</span>
<a name="line-387"></a><span class="cm">            the HAL_FLASH_EndOfOperationCallback could be implemented in the user file</span>
<a name="line-388"></a><span class="cm">   */</span> 
<a name="line-389"></a><span class="p">}</span>
<a name="line-390"></a>
<a name="line-391"></a><span class="cm">/**</span>
<a name="line-392"></a><span class="cm">  * @brief  FLASH operation error interrupt callback</span>
<a name="line-393"></a><span class="cm">  * @param  ReturnValue The value saved in this parameter depends on the ongoing procedure</span>
<a name="line-394"></a><span class="cm">  *                 Mass Erase: Bank number which has been requested to erase</span>
<a name="line-395"></a><span class="cm">  *                 Sectors Erase: Sector number which returned an error</span>
<a name="line-396"></a><span class="cm">  *                 Program: Address which was selected for data program</span>
<a name="line-397"></a><span class="cm">  * @retval None</span>
<a name="line-398"></a><span class="cm">  */</span>
<a name="line-399"></a><span class="n">__weak</span> <span class="kt">void</span> <span class="n">HAL_FLASH_OperationErrorCallback</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">ReturnValue</span><span class="p">)</span>
<a name="line-400"></a><span class="p">{</span>
<a name="line-401"></a>  <span class="cm">/* Prevent unused argument(s) compilation warning */</span>
<a name="line-402"></a>  <span class="n">UNUSED</span><span class="p">(</span><span class="n">ReturnValue</span><span class="p">);</span>
<a name="line-403"></a>  <span class="cm">/* NOTE : This function Should not be modified, when the callback is needed,</span>
<a name="line-404"></a><span class="cm">            the HAL_FLASH_OperationErrorCallback could be implemented in the user file</span>
<a name="line-405"></a><span class="cm">   */</span> 
<a name="line-406"></a><span class="p">}</span>
<a name="line-407"></a>
<a name="line-408"></a><span class="cm">/**</span>
<a name="line-409"></a><span class="cm">  * @}</span>
<a name="line-410"></a><span class="cm">  */</span>
<a name="line-411"></a>
<a name="line-412"></a><span class="cm">/** @defgroup FLASH_Exported_Functions_Group2 Peripheral Control functions </span>
<a name="line-413"></a><span class="cm"> *  @brief   management functions </span>
<a name="line-414"></a><span class="cm"> *</span>
<a name="line-415"></a><span class="cm">@verbatim   </span>
<a name="line-416"></a><span class="cm"> ===============================================================================</span>
<a name="line-417"></a><span class="cm">                      ##### Peripheral Control functions #####</span>
<a name="line-418"></a><span class="cm"> ===============================================================================  </span>
<a name="line-419"></a><span class="cm">    [..]</span>
<a name="line-420"></a><span class="cm">    This subsection provides a set of functions allowing to control the FLASH </span>
<a name="line-421"></a><span class="cm">    memory operations.</span>
<a name="line-422"></a>
<a name="line-423"></a><span class="cm">@endverbatim</span>
<a name="line-424"></a><span class="cm">  * @{</span>
<a name="line-425"></a><span class="cm">  */</span>
<a name="line-426"></a>
<a name="line-427"></a><span class="cm">/**</span>
<a name="line-428"></a><span class="cm">  * @brief  Unlock the FLASH control register access</span>
<a name="line-429"></a><span class="cm">  * @retval HAL Status</span>
<a name="line-430"></a><span class="cm">  */</span>
<a name="line-431"></a><span class="hll"><span class="n">HAL_StatusTypeDef</span> <span class="n">HAL_FLASH_Unlock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="error2">&lt;--- The function 'HAL_FLASH_Unlock' is never used.</span>
</span><a name="line-432"></a><span class="p">{</span>
<a name="line-433"></a>  <span class="n">HAL_StatusTypeDef</span> <span class="n">status</span> <span class="o">=</span> <span class="n">HAL_OK</span><span class="p">;</span>
<a name="line-434"></a>
<a name="line-435"></a>  <span class="k">if</span><span class="p">(</span><span class="n">READ_BIT</span><span class="p">(</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">,</span> <span class="n">FLASH_CR_LOCK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-436"></a>  <span class="p">{</span>
<a name="line-437"></a>    <span class="cm">/* Authorize the FLASH Registers access */</span>
<a name="line-438"></a>    <span class="n">WRITE_REG</span><span class="p">(</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">KEYR</span><span class="p">,</span> <span class="n">FLASH_KEY1</span><span class="p">);</span>
<a name="line-439"></a>    <span class="n">WRITE_REG</span><span class="p">(</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">KEYR</span><span class="p">,</span> <span class="n">FLASH_KEY2</span><span class="p">);</span>
<a name="line-440"></a>
<a name="line-441"></a>    <span class="cm">/* Verify Flash is unlocked */</span>
<a name="line-442"></a>    <span class="k">if</span><span class="p">(</span><span class="n">READ_BIT</span><span class="p">(</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">,</span> <span class="n">FLASH_CR_LOCK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-443"></a>    <span class="p">{</span>
<a name="line-444"></a>      <span class="n">status</span> <span class="o">=</span> <span class="n">HAL_ERROR</span><span class="p">;</span>
<a name="line-445"></a>    <span class="p">}</span>
<a name="line-446"></a>  <span class="p">}</span>
<a name="line-447"></a>
<a name="line-448"></a>  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<a name="line-449"></a><span class="p">}</span>
<a name="line-450"></a>
<a name="line-451"></a><span class="cm">/**</span>
<a name="line-452"></a><span class="cm">  * @brief  Locks the FLASH control register access</span>
<a name="line-453"></a><span class="cm">  * @retval HAL Status</span>
<a name="line-454"></a><span class="cm">  */</span>
<a name="line-455"></a><span class="hll"><span class="n">HAL_StatusTypeDef</span> <span class="n">HAL_FLASH_Lock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="error2">&lt;--- The function 'HAL_FLASH_Lock' is never used.</span>
</span><a name="line-456"></a><span class="p">{</span>
<a name="line-457"></a>  <span class="cm">/* Set the LOCK Bit to lock the FLASH Registers access */</span>
<a name="line-458"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">|=</span> <span class="n">FLASH_CR_LOCK</span><span class="p">;</span>
<a name="line-459"></a>  
<a name="line-460"></a>  <span class="k">return</span> <span class="n">HAL_OK</span><span class="p">;</span>  
<a name="line-461"></a><span class="p">}</span>
<a name="line-462"></a>
<a name="line-463"></a><span class="cm">/**</span>
<a name="line-464"></a><span class="cm">  * @brief  Unlock the FLASH Option Control Registers access.</span>
<a name="line-465"></a><span class="cm">  * @retval HAL Status</span>
<a name="line-466"></a><span class="cm">  */</span>
<a name="line-467"></a><span class="hll"><span class="n">HAL_StatusTypeDef</span> <span class="n">HAL_FLASH_OB_Unlock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="error2">&lt;--- The function 'HAL_FLASH_OB_Unlock' is never used.</span>
</span><a name="line-468"></a><span class="p">{</span>
<a name="line-469"></a>  <span class="k">if</span><span class="p">((</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">OPTCR</span> <span class="o">&amp;</span> <span class="n">FLASH_OPTCR_OPTLOCK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-470"></a>  <span class="p">{</span>
<a name="line-471"></a>    <span class="cm">/* Authorizes the Option Byte register programming */</span>
<a name="line-472"></a>    <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">OPTKEYR</span> <span class="o">=</span> <span class="n">FLASH_OPT_KEY1</span><span class="p">;</span>
<a name="line-473"></a>    <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">OPTKEYR</span> <span class="o">=</span> <span class="n">FLASH_OPT_KEY2</span><span class="p">;</span>
<a name="line-474"></a>  <span class="p">}</span>
<a name="line-475"></a>  <span class="k">else</span>
<a name="line-476"></a>  <span class="p">{</span>
<a name="line-477"></a>    <span class="k">return</span> <span class="n">HAL_ERROR</span><span class="p">;</span>
<a name="line-478"></a>  <span class="p">}</span>  
<a name="line-479"></a>  
<a name="line-480"></a>  <span class="k">return</span> <span class="n">HAL_OK</span><span class="p">;</span>  
<a name="line-481"></a><span class="p">}</span>
<a name="line-482"></a>
<a name="line-483"></a><span class="cm">/**</span>
<a name="line-484"></a><span class="cm">  * @brief  Lock the FLASH Option Control Registers access.</span>
<a name="line-485"></a><span class="cm">  * @retval HAL Status </span>
<a name="line-486"></a><span class="cm">  */</span>
<a name="line-487"></a><span class="hll"><span class="n">HAL_StatusTypeDef</span> <span class="n">HAL_FLASH_OB_Lock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="error2">&lt;--- The function 'HAL_FLASH_OB_Lock' is never used.</span>
</span><a name="line-488"></a><span class="p">{</span>
<a name="line-489"></a>  <span class="cm">/* Set the OPTLOCK Bit to lock the FLASH Option Byte Registers access */</span>
<a name="line-490"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">OPTCR</span> <span class="o">|=</span> <span class="n">FLASH_OPTCR_OPTLOCK</span><span class="p">;</span>
<a name="line-491"></a>  
<a name="line-492"></a>  <span class="k">return</span> <span class="n">HAL_OK</span><span class="p">;</span>  
<a name="line-493"></a><span class="p">}</span>
<a name="line-494"></a>
<a name="line-495"></a><span class="cm">/**</span>
<a name="line-496"></a><span class="cm">  * @brief  Launch the option byte loading.</span>
<a name="line-497"></a><span class="cm">  * @retval HAL Status</span>
<a name="line-498"></a><span class="cm">  */</span>
<a name="line-499"></a><span class="hll"><span class="n">HAL_StatusTypeDef</span> <span class="n">HAL_FLASH_OB_Launch</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="error2">&lt;--- The function 'HAL_FLASH_OB_Launch' is never used.</span>
</span><a name="line-500"></a><span class="p">{</span>
<a name="line-501"></a>  <span class="cm">/* Set the OPTSTRT bit in OPTCR register */</span>
<a name="line-502"></a>  <span class="o">*</span><span class="p">(</span><span class="n">__IO</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span><span class="n">OPTCR_BYTE0_ADDRESS</span> <span class="o">|=</span> <span class="n">FLASH_OPTCR_OPTSTRT</span><span class="p">;</span>
<a name="line-503"></a>
<a name="line-504"></a>  <span class="cm">/* Wait for last operation to be completed */</span>
<a name="line-505"></a>  <span class="k">return</span><span class="p">(</span><span class="n">FLASH_WaitForLastOperation</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">FLASH_TIMEOUT_VALUE</span><span class="p">));</span> 
<a name="line-506"></a><span class="p">}</span>
<a name="line-507"></a>
<a name="line-508"></a><span class="cm">/**</span>
<a name="line-509"></a><span class="cm">  * @}</span>
<a name="line-510"></a><span class="cm">  */</span>
<a name="line-511"></a>
<a name="line-512"></a><span class="cm">/** @defgroup FLASH_Exported_Functions_Group3 Peripheral State and Errors functions </span>
<a name="line-513"></a><span class="cm"> *  @brief   Peripheral Errors functions </span>
<a name="line-514"></a><span class="cm"> *</span>
<a name="line-515"></a><span class="cm">@verbatim   </span>
<a name="line-516"></a><span class="cm"> ===============================================================================</span>
<a name="line-517"></a><span class="cm">                ##### Peripheral Errors functions #####</span>
<a name="line-518"></a><span class="cm"> ===============================================================================  </span>
<a name="line-519"></a><span class="cm">    [..]</span>
<a name="line-520"></a><span class="cm">    This subsection permits to get in run-time Errors of the FLASH peripheral.</span>
<a name="line-521"></a>
<a name="line-522"></a><span class="cm">@endverbatim</span>
<a name="line-523"></a><span class="cm">  * @{</span>
<a name="line-524"></a><span class="cm">  */</span>
<a name="line-525"></a>
<a name="line-526"></a><span class="cm">/**</span>
<a name="line-527"></a><span class="cm">  * @brief  Get the specific FLASH error flag.</span>
<a name="line-528"></a><span class="cm">  * @retval FLASH_ErrorCode: The returned value can be a combination of:</span>
<a name="line-529"></a><span class="cm">  *            @arg HAL_FLASH_ERROR_RD: FLASH Read Protection error flag (PCROP)</span>
<a name="line-530"></a><span class="cm">  *            @arg HAL_FLASH_ERROR_PGS: FLASH Programming Sequence error flag </span>
<a name="line-531"></a><span class="cm">  *            @arg HAL_FLASH_ERROR_PGP: FLASH Programming Parallelism error flag  </span>
<a name="line-532"></a><span class="cm">  *            @arg HAL_FLASH_ERROR_PGA: FLASH Programming Alignment error flag</span>
<a name="line-533"></a><span class="cm">  *            @arg HAL_FLASH_ERROR_WRP: FLASH Write protected error flag</span>
<a name="line-534"></a><span class="cm">  *            @arg HAL_FLASH_ERROR_OPERATION: FLASH operation Error flag </span>
<a name="line-535"></a><span class="cm">  */</span>
<a name="line-536"></a><span class="hll"><span class="kt">uint32_t</span> <span class="n">HAL_FLASH_GetError</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="error2">&lt;--- The function 'HAL_FLASH_GetError' is never used.</span>
</span><a name="line-537"></a><span class="p">{</span> 
<a name="line-538"></a>   <span class="k">return</span> <span class="n">pFlash</span><span class="p">.</span><span class="n">ErrorCode</span><span class="p">;</span>
<a name="line-539"></a><span class="p">}</span>  
<a name="line-540"></a>  
<a name="line-541"></a><span class="cm">/**</span>
<a name="line-542"></a><span class="cm">  * @}</span>
<a name="line-543"></a><span class="cm">  */</span>    
<a name="line-544"></a>
<a name="line-545"></a><span class="cm">/**</span>
<a name="line-546"></a><span class="cm">  * @brief  Wait for a FLASH operation to complete.</span>
<a name="line-547"></a><span class="cm">  * @param  Timeout maximum flash operationtimeout</span>
<a name="line-548"></a><span class="cm">  * @retval HAL Status</span>
<a name="line-549"></a><span class="cm">  */</span>
<a name="line-550"></a><span class="n">HAL_StatusTypeDef</span> <span class="n">FLASH_WaitForLastOperation</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Timeout</span><span class="p">)</span>
<a name="line-551"></a><span class="p">{</span> 
<a name="line-552"></a>  <span class="kt">uint32_t</span> <span class="n">tickstart</span> <span class="o">=</span> <span class="mi">0U</span><span class="p">;</span>
<a name="line-553"></a>  
<a name="line-554"></a>  <span class="cm">/* Clear Error Code */</span>
<a name="line-555"></a>  <span class="n">pFlash</span><span class="p">.</span><span class="n">ErrorCode</span> <span class="o">=</span> <span class="n">HAL_FLASH_ERROR_NONE</span><span class="p">;</span>
<a name="line-556"></a>  
<a name="line-557"></a>  <span class="cm">/* Wait for the FLASH operation to complete by polling on BUSY flag to be reset.</span>
<a name="line-558"></a><span class="cm">     Even if the FLASH operation fails, the BUSY flag will be reset and an error</span>
<a name="line-559"></a><span class="cm">     flag will be set */</span>
<a name="line-560"></a>  <span class="cm">/* Get tick */</span>
<a name="line-561"></a>  <span class="n">tickstart</span> <span class="o">=</span> <span class="n">HAL_GetTick</span><span class="p">();</span>
<a name="line-562"></a>
<a name="line-563"></a>  <span class="k">while</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_BSY</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span> 
<a name="line-564"></a>  <span class="p">{</span> 
<a name="line-565"></a>    <span class="k">if</span><span class="p">(</span><span class="n">Timeout</span> <span class="o">!=</span> <span class="n">HAL_MAX_DELAY</span><span class="p">)</span>
<a name="line-566"></a>    <span class="p">{</span>
<a name="line-567"></a>      <span class="k">if</span><span class="p">((</span><span class="n">Timeout</span> <span class="o">==</span> <span class="mi">0U</span><span class="p">)</span><span class="o">||</span><span class="p">((</span><span class="n">HAL_GetTick</span><span class="p">()</span> <span class="o">-</span> <span class="n">tickstart</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">Timeout</span><span class="p">))</span>
<a name="line-568"></a>      <span class="p">{</span>
<a name="line-569"></a>        <span class="k">return</span> <span class="n">HAL_TIMEOUT</span><span class="p">;</span>
<a name="line-570"></a>      <span class="p">}</span>
<a name="line-571"></a>    <span class="p">}</span> 
<a name="line-572"></a>  <span class="p">}</span>
<a name="line-573"></a>
<a name="line-574"></a>  <span class="cm">/* Check FLASH End of Operation flag  */</span>
<a name="line-575"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_EOP</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-576"></a>  <span class="p">{</span>
<a name="line-577"></a>    <span class="cm">/* Clear FLASH End of Operation pending bit */</span>
<a name="line-578"></a>    <span class="n">__HAL_FLASH_CLEAR_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_EOP</span><span class="p">);</span>
<a name="line-579"></a>  <span class="p">}</span>
<a name="line-580"></a><span class="cp">#if defined(FLASH_SR_RDERR)  </span>
<a name="line-581"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">((</span><span class="n">FLASH_FLAG_OPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_WRPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_PGAERR</span> <span class="o">|</span> \
<a name="line-582"></a>                           <span class="n">FLASH_FLAG_PGPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_PGSERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_RDERR</span><span class="p">))</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-583"></a><span class="cp">#else</span>
<a name="line-584"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">((</span><span class="n">FLASH_FLAG_OPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_WRPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_PGAERR</span> <span class="o">|</span> \
<a name="line-585"></a>                           <span class="n">FLASH_FLAG_PGPERR</span> <span class="o">|</span> <span class="n">FLASH_FLAG_PGSERR</span><span class="p">))</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-586"></a><span class="cp">#endif </span><span class="cm">/* FLASH_SR_RDERR */</span><span class="cp"></span>
<a name="line-587"></a>  <span class="p">{</span>
<a name="line-588"></a>    <span class="cm">/*Save the error code*/</span>
<a name="line-589"></a>    <span class="n">FLASH_SetErrorCode</span><span class="p">();</span>
<a name="line-590"></a>    <span class="k">return</span> <span class="n">HAL_ERROR</span><span class="p">;</span>
<a name="line-591"></a>  <span class="p">}</span>
<a name="line-592"></a>
<a name="line-593"></a>  <span class="cm">/* If there is no error flag set */</span>
<a name="line-594"></a>  <span class="k">return</span> <span class="n">HAL_OK</span><span class="p">;</span>
<a name="line-595"></a>  
<a name="line-596"></a><span class="p">}</span>  
<a name="line-597"></a>
<a name="line-598"></a><span class="cm">/**</span>
<a name="line-599"></a><span class="cm">  * @brief  Program a double word (64-bit) at a specified address.</span>
<a name="line-600"></a><span class="cm">  * @note   This function must be used when the device voltage range is from</span>
<a name="line-601"></a><span class="cm">  *         2.7V to 3.6V and Vpp in the range 7V to 9V.</span>
<a name="line-602"></a><span class="cm">  *</span>
<a name="line-603"></a><span class="cm">  * @note   If an erase and a program operations are requested simultaneously,    </span>
<a name="line-604"></a><span class="cm">  *         the erase operation is performed before the program one.</span>
<a name="line-605"></a><span class="cm">  *  </span>
<a name="line-606"></a><span class="cm">  * @param  Address specifies the address to be programmed.</span>
<a name="line-607"></a><span class="cm">  * @param  Data specifies the data to be programmed.</span>
<a name="line-608"></a><span class="cm">  * @retval None</span>
<a name="line-609"></a><span class="cm">  */</span>
<a name="line-610"></a><span class="k">static</span> <span class="kt">void</span> <span class="n">FLASH_Program_DoubleWord</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">Data</span><span class="p">)</span>
<a name="line-611"></a><span class="p">{</span>
<a name="line-612"></a>  <span class="cm">/* Check the parameters */</span>
<a name="line-613"></a>  <span class="n">assert_param</span><span class="p">(</span><span class="n">IS_FLASH_ADDRESS</span><span class="p">(</span><span class="n">Address</span><span class="p">));</span>
<a name="line-614"></a>  
<a name="line-615"></a>  <span class="cm">/* If the previous operation is completed, proceed to program the new data */</span>
<a name="line-616"></a>  <span class="n">CLEAR_BIT</span><span class="p">(</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">,</span> <span class="n">FLASH_CR_PSIZE</span><span class="p">);</span>
<a name="line-617"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">|=</span> <span class="n">FLASH_PSIZE_DOUBLE_WORD</span><span class="p">;</span>
<a name="line-618"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">|=</span> <span class="n">FLASH_CR_PG</span><span class="p">;</span>
<a name="line-619"></a>
<a name="line-620"></a>  <span class="cm">/* Program first word */</span>
<a name="line-621"></a>  <span class="o">*</span><span class="p">(</span><span class="n">__IO</span> <span class="kt">uint32_t</span><span class="o">*</span><span class="p">)</span><span class="n">Address</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">Data</span><span class="p">;</span>
<a name="line-622"></a>
<a name="line-623"></a>  <span class="cm">/* Barrier to ensure programming is performed in 2 steps, in right order</span>
<a name="line-624"></a><span class="cm">    (independently of compiler optimization behavior) */</span>
<a name="line-625"></a>  <span class="n">__ISB</span><span class="p">();</span>
<a name="line-626"></a>
<a name="line-627"></a>  <span class="cm">/* Program second word */</span>
<a name="line-628"></a>  <span class="o">*</span><span class="p">(</span><span class="n">__IO</span> <span class="kt">uint32_t</span><span class="o">*</span><span class="p">)(</span><span class="n">Address</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)(</span><span class="n">Data</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">);</span>
<a name="line-629"></a><span class="p">}</span>
<a name="line-630"></a>
<a name="line-631"></a>
<a name="line-632"></a><span class="cm">/**</span>
<a name="line-633"></a><span class="cm">  * @brief  Program word (32-bit) at a specified address.</span>
<a name="line-634"></a><span class="cm">  * @note   This function must be used when the device voltage range is from</span>
<a name="line-635"></a><span class="cm">  *         2.7V to 3.6V.</span>
<a name="line-636"></a><span class="cm">  *</span>
<a name="line-637"></a><span class="cm">  * @note   If an erase and a program operations are requested simultaneously,    </span>
<a name="line-638"></a><span class="cm">  *         the erase operation is performed before the program one.</span>
<a name="line-639"></a><span class="cm">  *  </span>
<a name="line-640"></a><span class="cm">  * @param  Address specifies the address to be programmed.</span>
<a name="line-641"></a><span class="cm">  * @param  Data specifies the data to be programmed.</span>
<a name="line-642"></a><span class="cm">  * @retval None</span>
<a name="line-643"></a><span class="cm">  */</span>
<a name="line-644"></a><span class="k">static</span> <span class="kt">void</span> <span class="n">FLASH_Program_Word</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">Data</span><span class="p">)</span>
<a name="line-645"></a><span class="p">{</span>
<a name="line-646"></a>  <span class="cm">/* Check the parameters */</span>
<a name="line-647"></a>  <span class="n">assert_param</span><span class="p">(</span><span class="n">IS_FLASH_ADDRESS</span><span class="p">(</span><span class="n">Address</span><span class="p">));</span>
<a name="line-648"></a>  
<a name="line-649"></a>  <span class="cm">/* If the previous operation is completed, proceed to program the new data */</span>
<a name="line-650"></a>  <span class="n">CLEAR_BIT</span><span class="p">(</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">,</span> <span class="n">FLASH_CR_PSIZE</span><span class="p">);</span>
<a name="line-651"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">|=</span> <span class="n">FLASH_PSIZE_WORD</span><span class="p">;</span>
<a name="line-652"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">|=</span> <span class="n">FLASH_CR_PG</span><span class="p">;</span>
<a name="line-653"></a>
<a name="line-654"></a>  <span class="o">*</span><span class="p">(</span><span class="n">__IO</span> <span class="kt">uint32_t</span><span class="o">*</span><span class="p">)</span><span class="n">Address</span> <span class="o">=</span> <span class="n">Data</span><span class="p">;</span>
<a name="line-655"></a><span class="p">}</span>
<a name="line-656"></a>
<a name="line-657"></a><span class="cm">/**</span>
<a name="line-658"></a><span class="cm">  * @brief  Program a half-word (16-bit) at a specified address.</span>
<a name="line-659"></a><span class="cm">  * @note   This function must be used when the device voltage range is from</span>
<a name="line-660"></a><span class="cm">  *         2.1V to 3.6V.</span>
<a name="line-661"></a><span class="cm">  *</span>
<a name="line-662"></a><span class="cm">  * @note   If an erase and a program operations are requested simultaneously,    </span>
<a name="line-663"></a><span class="cm">  *         the erase operation is performed before the program one.</span>
<a name="line-664"></a><span class="cm">  *  </span>
<a name="line-665"></a><span class="cm">  * @param  Address specifies the address to be programmed.</span>
<a name="line-666"></a><span class="cm">  * @param  Data specifies the data to be programmed.</span>
<a name="line-667"></a><span class="cm">  * @retval None</span>
<a name="line-668"></a><span class="cm">  */</span>
<a name="line-669"></a><span class="k">static</span> <span class="kt">void</span> <span class="n">FLASH_Program_HalfWord</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">Data</span><span class="p">)</span>
<a name="line-670"></a><span class="p">{</span>
<a name="line-671"></a>  <span class="cm">/* Check the parameters */</span>
<a name="line-672"></a>  <span class="n">assert_param</span><span class="p">(</span><span class="n">IS_FLASH_ADDRESS</span><span class="p">(</span><span class="n">Address</span><span class="p">));</span>
<a name="line-673"></a>  
<a name="line-674"></a>  <span class="cm">/* If the previous operation is completed, proceed to program the new data */</span>
<a name="line-675"></a>  <span class="n">CLEAR_BIT</span><span class="p">(</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">,</span> <span class="n">FLASH_CR_PSIZE</span><span class="p">);</span>
<a name="line-676"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">|=</span> <span class="n">FLASH_PSIZE_HALF_WORD</span><span class="p">;</span>
<a name="line-677"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">|=</span> <span class="n">FLASH_CR_PG</span><span class="p">;</span>
<a name="line-678"></a>
<a name="line-679"></a>  <span class="o">*</span><span class="p">(</span><span class="n">__IO</span> <span class="kt">uint16_t</span><span class="o">*</span><span class="p">)</span><span class="n">Address</span> <span class="o">=</span> <span class="n">Data</span><span class="p">;</span>
<a name="line-680"></a><span class="p">}</span>
<a name="line-681"></a>
<a name="line-682"></a><span class="cm">/**</span>
<a name="line-683"></a><span class="cm">  * @brief  Program byte (8-bit) at a specified address.</span>
<a name="line-684"></a><span class="cm">  * @note   This function must be used when the device voltage range is from</span>
<a name="line-685"></a><span class="cm">  *         1.8V to 3.6V.</span>
<a name="line-686"></a><span class="cm">  *</span>
<a name="line-687"></a><span class="cm">  * @note   If an erase and a program operations are requested simultaneously,    </span>
<a name="line-688"></a><span class="cm">  *         the erase operation is performed before the program one.</span>
<a name="line-689"></a><span class="cm">  *  </span>
<a name="line-690"></a><span class="cm">  * @param  Address specifies the address to be programmed.</span>
<a name="line-691"></a><span class="cm">  * @param  Data specifies the data to be programmed.</span>
<a name="line-692"></a><span class="cm">  * @retval None</span>
<a name="line-693"></a><span class="cm">  */</span>
<a name="line-694"></a><span class="k">static</span> <span class="kt">void</span> <span class="n">FLASH_Program_Byte</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">Data</span><span class="p">)</span>
<a name="line-695"></a><span class="p">{</span>
<a name="line-696"></a>  <span class="cm">/* Check the parameters */</span>
<a name="line-697"></a>  <span class="n">assert_param</span><span class="p">(</span><span class="n">IS_FLASH_ADDRESS</span><span class="p">(</span><span class="n">Address</span><span class="p">));</span>
<a name="line-698"></a>  
<a name="line-699"></a>  <span class="cm">/* If the previous operation is completed, proceed to program the new data */</span>
<a name="line-700"></a>  <span class="n">CLEAR_BIT</span><span class="p">(</span><span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">,</span> <span class="n">FLASH_CR_PSIZE</span><span class="p">);</span>
<a name="line-701"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">|=</span> <span class="n">FLASH_PSIZE_BYTE</span><span class="p">;</span>
<a name="line-702"></a>  <span class="n">FLASH</span><span class="o">-&gt;</span><span class="n">CR</span> <span class="o">|=</span> <span class="n">FLASH_CR_PG</span><span class="p">;</span>
<a name="line-703"></a>
<a name="line-704"></a>  <span class="o">*</span><span class="p">(</span><span class="n">__IO</span> <span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">Address</span> <span class="o">=</span> <span class="n">Data</span><span class="p">;</span>
<a name="line-705"></a><span class="p">}</span>
<a name="line-706"></a>
<a name="line-707"></a><span class="cm">/**</span>
<a name="line-708"></a><span class="cm">  * @brief  Set the specific FLASH error flag.</span>
<a name="line-709"></a><span class="cm">  * @retval None</span>
<a name="line-710"></a><span class="cm">  */</span>
<a name="line-711"></a><span class="k">static</span> <span class="kt">void</span> <span class="n">FLASH_SetErrorCode</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a name="line-712"></a><span class="p">{</span> 
<a name="line-713"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_WRPERR</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-714"></a>  <span class="p">{</span>
<a name="line-715"></a>   <span class="n">pFlash</span><span class="p">.</span><span class="n">ErrorCode</span> <span class="o">|=</span> <span class="n">HAL_FLASH_ERROR_WRP</span><span class="p">;</span>
<a name="line-716"></a>   
<a name="line-717"></a>   <span class="cm">/* Clear FLASH write protection error pending bit */</span>
<a name="line-718"></a>   <span class="n">__HAL_FLASH_CLEAR_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_WRPERR</span><span class="p">);</span>
<a name="line-719"></a>  <span class="p">}</span>
<a name="line-720"></a>  
<a name="line-721"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_PGAERR</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-722"></a>  <span class="p">{</span>
<a name="line-723"></a>   <span class="n">pFlash</span><span class="p">.</span><span class="n">ErrorCode</span> <span class="o">|=</span> <span class="n">HAL_FLASH_ERROR_PGA</span><span class="p">;</span>
<a name="line-724"></a>   
<a name="line-725"></a>   <span class="cm">/* Clear FLASH Programming alignment error pending bit */</span>
<a name="line-726"></a>   <span class="n">__HAL_FLASH_CLEAR_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_PGAERR</span><span class="p">);</span>
<a name="line-727"></a>  <span class="p">}</span>
<a name="line-728"></a>  
<a name="line-729"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_PGPERR</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-730"></a>  <span class="p">{</span>
<a name="line-731"></a>    <span class="n">pFlash</span><span class="p">.</span><span class="n">ErrorCode</span> <span class="o">|=</span> <span class="n">HAL_FLASH_ERROR_PGP</span><span class="p">;</span>
<a name="line-732"></a>    
<a name="line-733"></a>    <span class="cm">/* Clear FLASH Programming parallelism error pending bit */</span>
<a name="line-734"></a>    <span class="n">__HAL_FLASH_CLEAR_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_PGPERR</span><span class="p">);</span>
<a name="line-735"></a>  <span class="p">}</span>
<a name="line-736"></a>  
<a name="line-737"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_PGSERR</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-738"></a>  <span class="p">{</span>
<a name="line-739"></a>    <span class="n">pFlash</span><span class="p">.</span><span class="n">ErrorCode</span> <span class="o">|=</span> <span class="n">HAL_FLASH_ERROR_PGS</span><span class="p">;</span>
<a name="line-740"></a>    
<a name="line-741"></a>    <span class="cm">/* Clear FLASH Programming sequence error pending bit */</span>
<a name="line-742"></a>    <span class="n">__HAL_FLASH_CLEAR_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_PGSERR</span><span class="p">);</span>
<a name="line-743"></a>  <span class="p">}</span>
<a name="line-744"></a><span class="cp">#if defined(FLASH_SR_RDERR) </span>
<a name="line-745"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_RDERR</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-746"></a>  <span class="p">{</span>
<a name="line-747"></a>    <span class="n">pFlash</span><span class="p">.</span><span class="n">ErrorCode</span> <span class="o">|=</span> <span class="n">HAL_FLASH_ERROR_RD</span><span class="p">;</span>
<a name="line-748"></a>    
<a name="line-749"></a>    <span class="cm">/* Clear FLASH Proprietary readout protection error pending bit */</span>
<a name="line-750"></a>    <span class="n">__HAL_FLASH_CLEAR_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_RDERR</span><span class="p">);</span>
<a name="line-751"></a>  <span class="p">}</span>
<a name="line-752"></a><span class="cp">#endif </span><span class="cm">/* FLASH_SR_RDERR */</span><span class="cp">  </span>
<a name="line-753"></a>  <span class="k">if</span><span class="p">(</span><span class="n">__HAL_FLASH_GET_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_OPERR</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RESET</span><span class="p">)</span>
<a name="line-754"></a>  <span class="p">{</span>
<a name="line-755"></a>    <span class="n">pFlash</span><span class="p">.</span><span class="n">ErrorCode</span> <span class="o">|=</span> <span class="n">HAL_FLASH_ERROR_OPERATION</span><span class="p">;</span>
<a name="line-756"></a>    
<a name="line-757"></a>    <span class="cm">/* Clear FLASH Operation error pending bit */</span>
<a name="line-758"></a>    <span class="n">__HAL_FLASH_CLEAR_FLAG</span><span class="p">(</span><span class="n">FLASH_FLAG_OPERR</span><span class="p">);</span>
<a name="line-759"></a>  <span class="p">}</span>
<a name="line-760"></a><span class="p">}</span>
<a name="line-761"></a>
<a name="line-762"></a><span class="cm">/**</span>
<a name="line-763"></a><span class="cm">  * @}</span>
<a name="line-764"></a><span class="cm">  */</span>
<a name="line-765"></a>
<a name="line-766"></a><span class="cp">#endif </span><span class="cm">/* HAL_FLASH_MODULE_ENABLED */</span><span class="cp"></span>
<a name="line-767"></a>
<a name="line-768"></a><span class="cm">/**</span>
<a name="line-769"></a><span class="cm">  * @}</span>
<a name="line-770"></a><span class="cm">  */</span>
<a name="line-771"></a>
<a name="line-772"></a><span class="cm">/**</span>
<a name="line-773"></a><span class="cm">  * @}</span>
<a name="line-774"></a><span class="cm">  */</span>
<a name="line-775"></a>
</pre></div>
</td></tr></table>
      </div> <!-- /.wrapper -->
    </div>
    <div id="footer" class="footer">
      <p>
        Cppcheck 2.3 - a tool for static C/C++ code analysis<br>
        <br>
        Internet: <a href="http://cppcheck.net">http://cppcheck.net</a><br>
        IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a><br>
      </p>
    </div>
  </body>
</html>
