ARM GAS  /tmp/ccJ2dceG.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"hall_detection.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.Hall_start_detection,"ax",%progbits
  18              		.align	1
  19              		.global	Hall_start_detection
  20              		.arch armv7e-m
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  24              		.fpu fpv4-sp-d16
  26              	Hall_start_detection:
  27              	.LFB235:
  28              		.file 1 "Core/Src/hall_detection.c"
   1:Core/Src/hall_detection.c **** /*
   2:Core/Src/hall_detection.c ****  * hall_detection.c
   3:Core/Src/hall_detection.c ****  *
   4:Core/Src/hall_detection.c ****  *  Created on: Jan 30, 2024
   5:Core/Src/hall_detection.c ****  *      Author: javier.munoz.saez@upc.edu
   6:Core/Src/hall_detection.c ****  */
   7:Core/Src/hall_detection.c **** 
   8:Core/Src/hall_detection.c **** #include "hall_detection.h" 		/*!< contains all enums, structs and includes neccesary for this .c, 
   9:Core/Src/hall_detection.c **** 
  10:Core/Src/hall_detection.c **** //Uncomment only one
  11:Core/Src/hall_detection.c **** //#define REAL_PHASES_A_B_calculated_C		/*!< our ADC is reading real current signals A and B, C=-A-
  12:Core/Src/hall_detection.c **** #define REAL_PHASES_A_C_calculated_B		/*!< our ADC is reading real current signals A and C, B=-A-C 
  13:Core/Src/hall_detection.c **** //#define REAL_PHASES_B_C_calculated_A		/*!< our ADC is reading real current signals B and C, A=-B-
  14:Core/Src/hall_detection.c **** 
  15:Core/Src/hall_detection.c **** #define TESTuart
  16:Core/Src/hall_detection.c **** 
  17:Core/Src/hall_detection.c **** 
  18:Core/Src/hall_detection.c **** #ifdef TESTuart
  19:Core/Src/hall_detection.c **** #include "usart.h"
  20:Core/Src/hall_detection.c **** #endif
  21:Core/Src/hall_detection.c **** 
  22:Core/Src/hall_detection.c **** #define MAXTICKs 1*888888		/*!< timeout for the algorithm, measured in 0.05s ticks , so 1000*0.05=5
  23:Core/Src/hall_detection.c **** #define lowpassfilter_ticks 15 						/*!< minimum number of ticks that should have passed in betwee
  24:Core/Src/hall_detection.c **** #define currentAplusBplusC (uint32_t)(3*(4096)/2)	/*!< the sum of the average of each currents shou
  25:Core/Src/hall_detection.c **** #define currentADCoffset (float) 0.0				/*!< as we are using already processed filtered currents, n
  26:Core/Src/hall_detection.c **** #define TOLERANCE_FACTOR_FOR_STATIONARY_CURRENTS 0.25
  27:Core/Src/hall_detection.c **** #define WAITING_STATIONARY_MAXZEROCROSSINGS 6
  28:Core/Src/hall_detection.c **** #define NUMBER_OF_VALID_MATCHING_RESULTS 3
  29:Core/Src/hall_detection.c **** 
  30:Core/Src/hall_detection.c **** 
ARM GAS  /tmp/ccJ2dceG.s 			page 2


  31:Core/Src/hall_detection.c **** 
  32:Core/Src/hall_detection.c **** 
  33:Core/Src/hall_detection.c **** //LOCAL VARIABLES (only declared inside this .c file)
  34:Core/Src/hall_detection.c **** uint32_t ticks; 								/*!< ticks are the time measurement unit of this algorithm, each run of the
  35:Core/Src/hall_detection.c **** detection_state_enum detection_state=detection_DISABLED;	/*!< main enable disable variable, when it
  36:Core/Src/hall_detection.c **** hall_detection_general_struct general={0};
  37:Core/Src/hall_detection.c **** const hall_detection_general_struct empty_general={0};
  38:Core/Src/hall_detection.c **** 
  39:Core/Src/hall_detection.c **** 
  40:Core/Src/hall_detection.c **** 
  41:Core/Src/hall_detection.c **** 
  42:Core/Src/hall_detection.c **** 
  43:Core/Src/hall_detection.c **** 
  44:Core/Src/hall_detection.c **** 
  45:Core/Src/hall_detection.c **** 
  46:Core/Src/hall_detection.c **** 
  47:Core/Src/hall_detection.c **** //PUBLIC FUNCTIONS (also declared in the .h file)
  48:Core/Src/hall_detection.c **** void Hall_start_detection();
  49:Core/Src/hall_detection.c **** uint32_t Hall_is_detection_finished();
  50:Core/Src/hall_detection.c **** void Hall_Identification_Test_measurement(
  51:Core/Src/hall_detection.c **** 		hall_pin_info* H1_gpio,
  52:Core/Src/hall_detection.c **** 		hall_pin_info* H2_gpio,
  53:Core/Src/hall_detection.c **** 		hall_pin_info* H3_gpio,
  54:Core/Src/hall_detection.c **** 		volatile float* ADCcurr1,
  55:Core/Src/hall_detection.c **** 		volatile float* ADCcurr2
  56:Core/Src/hall_detection.c **** 		);
  57:Core/Src/hall_detection.c **** 
  58:Core/Src/hall_detection.c **** 
  59:Core/Src/hall_detection.c **** 
  60:Core/Src/hall_detection.c **** //PRIVATE FUNCTIONS (only declared inside this .c file)
  61:Core/Src/hall_detection.c **** //state machine
  62:Core/Src/hall_detection.c **** void resetVariables_adquisition					(hall_detection_general_struct *gen);
  63:Core/Src/hall_detection.c **** void resetVariables_diferences					(hall_detection_general_struct *gen);
  64:Core/Src/hall_detection.c **** void resetVariables_results						(hall_detection_general_struct *gen);
  65:Core/Src/hall_detection.c **** void wait_for_the_current_stationary(detection_state_enum* state,hall_detection_general_struct *gen
  66:Core/Src/hall_detection.c **** void adquisition					(detection_state_enum* state,hall_detection_general_struct *gen,hall_pin_info*
  67:Core/Src/hall_detection.c **** void interpretation					(detection_state_enum* state,hall_detection_general_struct *gen);
  68:Core/Src/hall_detection.c **** void validation						(detection_state_enum* state,hall_detection_general_struct *gen);
  69:Core/Src/hall_detection.c **** void present_and_finish				(detection_state_enum* state,hall_detection_general_struct *gen);
  70:Core/Src/hall_detection.c **** void error_handler();
  71:Core/Src/hall_detection.c **** void fill_buffers(
  72:Core/Src/hall_detection.c **** 		hall_detection_general_struct *gen,
  73:Core/Src/hall_detection.c **** 		hall_pin_info* H1_gpio,
  74:Core/Src/hall_detection.c **** 		hall_pin_info* H2_gpio,
  75:Core/Src/hall_detection.c **** 		hall_pin_info* H3_gpio,
  76:Core/Src/hall_detection.c **** 		volatile float* ADCcurr1,
  77:Core/Src/hall_detection.c **** 		volatile float* ADCcurr2
  78:Core/Src/hall_detection.c **** 		);
  79:Core/Src/hall_detection.c **** detection_YES_NO detect_N_zerocrossings	(hall_detection_general_struct *gen,uint32_t N);
  80:Core/Src/hall_detection.c **** void detect_N_current_zerocrossings	(uint32_t ticks,current_or_hall_measurements_struct* currx,uint
  81:Core/Src/hall_detection.c **** void detect_N_hall_zerocrossings	(uint32_t ticks,current_or_hall_measurements_struct* hallx,uint32_
  82:Core/Src/hall_detection.c **** void calculateElectricPeriod_inTicks(hall_detection_general_struct *gen, uint32_t samples);
  83:Core/Src/hall_detection.c **** detection_YES_NO is_deviation_from_period_acceptable(hall_detection_general_struct *gen, float tole
  84:Core/Src/hall_detection.c **** detection_YES_NO are_all_periods_stable(hall_detection_general_struct *gen, uint32_t samples);
  85:Core/Src/hall_detection.c **** int32_t absolute(int32_t x);
  86:Core/Src/hall_detection.c **** void assign_closest_phase_to_hall(hall_detection_general_struct *gen);
  87:Core/Src/hall_detection.c **** void assign_polarity(hall_detection_general_struct *gen);
ARM GAS  /tmp/ccJ2dceG.s 			page 3


  88:Core/Src/hall_detection.c **** void swap_hall_gpios_with_detected_results(hall_detection_general_struct *gen,hall_pin_info* pin_in
  89:Core/Src/hall_detection.c **** 
  90:Core/Src/hall_detection.c **** 
  91:Core/Src/hall_detection.c **** 
  92:Core/Src/hall_detection.c **** 
  93:Core/Src/hall_detection.c **** 
  94:Core/Src/hall_detection.c **** 
  95:Core/Src/hall_detection.c **** 
  96:Core/Src/hall_detection.c **** 
  97:Core/Src/hall_detection.c **** /**
  98:Core/Src/hall_detection.c **** * \brief public function , this should me called by anyone otside this .c .h to start the hall dete
  99:Core/Src/hall_detection.c **** */
 100:Core/Src/hall_detection.c **** void Hall_start_detection(){
  29              		.loc 1 100 28 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		@ link register save eliminated.
 101:Core/Src/hall_detection.c **** 	detection_state=detection_ENABLED;
  34              		.loc 1 101 2 view .LVU1
  35              		.loc 1 101 17 is_stmt 0 view .LVU2
  36 0000 014B     		ldr	r3, .L2
  37 0002 0122     		movs	r2, #1
  38 0004 1A70     		strb	r2, [r3]
 102:Core/Src/hall_detection.c **** }
  39              		.loc 1 102 1 view .LVU3
  40 0006 7047     		bx	lr
  41              	.L3:
  42              		.align	2
  43              	.L2:
  44 0008 00000000 		.word	.LANCHOR0
  45              		.cfi_endproc
  46              	.LFE235:
  48              		.section	.text.Hall_is_detection_finished,"ax",%progbits
  49              		.align	1
  50              		.global	Hall_is_detection_finished
  51              		.syntax unified
  52              		.thumb
  53              		.thumb_func
  54              		.fpu fpv4-sp-d16
  56              	Hall_is_detection_finished:
  57              	.LFB236:
 103:Core/Src/hall_detection.c **** 
 104:Core/Src/hall_detection.c **** /**
 105:Core/Src/hall_detection.c **** * \brief public function , this should me called by anyone otside this .c .h to figure out if the d
 106:Core/Src/hall_detection.c **** */
 107:Core/Src/hall_detection.c **** uint32_t Hall_is_detection_finished(){
  58              		.loc 1 107 38 is_stmt 1 view -0
  59              		.cfi_startproc
  60              		@ args = 0, pretend = 0, frame = 0
  61              		@ frame_needed = 0, uses_anonymous_args = 0
  62              		@ link register save eliminated.
 108:Core/Src/hall_detection.c **** 	if(detection_state==detection_DISABLED){
  63              		.loc 1 108 2 view .LVU5
  64              		.loc 1 108 20 is_stmt 0 view .LVU6
  65 0000 034B     		ldr	r3, .L7
  66 0002 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
ARM GAS  /tmp/ccJ2dceG.s 			page 4


  67              		.loc 1 108 4 view .LVU7
  68 0004 0BB9     		cbnz	r3, .L6
 109:Core/Src/hall_detection.c **** 		return YES;
  69              		.loc 1 109 10 view .LVU8
  70 0006 0120     		movs	r0, #1
  71 0008 7047     		bx	lr
  72              	.L6:
 110:Core/Src/hall_detection.c **** 	}else{
 111:Core/Src/hall_detection.c **** 		return NO;
  73              		.loc 1 111 10 view .LVU9
  74 000a 0020     		movs	r0, #0
 112:Core/Src/hall_detection.c **** 	}
 113:Core/Src/hall_detection.c **** }
  75              		.loc 1 113 1 view .LVU10
  76 000c 7047     		bx	lr
  77              	.L8:
  78 000e 00BF     		.align	2
  79              	.L7:
  80 0010 00000000 		.word	.LANCHOR0
  81              		.cfi_endproc
  82              	.LFE236:
  84              		.section	.text.present_and_finish,"ax",%progbits
  85              		.align	1
  86              		.global	present_and_finish
  87              		.syntax unified
  88              		.thumb
  89              		.thumb_func
  90              		.fpu fpv4-sp-d16
  92              	present_and_finish:
  93              	.LVL0:
  94              	.LFB242:
 114:Core/Src/hall_detection.c **** 
 115:Core/Src/hall_detection.c **** //https://dot-to-ascii.ggerganov.com/
 116:Core/Src/hall_detection.c **** /*
 117:Core/Src/hall_detection.c ****  *
 118:Core/Src/hall_detection.c **** +-------------------------+
 119:Core/Src/hall_detection.c **** |          start          |
 120:Core/Src/hall_detection.c **** +-------------------------+
 121:Core/Src/hall_detection.c ****   |
 122:Core/Src/hall_detection.c ****   |
 123:Core/Src/hall_detection.c ****   v
 124:Core/Src/hall_detection.c **** +-------------------------+
 125:Core/Src/hall_detection.c **** |                         | <--+
 126:Core/Src/hall_detection.c **** | WAIT_CURRENT_STATIONARY |    | still not stationary
 127:Core/Src/hall_detection.c **** |                         | ---+
 128:Core/Src/hall_detection.c **** +-------------------------+
 129:Core/Src/hall_detection.c ****   |
 130:Core/Src/hall_detection.c ****   |	the openloop stabilished
 131:Core/Src/hall_detection.c ****   v
 132:Core/Src/hall_detection.c **** +-------------------------+
 133:Core/Src/hall_detection.c **** |       ADQUISITION       | <--+
 134:Core/Src/hall_detection.c **** +-------------------------+    |
 135:Core/Src/hall_detection.c ****   |                            |
 136:Core/Src/hall_detection.c ****   | zerocrossings detected     |
 137:Core/Src/hall_detection.c ****   v                            |
 138:Core/Src/hall_detection.c **** +-------------------------+    | still not 3 matching X!X!X! type results
 139:Core/Src/hall_detection.c **** |     INTERPRETATION      |    |
ARM GAS  /tmp/ccJ2dceG.s 			page 5


 140:Core/Src/hall_detection.c **** +-------------------------+    |
 141:Core/Src/hall_detection.c ****   |                            |
 142:Core/Src/hall_detection.c ****   | X!X!X! type result         |
 143:Core/Src/hall_detection.c ****   v                            |
 144:Core/Src/hall_detection.c **** +-------------------------+    |
 145:Core/Src/hall_detection.c **** |       VALIDATION        | ---+
 146:Core/Src/hall_detection.c **** +-------------------------+
 147:Core/Src/hall_detection.c ****   |
 148:Core/Src/hall_detection.c ****   |	3 matching results, we are confident now
 149:Core/Src/hall_detection.c ****   v
 150:Core/Src/hall_detection.c **** +-------------------------+
 151:Core/Src/hall_detection.c **** |   PRESENTATION_FINISH   |
 152:Core/Src/hall_detection.c **** +-------------------------+
 153:Core/Src/hall_detection.c ****   |
 154:Core/Src/hall_detection.c ****   |
 155:Core/Src/hall_detection.c ****   v
 156:Core/Src/hall_detection.c **** +-------------------------+
 157:Core/Src/hall_detection.c **** |           end           |
 158:Core/Src/hall_detection.c **** +-------------------------+
 159:Core/Src/hall_detection.c **** 
 160:Core/Src/hall_detection.c **** */
 161:Core/Src/hall_detection.c **** /**
 162:Core/Src/hall_detection.c **** * \brief public function, to be included inside a 20Khz interruption routine, it manages the state 
 163:Core/Src/hall_detection.c **** * \param hall_pin_info * H1_gpio, pointer to gpio info about the hall A
 164:Core/Src/hall_detection.c **** * \param hall_pin_info * H2_gpio, pointer to gpio info about the hall B
 165:Core/Src/hall_detection.c **** * \param hall_pin_info * H3_gpio, pointer to gpio info about the hall C
 166:Core/Src/hall_detection.c **** * \param volatile float* ADCcurr1, pointer to current value in amps for phase A
 167:Core/Src/hall_detection.c **** * \param volatile float* ADCcurr2, pointer to current value in amps for phase C? or B?
 168:Core/Src/hall_detection.c **** */
 169:Core/Src/hall_detection.c **** void Hall_Identification_Test_measurement(
 170:Core/Src/hall_detection.c **** 		hall_pin_info* H1_gpio,
 171:Core/Src/hall_detection.c **** 		hall_pin_info* H2_gpio,
 172:Core/Src/hall_detection.c **** 		hall_pin_info* H3_gpio,
 173:Core/Src/hall_detection.c **** 		volatile float* ADCcurr1,
 174:Core/Src/hall_detection.c **** 		volatile float* ADCcurr2
 175:Core/Src/hall_detection.c **** 		){
 176:Core/Src/hall_detection.c **** 	switch (detection_state) {
 177:Core/Src/hall_detection.c **** 		case detection_ENABLED:
 178:Core/Src/hall_detection.c **** 			ticks=0;
 179:Core/Src/hall_detection.c **** 			resetVariables_adquisition(&general);
 180:Core/Src/hall_detection.c **** 			detection_state=detection_WAIT_CURRENT_STATIONARY;
 181:Core/Src/hall_detection.c **** 			break;
 182:Core/Src/hall_detection.c **** 		case detection_WAIT_CURRENT_STATIONARY:
 183:Core/Src/hall_detection.c **** 			wait_for_the_current_stationary(&detection_state,&general,H1_gpio,H2_gpio,H3_gpio,ADCcurr1,ADCcu
 184:Core/Src/hall_detection.c **** 			ticks++;
 185:Core/Src/hall_detection.c **** 			break;
 186:Core/Src/hall_detection.c **** 		case detection_ADQUISITION:
 187:Core/Src/hall_detection.c **** 			adquisition(&detection_state,&general,H1_gpio,H2_gpio,H3_gpio,ADCcurr1,ADCcurr2);
 188:Core/Src/hall_detection.c **** 			ticks++;
 189:Core/Src/hall_detection.c **** 			break;
 190:Core/Src/hall_detection.c **** 		case detection_INTERPRETATION:
 191:Core/Src/hall_detection.c **** 			interpretation(&detection_state, &general);
 192:Core/Src/hall_detection.c **** 			ticks++;
 193:Core/Src/hall_detection.c **** 			break;
 194:Core/Src/hall_detection.c **** 		case detection_VALIDATION:
 195:Core/Src/hall_detection.c **** 			validation(&detection_state,&general);
 196:Core/Src/hall_detection.c **** 			ticks++;
ARM GAS  /tmp/ccJ2dceG.s 			page 6


 197:Core/Src/hall_detection.c **** 			break;
 198:Core/Src/hall_detection.c **** 		case detection_PRESENTATION_FINISH:
 199:Core/Src/hall_detection.c **** 			present_and_finish(&detection_state,&general);
 200:Core/Src/hall_detection.c **** 			swap_hall_gpios_with_detected_results(&general,H1_gpio, H2_gpio, H3_gpio);
 201:Core/Src/hall_detection.c **** 			ticks++;
 202:Core/Src/hall_detection.c **** 			break;
 203:Core/Src/hall_detection.c **** 		case detection_ERROR_OR_TIMEOUT:
 204:Core/Src/hall_detection.c **** 			error_handler();
 205:Core/Src/hall_detection.c **** 			detection_state=detection_DISABLED;
 206:Core/Src/hall_detection.c **** 		case detection_DISABLED://do nothing
 207:Core/Src/hall_detection.c **** 		default:
 208:Core/Src/hall_detection.c **** 			break;
 209:Core/Src/hall_detection.c **** 	}
 210:Core/Src/hall_detection.c **** }
 211:Core/Src/hall_detection.c **** 
 212:Core/Src/hall_detection.c **** /**
 213:Core/Src/hall_detection.c **** * \brief the motor running in open loop control needs a bit of time to lock in place so current sig
 214:Core/Src/hall_detection.c **** * \param detection_state_enum* state,			pointer to the variable controling the state machine
 215:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 216:Core/Src/hall_detection.c **** * \param hall_pin_info * H1_gpio, pointer to gpio info about the hall A
 217:Core/Src/hall_detection.c **** * \param hall_pin_info * H2_gpio, pointer to gpio info about the hall B
 218:Core/Src/hall_detection.c **** * \param hall_pin_info * H3_gpio, pointer to gpio info about the hall C
 219:Core/Src/hall_detection.c **** * \param volatile float* ADCcurr1, pointer to current value in amps for phase A
 220:Core/Src/hall_detection.c **** * \param volatile float* ADCcurr2, pointer to current value in amps for phase C? or B?
 221:Core/Src/hall_detection.c **** */
 222:Core/Src/hall_detection.c **** void wait_for_the_current_stationary(detection_state_enum* state,hall_detection_general_struct *gen
 223:Core/Src/hall_detection.c **** 		hall_pin_info* H1_gpio,
 224:Core/Src/hall_detection.c **** 		hall_pin_info* H2_gpio,
 225:Core/Src/hall_detection.c **** 		hall_pin_info* H3_gpio,
 226:Core/Src/hall_detection.c **** 		volatile float* ADCcurr1,
 227:Core/Src/hall_detection.c **** 		volatile float* ADCcurr2
 228:Core/Src/hall_detection.c **** 		){
 229:Core/Src/hall_detection.c **** 	//timeout or currentisstationary
 230:Core/Src/hall_detection.c **** 	fill_buffers(gen, H1_gpio, H2_gpio, H3_gpio, ADCcurr1, ADCcurr2);
 231:Core/Src/hall_detection.c **** 	//timeout
 232:Core/Src/hall_detection.c **** 	if( ticks>MAXTICKs){
 233:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 234:Core/Src/hall_detection.c **** 		return;
 235:Core/Src/hall_detection.c **** 	}
 236:Core/Src/hall_detection.c **** 
 237:Core/Src/hall_detection.c ****     //endofadquisition
 238:Core/Src/hall_detection.c **** 	if(ticks>general.start_adquisition_ticks+2){//run alone signals_adquisition() to pre-fill the buff
 239:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,WAITING_STATIONARY_MAXZEROCROSSINGS)==YES){
 240:Core/Src/hall_detection.c **** 			if(are_all_periods_stable(gen,WAITING_STATIONARY_MAXZEROCROSSINGS)==YES){
 241:Core/Src/hall_detection.c **** 				resetVariables_adquisition(gen);
 242:Core/Src/hall_detection.c **** 				resetVariables_results(gen);
 243:Core/Src/hall_detection.c **** 				general.start_adquisition_ticks=ticks;
 244:Core/Src/hall_detection.c **** 				*state=detection_ADQUISITION;
 245:Core/Src/hall_detection.c **** 				return;
 246:Core/Src/hall_detection.c **** 			}else{
 247:Core/Src/hall_detection.c **** 				resetVariables_adquisition(gen);
 248:Core/Src/hall_detection.c **** 				general.start_adquisition_ticks=ticks;
 249:Core/Src/hall_detection.c **** 			}
 250:Core/Src/hall_detection.c **** 		}
 251:Core/Src/hall_detection.c **** 	}
 252:Core/Src/hall_detection.c **** }
 253:Core/Src/hall_detection.c **** 
ARM GAS  /tmp/ccJ2dceG.s 			page 7


 254:Core/Src/hall_detection.c **** /**
 255:Core/Src/hall_detection.c **** * \brief similar to wait_for_the_current_stationary(), but this time we mean it, we are adquiring t
 256:Core/Src/hall_detection.c **** * \param detection_state_enum* state,			pointer to the variable controling the state machine
 257:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 258:Core/Src/hall_detection.c **** * \param hall_pin_info * H1_gpio, pointer to gpio info about the hall A
 259:Core/Src/hall_detection.c **** * \param hall_pin_info * H2_gpio, pointer to gpio info about the hall B
 260:Core/Src/hall_detection.c **** * \param hall_pin_info * H3_gpio, pointer to gpio info about the hall C
 261:Core/Src/hall_detection.c **** * \param volatile float* ADCcurr1, pointer to current value in amps for phase A
 262:Core/Src/hall_detection.c **** * \param volatile float* ADCcurr2, pointer to current value in amps for phase C? or B?
 263:Core/Src/hall_detection.c **** */
 264:Core/Src/hall_detection.c **** void adquisition(
 265:Core/Src/hall_detection.c **** 		detection_state_enum* state,
 266:Core/Src/hall_detection.c **** 		hall_detection_general_struct *gen,
 267:Core/Src/hall_detection.c **** 		hall_pin_info* H1_gpio,
 268:Core/Src/hall_detection.c **** 		hall_pin_info* H2_gpio,
 269:Core/Src/hall_detection.c **** 		hall_pin_info* H3_gpio,
 270:Core/Src/hall_detection.c **** 		volatile float* ADCcurr1,
 271:Core/Src/hall_detection.c **** 		volatile float* ADCcurr2
 272:Core/Src/hall_detection.c **** 		){
 273:Core/Src/hall_detection.c **** 
 274:Core/Src/hall_detection.c **** 	fill_buffers(gen, H1_gpio, H2_gpio, H3_gpio, ADCcurr1, ADCcurr2);
 275:Core/Src/hall_detection.c **** 
 276:Core/Src/hall_detection.c **** 	//timeout
 277:Core/Src/hall_detection.c **** 	if( ticks>MAXTICKs){
 278:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 279:Core/Src/hall_detection.c **** 		return;
 280:Core/Src/hall_detection.c **** 	}
 281:Core/Src/hall_detection.c **** 
 282:Core/Src/hall_detection.c **** 	if(ticks>general.start_adquisition_ticks+2){//run alone signals_adquisition() to pre-fill the buff
 283:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,MAXZEROCROSSINGS)==YES){
 284:Core/Src/hall_detection.c **** 			calculateElectricPeriod_inTicks(gen,MAXZEROCROSSINGS);
 285:Core/Src/hall_detection.c **** 			*state=detection_INTERPRETATION;
 286:Core/Src/hall_detection.c **** 		}
 287:Core/Src/hall_detection.c **** 	}
 288:Core/Src/hall_detection.c **** }
 289:Core/Src/hall_detection.c **** 
 290:Core/Src/hall_detection.c **** /**
 291:Core/Src/hall_detection.c **** * \brief once we adquired the data we are trying to make sense out of it.
 292:Core/Src/hall_detection.c **** * \param detection_state_enum* state,			pointer to the variable controling the state machine
 293:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 294:Core/Src/hall_detection.c **** */
 295:Core/Src/hall_detection.c **** void interpretation(detection_state_enum* state,hall_detection_general_struct *gen){
 296:Core/Src/hall_detection.c **** 	//timeout
 297:Core/Src/hall_detection.c **** 	if( ticks>MAXTICKs){
 298:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 299:Core/Src/hall_detection.c **** 		return;
 300:Core/Src/hall_detection.c **** 	}
 301:Core/Src/hall_detection.c **** 	assign_closest_phase_to_hall(gen);
 302:Core/Src/hall_detection.c **** 	assign_polarity(gen);
 303:Core/Src/hall_detection.c **** 	gen->numberOfresults++;
 304:Core/Src/hall_detection.c **** 	gen->start_adquisition_ticks=ticks;
 305:Core/Src/hall_detection.c **** 	*state=detection_VALIDATION;
 306:Core/Src/hall_detection.c **** }
 307:Core/Src/hall_detection.c **** 
 308:Core/Src/hall_detection.c **** /**
 309:Core/Src/hall_detection.c **** * \brief once we interpreted enough data, we validate results
 310:Core/Src/hall_detection.c **** * this function has a cyclomatic complexity of 19, that should be improved
ARM GAS  /tmp/ccJ2dceG.s 			page 8


 311:Core/Src/hall_detection.c **** * \param detection_state_enum* state,			pointer to the variable controling the state machine
 312:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 313:Core/Src/hall_detection.c **** */
 314:Core/Src/hall_detection.c **** void validation(detection_state_enum* state,hall_detection_general_struct *gen){
 315:Core/Src/hall_detection.c **** 	//timeout or 	//reached results buffer full capacity
 316:Core/Src/hall_detection.c **** 	if( ticks>MAXTICKs || gen->numberOfresults>TOTAL_NUMBEROFRESULTS){
 317:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 318:Core/Src/hall_detection.c **** 		return;
 319:Core/Src/hall_detection.c **** 	}
 320:Core/Src/hall_detection.c **** 
 321:Core/Src/hall_detection.c **** 	uint32_t all_phases_not_repeated=0;
 322:Core/Src/hall_detection.c **** 	for (uint32_t i = 0;  i < NUMBEROFPHASES; ++ i) {
 323:Core/Src/hall_detection.c **** 		if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_A){
 324:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_A);
 325:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_B){
 326:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_B);
 327:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_C){
 328:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_C);
 329:Core/Src/hall_detection.c **** 		}
 330:Core/Src/hall_detection.c **** 	}
 331:Core/Src/hall_detection.c **** 
 332:Core/Src/hall_detection.c **** 	if(all_phases_not_repeated==((1<<hall_A)+(1<<hall_B)+(1<<hall_C))){
 333:Core/Src/hall_detection.c **** 		gen->results[gen->numberOfresults-1].is_valid=YES;
 334:Core/Src/hall_detection.c **** 	}else{
 335:Core/Src/hall_detection.c **** 		gen->results[gen->numberOfresults-1].is_valid=NO;
 336:Core/Src/hall_detection.c **** 	}
 337:Core/Src/hall_detection.c **** 
 338:Core/Src/hall_detection.c **** 	uint32_t numberofvalid=0;
 339:Core/Src/hall_detection.c **** 	for (uint32_t i = 0;  i < TOTAL_NUMBEROFRESULTS; ++ i) {
 340:Core/Src/hall_detection.c **** 		if(gen->results[i].is_valid==YES){
 341:Core/Src/hall_detection.c **** 			numberofvalid++;
 342:Core/Src/hall_detection.c **** 		}
 343:Core/Src/hall_detection.c **** 	}
 344:Core/Src/hall_detection.c **** 
 345:Core/Src/hall_detection.c **** 	if(numberofvalid>=NUMBER_OF_VALID_MATCHING_RESULTS){			//only if enough adquisitions were made
 346:Core/Src/hall_detection.c **** 		for (uint32_t i = 0; i < gen->numberOfresults; ++i) {			//loop trough results
 347:Core/Src/hall_detection.c **** 			if(gen->results[i].is_valid==YES){	//skip the not valid results.
 348:Core/Src/hall_detection.c **** 				uint32_t number_of_results_matching=0;
 349:Core/Src/hall_detection.c **** 				for (uint32_t j = 0; j < gen->numberOfresults; ++j) {	//compare that one result with the rest
 350:Core/Src/hall_detection.c **** 					if(
 351:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[0]==gen->results[j].hall_order[0] &&
 352:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[1]==gen->results[j].hall_order[1] &&
 353:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[2]==gen->results[j].hall_order[2] &&
 354:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[0]==gen->results[j].hall_polarity[0] &&
 355:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[1]==gen->results[j].hall_polarity[1] &&
 356:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[2]==gen->results[j].hall_polarity[2]
 357:Core/Src/hall_detection.c **** 							){//do they match?
 358:Core/Src/hall_detection.c **** 							number_of_results_matching++;
 359:Core/Src/hall_detection.c **** 						if(number_of_results_matching>=NUMBER_OF_VALID_MATCHING_RESULTS){
 360:Core/Src/hall_detection.c **** 							gen->indexOfcorrectResult=i;
 361:Core/Src/hall_detection.c **** 							*state=detection_PRESENTATION_FINISH;
 362:Core/Src/hall_detection.c **** 							return;
 363:Core/Src/hall_detection.c **** 						}
 364:Core/Src/hall_detection.c **** 					}
 365:Core/Src/hall_detection.c **** 				}
 366:Core/Src/hall_detection.c **** 			}
 367:Core/Src/hall_detection.c **** 
ARM GAS  /tmp/ccJ2dceG.s 			page 9


 368:Core/Src/hall_detection.c **** 		}
 369:Core/Src/hall_detection.c **** 	}
 370:Core/Src/hall_detection.c **** 
 371:Core/Src/hall_detection.c **** 	resetVariables_adquisition(gen);
 372:Core/Src/hall_detection.c **** 	resetVariables_diferences(gen);
 373:Core/Src/hall_detection.c **** 	gen->start_adquisition_ticks=ticks;
 374:Core/Src/hall_detection.c **** 	*state=detection_ADQUISITION;
 375:Core/Src/hall_detection.c **** 	return;
 376:Core/Src/hall_detection.c **** }
 377:Core/Src/hall_detection.c **** 
 378:Core/Src/hall_detection.c **** /**
 379:Core/Src/hall_detection.c **** * \brief if the resutls are validated, lets present the data, load the ASCII message for uart and/o
 380:Core/Src/hall_detection.c **** * \param detection_state_enum* state,			pointer to the variable controling the state machine
 381:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 382:Core/Src/hall_detection.c **** */
 383:Core/Src/hall_detection.c **** void present_and_finish(detection_state_enum* state,hall_detection_general_struct *gen){
  95              		.loc 1 383 88 is_stmt 1 view -0
  96              		.cfi_startproc
  97              		@ args = 0, pretend = 0, frame = 0
  98              		@ frame_needed = 0, uses_anonymous_args = 0
  99              		.loc 1 383 88 is_stmt 0 view .LVU12
 100 0000 38B5     		push	{r3, r4, r5, lr}
 101              	.LCFI0:
 102              		.cfi_def_cfa_offset 16
 103              		.cfi_offset 3, -16
 104              		.cfi_offset 4, -12
 105              		.cfi_offset 5, -8
 106              		.cfi_offset 14, -4
 107 0002 0446     		mov	r4, r0
 384:Core/Src/hall_detection.c **** 	for (uint32_t i = 0; i < messageLength; ++i) {
 108              		.loc 1 384 2 is_stmt 1 view .LVU13
 109              	.LBB2:
 110              		.loc 1 384 7 view .LVU14
 111              	.LVL1:
 112              		.loc 1 384 16 is_stmt 0 view .LVU15
 113 0004 0023     		movs	r3, #0
 114              		.loc 1 384 2 view .LVU16
 115 0006 04E0     		b	.L10
 116              	.LVL2:
 117              	.L11:
 385:Core/Src/hall_detection.c **** 		gen->message[i]=' ';
 118              		.loc 1 385 3 is_stmt 1 discriminator 3 view .LVU17
 119              		.loc 1 385 18 is_stmt 0 discriminator 3 view .LVU18
 120 0008 CA18     		adds	r2, r1, r3
 121 000a 2020     		movs	r0, #32
 122 000c 82F8BC01 		strb	r0, [r2, #444]
 384:Core/Src/hall_detection.c **** 	for (uint32_t i = 0; i < messageLength; ++i) {
 123              		.loc 1 384 42 discriminator 3 view .LVU19
 124 0010 0133     		adds	r3, r3, #1
 125              	.LVL3:
 126              	.L10:
 384:Core/Src/hall_detection.c **** 	for (uint32_t i = 0; i < messageLength; ++i) {
 127              		.loc 1 384 2 discriminator 1 view .LVU20
 128 0012 072B     		cmp	r3, #7
 129 0014 F8D9     		bls	.L11
 130              	.LBE2:
 131              	.LBB3:
ARM GAS  /tmp/ccJ2dceG.s 			page 10


 386:Core/Src/hall_detection.c **** 	}
 387:Core/Src/hall_detection.c **** 
 388:Core/Src/hall_detection.c **** 	for (uint32_t i = 0; i < NUMBEROFPHASES; ++i) {
 132              		.loc 1 388 16 view .LVU21
 133 0016 0023     		movs	r3, #0
 134              	.LVL4:
 135              		.loc 1 388 16 view .LVU22
 136 0018 19E0     		b	.L12
 137              	.LVL5:
 138              	.L13:
 389:Core/Src/hall_detection.c **** 		if(gen->results[gen->indexOfcorrectResult].hall_order[i]==hall_A){
 390:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='A';
 391:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->indexOfcorrectResult].hall_order[i]==hall_B){
 139              		.loc 1 391 9 is_stmt 1 view .LVU23
 140              		.loc 1 391 62 is_stmt 0 view .LVU24
 141 001a 01EB0210 		add	r0, r1, r2, lsl #4
 142 001e 1844     		add	r0, r0, r3
 143 0020 90F86401 		ldrb	r0, [r0, #356]	@ zero_extendqisi2
 144              		.loc 1 391 11 view .LVU25
 145 0024 0128     		cmp	r0, #1
 146 0026 08D0     		beq	.L20
 392:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='B';
 393:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->indexOfcorrectResult].hall_order[i]==hall_C){
 147              		.loc 1 393 9 is_stmt 1 view .LVU26
 148              		.loc 1 393 11 is_stmt 0 view .LVU27
 149 0028 0228     		cmp	r0, #2
 150 002a 21D1     		bne	.L14
 394:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='C';
 151              		.loc 1 394 4 is_stmt 1 view .LVU28
 152              		.loc 1 394 19 is_stmt 0 view .LVU29
 153 002c 5800     		lsls	r0, r3, #1
 154              		.loc 1 394 22 view .LVU30
 155 002e 0130     		adds	r0, r0, #1
 156              		.loc 1 394 25 view .LVU31
 157 0030 0844     		add	r0, r0, r1
 158 0032 4325     		movs	r5, #67
 159 0034 80F8BC51 		strb	r5, [r0, #444]
 160 0038 1AE0     		b	.L14
 161              	.L20:
 392:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='B';
 162              		.loc 1 392 4 is_stmt 1 view .LVU32
 392:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='B';
 163              		.loc 1 392 19 is_stmt 0 view .LVU33
 164 003a 5800     		lsls	r0, r3, #1
 392:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='B';
 165              		.loc 1 392 22 view .LVU34
 166 003c 0130     		adds	r0, r0, #1
 392:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='B';
 167              		.loc 1 392 25 view .LVU35
 168 003e 0844     		add	r0, r0, r1
 169 0040 4225     		movs	r5, #66
 170 0042 80F8BC51 		strb	r5, [r0, #444]
 171 0046 13E0     		b	.L14
 172              	.L16:
 395:Core/Src/hall_detection.c **** 		}
 396:Core/Src/hall_detection.c **** 
 397:Core/Src/hall_detection.c **** 		if(gen->results[gen->indexOfcorrectResult].hall_polarity[i]==hall_direct){
ARM GAS  /tmp/ccJ2dceG.s 			page 11


 398:Core/Src/hall_detection.c **** 			gen->message[i*2]=' ';
 399:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->indexOfcorrectResult].hall_polarity[i]==hall_inverse){
 173              		.loc 1 399 9 is_stmt 1 view .LVU36
 174              		.loc 1 399 11 is_stmt 0 view .LVU37
 175 0048 012A     		cmp	r2, #1
 176 004a 1ED0     		beq	.L21
 177              	.L17:
 388:Core/Src/hall_detection.c **** 		if(gen->results[gen->indexOfcorrectResult].hall_order[i]==hall_A){
 178              		.loc 1 388 43 discriminator 2 view .LVU38
 179 004c 0133     		adds	r3, r3, #1
 180              	.LVL6:
 181              	.L12:
 388:Core/Src/hall_detection.c **** 		if(gen->results[gen->indexOfcorrectResult].hall_order[i]==hall_A){
 182              		.loc 1 388 2 discriminator 1 view .LVU39
 183 004e 022B     		cmp	r3, #2
 184 0050 21D8     		bhi	.L22
 389:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='A';
 185              		.loc 1 389 3 is_stmt 1 view .LVU40
 389:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='A';
 186              		.loc 1 389 22 is_stmt 0 view .LVU41
 187 0052 D1F85821 		ldr	r2, [r1, #344]
 389:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='A';
 188              		.loc 1 389 56 view .LVU42
 189 0056 01EB0210 		add	r0, r1, r2, lsl #4
 190 005a 1844     		add	r0, r0, r3
 191 005c 90F86401 		ldrb	r0, [r0, #356]	@ zero_extendqisi2
 389:Core/Src/hall_detection.c **** 			gen->message[(i*2)+1]='A';
 192              		.loc 1 389 5 view .LVU43
 193 0060 0028     		cmp	r0, #0
 194 0062 DAD1     		bne	.L13
 390:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->indexOfcorrectResult].hall_order[i]==hall_B){
 195              		.loc 1 390 4 is_stmt 1 view .LVU44
 390:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->indexOfcorrectResult].hall_order[i]==hall_B){
 196              		.loc 1 390 19 is_stmt 0 view .LVU45
 197 0064 5800     		lsls	r0, r3, #1
 390:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->indexOfcorrectResult].hall_order[i]==hall_B){
 198              		.loc 1 390 22 view .LVU46
 199 0066 0130     		adds	r0, r0, #1
 390:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->indexOfcorrectResult].hall_order[i]==hall_B){
 200              		.loc 1 390 25 view .LVU47
 201 0068 0844     		add	r0, r0, r1
 202 006a 4125     		movs	r5, #65
 203 006c 80F8BC51 		strb	r5, [r0, #444]
 204              	.L14:
 397:Core/Src/hall_detection.c **** 			gen->message[i*2]=' ';
 205              		.loc 1 397 3 is_stmt 1 view .LVU48
 397:Core/Src/hall_detection.c **** 			gen->message[i*2]=' ';
 206              		.loc 1 397 59 is_stmt 0 view .LVU49
 207 0070 01EB0212 		add	r2, r1, r2, lsl #4
 208 0074 1A44     		add	r2, r2, r3
 209 0076 92F86721 		ldrb	r2, [r2, #359]	@ zero_extendqisi2
 397:Core/Src/hall_detection.c **** 			gen->message[i*2]=' ';
 210              		.loc 1 397 5 view .LVU50
 211 007a 002A     		cmp	r2, #0
 212 007c E4D1     		bne	.L16
 398:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->indexOfcorrectResult].hall_polarity[i]==hall_inverse){
 213              		.loc 1 398 4 is_stmt 1 view .LVU51
ARM GAS  /tmp/ccJ2dceG.s 			page 12


 398:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->indexOfcorrectResult].hall_polarity[i]==hall_inverse){
 214              		.loc 1 398 21 is_stmt 0 view .LVU52
 215 007e 01EB4302 		add	r2, r1, r3, lsl #1
 216 0082 2020     		movs	r0, #32
 217 0084 82F8BC01 		strb	r0, [r2, #444]
 218 0088 E0E7     		b	.L17
 219              	.L21:
 400:Core/Src/hall_detection.c **** 			gen->message[i*2]='!';
 220              		.loc 1 400 4 is_stmt 1 view .LVU53
 221              		.loc 1 400 21 is_stmt 0 view .LVU54
 222 008a 01EB4302 		add	r2, r1, r3, lsl #1
 223 008e 2120     		movs	r0, #33
 224 0090 82F8BC01 		strb	r0, [r2, #444]
 225 0094 DAE7     		b	.L17
 226              	.L22:
 227              		.loc 1 400 21 view .LVU55
 228              	.LBE3:
 401:Core/Src/hall_detection.c **** 		}
 402:Core/Src/hall_detection.c **** 	}
 403:Core/Src/hall_detection.c **** 
 404:Core/Src/hall_detection.c **** 	gen->message[messageLength-2]='\n';//two last characters
 229              		.loc 1 404 2 is_stmt 1 view .LVU56
 230              		.loc 1 404 31 is_stmt 0 view .LVU57
 231 0096 0A23     		movs	r3, #10
 232              	.LVL7:
 233              		.loc 1 404 31 view .LVU58
 234 0098 81F8C231 		strb	r3, [r1, #450]
 405:Core/Src/hall_detection.c **** 	gen->message[messageLength-1]='\r';
 235              		.loc 1 405 2 is_stmt 1 view .LVU59
 236              		.loc 1 405 31 is_stmt 0 view .LVU60
 237 009c 0D23     		movs	r3, #13
 238 009e 81F8C331 		strb	r3, [r1, #451]
 406:Core/Src/hall_detection.c **** 
 407:Core/Src/hall_detection.c **** 
 408:Core/Src/hall_detection.c **** #ifdef TESTuart
 409:Core/Src/hall_detection.c **** 	HAL_UART_Transmit(&huart2, (const uint8_t *)&general.message, messageLength,100);
 239              		.loc 1 409 2 is_stmt 1 view .LVU61
 240 00a2 6423     		movs	r3, #100
 241 00a4 0822     		movs	r2, #8
 242 00a6 0349     		ldr	r1, .L23
 243              	.LVL8:
 244              		.loc 1 409 2 is_stmt 0 view .LVU62
 245 00a8 0348     		ldr	r0, .L23+4
 246 00aa FFF7FEFF 		bl	HAL_UART_Transmit
 247              	.LVL9:
 410:Core/Src/hall_detection.c **** #endif
 411:Core/Src/hall_detection.c **** 
 412:Core/Src/hall_detection.c **** 	*state=detection_DISABLED;
 248              		.loc 1 412 2 is_stmt 1 view .LVU63
 249              		.loc 1 412 8 is_stmt 0 view .LVU64
 250 00ae 0023     		movs	r3, #0
 251 00b0 2370     		strb	r3, [r4]
 413:Core/Src/hall_detection.c **** }
 252              		.loc 1 413 1 view .LVU65
 253 00b2 38BD     		pop	{r3, r4, r5, pc}
 254              	.LVL10:
 255              	.L24:
ARM GAS  /tmp/ccJ2dceG.s 			page 13


 256              		.loc 1 413 1 view .LVU66
 257              		.align	2
 258              	.L23:
 259 00b4 BC010000 		.word	.LANCHOR1+444
 260 00b8 00000000 		.word	huart2
 261              		.cfi_endproc
 262              	.LFE242:
 264              		.section	.text.fill_buffers,"ax",%progbits
 265              		.align	1
 266              		.global	fill_buffers
 267              		.syntax unified
 268              		.thumb
 269              		.thumb_func
 270              		.fpu fpv4-sp-d16
 272              	fill_buffers:
 273              	.LVL11:
 274              	.LFB243:
 414:Core/Src/hall_detection.c **** 
 415:Core/Src/hall_detection.c **** /**
 416:Core/Src/hall_detection.c **** * \brief these buffers need to be filled, not much to this function, manages the "circularity" of t
 417:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 418:Core/Src/hall_detection.c **** * \param hall_pin_info * H1_gpio, pointer to gpio info about the hall A
 419:Core/Src/hall_detection.c **** * \param hall_pin_info * H2_gpio, pointer to gpio info about the hall B
 420:Core/Src/hall_detection.c **** * \param hall_pin_info * H3_gpio, pointer to gpio info about the hall C
 421:Core/Src/hall_detection.c **** * \param volatile float* ADCcurr1, pointer to current value in amps for phase A
 422:Core/Src/hall_detection.c **** * \param volatile float* ADCcurr2, pointer to current value in amps for phase C? or B?
 423:Core/Src/hall_detection.c **** */
 424:Core/Src/hall_detection.c **** void fill_buffers(
 425:Core/Src/hall_detection.c **** 		hall_detection_general_struct *gen,
 426:Core/Src/hall_detection.c **** 		hall_pin_info* H1_gpio,
 427:Core/Src/hall_detection.c **** 		hall_pin_info* H2_gpio,
 428:Core/Src/hall_detection.c **** 		hall_pin_info* H3_gpio,
 429:Core/Src/hall_detection.c **** 		volatile float* ADCcurr1,
 430:Core/Src/hall_detection.c **** 		volatile float* ADCcurr2
 431:Core/Src/hall_detection.c **** 		){
 275              		.loc 1 431 4 is_stmt 1 view -0
 276              		.cfi_startproc
 277              		@ args = 8, pretend = 0, frame = 0
 278              		@ frame_needed = 0, uses_anonymous_args = 0
 279              		@ link register save eliminated.
 280              		.loc 1 431 4 is_stmt 0 view .LVU68
 281 0000 70B4     		push	{r4, r5, r6}
 282              	.LCFI1:
 283              		.cfi_def_cfa_offset 12
 284              		.cfi_offset 4, -12
 285              		.cfi_offset 5, -8
 286              		.cfi_offset 6, -4
 287 0002 039D     		ldr	r5, [sp, #12]
 288 0004 049C     		ldr	r4, [sp, #16]
 432:Core/Src/hall_detection.c **** 
 433:Core/Src/hall_detection.c **** #ifdef REAL_PHASES_A_B_calculated_C
 434:Core/Src/hall_detection.c **** 	gen->currA.two_samples_buffer[1]=gen->currA.two_samples_buffer[0];
 435:Core/Src/hall_detection.c **** 	gen->currA.two_samples_buffer[0]= *ADCcurr1; //i suspect ADC measurements are one sample late, bec
 436:Core/Src/hall_detection.c **** 
 437:Core/Src/hall_detection.c **** 	gen->currB.two_samples_buffer[1]=gen->currB.two_samples_buffer[0];
 438:Core/Src/hall_detection.c **** 	gen->currB.two_samples_buffer[0]= *ADCcurr2;
 439:Core/Src/hall_detection.c **** 	//c=-a-b, NO REAL MEASUREMENT OF CURRENT C, assuming ABC currents ortogonality:
ARM GAS  /tmp/ccJ2dceG.s 			page 14


 440:Core/Src/hall_detection.c **** 	gen->currC.two_samples_buffer[1]=gen->currC.two_samples_buffer[0];
 441:Core/Src/hall_detection.c **** 	gen->currC.two_samples_buffer[0]= currentAplusBplusC-*ADCcurr1-*ADCcurr2;
 442:Core/Src/hall_detection.c **** #endif
 443:Core/Src/hall_detection.c **** 
 444:Core/Src/hall_detection.c **** #ifdef REAL_PHASES_A_C_calculated_B
 445:Core/Src/hall_detection.c **** 	gen->currA.two_samples_buffer[1]=gen->currA.two_samples_buffer[0];
 289              		.loc 1 445 2 is_stmt 1 view .LVU69
 290              		.loc 1 445 64 is_stmt 0 view .LVU70
 291 0006 4668     		ldr	r6, [r0, #4]	@ float
 292              		.loc 1 445 34 view .LVU71
 293 0008 8660     		str	r6, [r0, #8]	@ float
 446:Core/Src/hall_detection.c **** 	gen->currA.two_samples_buffer[0]= *ADCcurr1;
 294              		.loc 1 446 2 is_stmt 1 view .LVU72
 295              		.loc 1 446 36 is_stmt 0 view .LVU73
 296 000a 2E68     		ldr	r6, [r5]	@ float
 297              		.loc 1 446 34 view .LVU74
 298 000c 4660     		str	r6, [r0, #4]	@ float
 447:Core/Src/hall_detection.c **** 	//b=-a-c, NO REAL MEASUREMENT OF CURRENT B, assuming ABC currents ortogonality:
 448:Core/Src/hall_detection.c **** 	gen->currB.two_samples_buffer[1]=gen->currB.two_samples_buffer[0];
 299              		.loc 1 448 2 is_stmt 1 view .LVU75
 300              		.loc 1 448 64 is_stmt 0 view .LVU76
 301 000e 066B     		ldr	r6, [r0, #48]	@ float
 302              		.loc 1 448 34 view .LVU77
 303 0010 4663     		str	r6, [r0, #52]	@ float
 449:Core/Src/hall_detection.c **** 	gen->currB.two_samples_buffer[0]= -*ADCcurr1-*ADCcurr2;
 304              		.loc 1 449 2 is_stmt 1 view .LVU78
 305              		.loc 1 449 37 is_stmt 0 view .LVU79
 306 0012 D5ED007A 		vldr.32	s15, [r5]
 307              		.loc 1 449 36 view .LVU80
 308 0016 F1EE677A 		vneg.f32	s15, s15
 309              		.loc 1 449 47 view .LVU81
 310 001a 94ED007A 		vldr.32	s14, [r4]
 311              		.loc 1 449 46 view .LVU82
 312 001e 77EEC77A 		vsub.f32	s15, s15, s14
 313              		.loc 1 449 34 view .LVU83
 314 0022 C0ED0C7A 		vstr.32	s15, [r0, #48]
 450:Core/Src/hall_detection.c **** 
 451:Core/Src/hall_detection.c **** 	gen->currC.two_samples_buffer[1]=gen->currC.two_samples_buffer[0];
 315              		.loc 1 451 2 is_stmt 1 view .LVU84
 316              		.loc 1 451 64 is_stmt 0 view .LVU85
 317 0026 C56D     		ldr	r5, [r0, #92]	@ float
 318              		.loc 1 451 34 view .LVU86
 319 0028 0566     		str	r5, [r0, #96]	@ float
 452:Core/Src/hall_detection.c **** 	gen->currC.two_samples_buffer[0]= *ADCcurr2;
 320              		.loc 1 452 2 is_stmt 1 view .LVU87
 321              		.loc 1 452 36 is_stmt 0 view .LVU88
 322 002a 2468     		ldr	r4, [r4]	@ float
 323              		.loc 1 452 34 view .LVU89
 324 002c C465     		str	r4, [r0, #92]	@ float
 453:Core/Src/hall_detection.c **** #endif
 454:Core/Src/hall_detection.c **** 
 455:Core/Src/hall_detection.c **** #ifdef REAL_PHASES_B_C_calculated_A
 456:Core/Src/hall_detection.c **** 	//a=-b-bc, NO REAL MEASUREMENT OF CURRENT A, assuming ABC currents ortogonality:
 457:Core/Src/hall_detection.c **** 	gen->currA.two_samples_buffer[1]=gen->currA.two_samples_buffer[0];
 458:Core/Src/hall_detection.c **** 	gen->currA.two_samples_buffer[0]= currentAplusBplusC-*ADCcurr1-*ADCcurr2;
 459:Core/Src/hall_detection.c **** 
 460:Core/Src/hall_detection.c **** 	gen->currB.two_samples_buffer[1]=gen->currB.two_samples_buffer[0];
ARM GAS  /tmp/ccJ2dceG.s 			page 15


 461:Core/Src/hall_detection.c **** 	gen->currB.two_samples_buffer[0]= *ADCcurr1;
 462:Core/Src/hall_detection.c **** 
 463:Core/Src/hall_detection.c **** 	gen->currC.two_samples_buffer[1]=gen->currC.two_samples_buffer[0];
 464:Core/Src/hall_detection.c **** 	gen->currC.two_samples_buffer[0]= *ADCcurr2;
 465:Core/Src/hall_detection.c **** #endif
 466:Core/Src/hall_detection.c **** 
 467:Core/Src/hall_detection.c **** 	gen->hallA.two_samples_buffer[1]=gen->hallA.two_samples_buffer[0];
 325              		.loc 1 467 2 is_stmt 1 view .LVU90
 326              		.loc 1 467 64 is_stmt 0 view .LVU91
 327 002e D0F88840 		ldr	r4, [r0, #136]	@ float
 328              		.loc 1 467 34 view .LVU92
 329 0032 C0F88C40 		str	r4, [r0, #140]	@ float
 468:Core/Src/hall_detection.c **** 	gen->hallA.two_samples_buffer[0]=(float) H1_gpio->state;
 330              		.loc 1 468 2 is_stmt 1 view .LVU93
 331              		.loc 1 468 50 is_stmt 0 view .LVU94
 332 0036 C979     		ldrb	r1, [r1, #7]	@ zero_extendqisi2
 333              	.LVL12:
 334              		.loc 1 468 50 view .LVU95
 335 0038 07EE901A 		vmov	s15, r1	@ int
 336              		.loc 1 468 35 view .LVU96
 337 003c F8EE677A 		vcvt.f32.u32	s15, s15
 338              		.loc 1 468 34 view .LVU97
 339 0040 C0ED227A 		vstr.32	s15, [r0, #136]
 469:Core/Src/hall_detection.c **** 
 470:Core/Src/hall_detection.c **** 	gen->hallB.two_samples_buffer[1]=gen->hallB.two_samples_buffer[0];
 340              		.loc 1 470 2 is_stmt 1 view .LVU98
 341              		.loc 1 470 64 is_stmt 0 view .LVU99
 342 0044 D0F8B410 		ldr	r1, [r0, #180]	@ float
 343              		.loc 1 470 34 view .LVU100
 344 0048 C0F8B810 		str	r1, [r0, #184]	@ float
 471:Core/Src/hall_detection.c **** 	gen->hallB.two_samples_buffer[0]=(float) H2_gpio->state;
 345              		.loc 1 471 2 is_stmt 1 view .LVU101
 346              		.loc 1 471 50 is_stmt 0 view .LVU102
 347 004c D279     		ldrb	r2, [r2, #7]	@ zero_extendqisi2
 348              	.LVL13:
 349              		.loc 1 471 50 view .LVU103
 350 004e 07EE902A 		vmov	s15, r2	@ int
 351              		.loc 1 471 35 view .LVU104
 352 0052 F8EE677A 		vcvt.f32.u32	s15, s15
 353              		.loc 1 471 34 view .LVU105
 354 0056 C0ED2D7A 		vstr.32	s15, [r0, #180]
 472:Core/Src/hall_detection.c **** 
 473:Core/Src/hall_detection.c **** 	gen->hallC.two_samples_buffer[1]=gen->hallC.two_samples_buffer[0];
 355              		.loc 1 473 2 is_stmt 1 view .LVU106
 356              		.loc 1 473 64 is_stmt 0 view .LVU107
 357 005a D0F8E020 		ldr	r2, [r0, #224]	@ float
 358              		.loc 1 473 34 view .LVU108
 359 005e C0F8E420 		str	r2, [r0, #228]	@ float
 474:Core/Src/hall_detection.c **** 	gen->hallC.two_samples_buffer[0]=(float) H3_gpio->state;
 360              		.loc 1 474 2 is_stmt 1 view .LVU109
 361              		.loc 1 474 50 is_stmt 0 view .LVU110
 362 0062 DB79     		ldrb	r3, [r3, #7]	@ zero_extendqisi2
 363              	.LVL14:
 364              		.loc 1 474 50 view .LVU111
 365 0064 07EE903A 		vmov	s15, r3	@ int
 366              		.loc 1 474 35 view .LVU112
 367 0068 F8EE677A 		vcvt.f32.u32	s15, s15
ARM GAS  /tmp/ccJ2dceG.s 			page 16


 368              		.loc 1 474 34 view .LVU113
 369 006c C0ED387A 		vstr.32	s15, [r0, #224]
 475:Core/Src/hall_detection.c **** }
 370              		.loc 1 475 1 view .LVU114
 371 0070 70BC     		pop	{r4, r5, r6}
 372              	.LCFI2:
 373              		.cfi_restore 6
 374              		.cfi_restore 5
 375              		.cfi_restore 4
 376              		.cfi_def_cfa_offset 0
 377              	.LVL15:
 378              		.loc 1 475 1 view .LVU115
 379 0072 7047     		bx	lr
 380              		.cfi_endproc
 381              	.LFE243:
 383              		.section	.text.detect_N_current_zerocrossings,"ax",%progbits
 384              		.align	1
 385              		.global	detect_N_current_zerocrossings
 386              		.syntax unified
 387              		.thumb
 388              		.thumb_func
 389              		.fpu fpv4-sp-d16
 391              	detect_N_current_zerocrossings:
 392              	.LVL16:
 393              	.LFB245:
 476:Core/Src/hall_detection.c **** 
 477:Core/Src/hall_detection.c **** /**
 478:Core/Src/hall_detection.c **** * \brief reading the buffers we just filled detects if a zero crossing happened in between them, it
 479:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 480:Core/Src/hall_detection.c **** * \return YES//done detecting or NO//still ongoing
 481:Core/Src/hall_detection.c **** */
 482:Core/Src/hall_detection.c **** detection_YES_NO detect_N_zerocrossings(hall_detection_general_struct *gen,uint32_t N){
 483:Core/Src/hall_detection.c **** 	if((ticks-general.start_adquisition_ticks)>2){ //skip the first two samples to fill the buffers
 484:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currA,MAXZEROCROSSI
 485:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currB,MAXZEROCROSSI
 486:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currC,MAXZEROCROSSI
 487:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallA,MAXZEROCROSSING
 488:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallB,MAXZEROCROSSING
 489:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallC,MAXZEROCROSSING
 490:Core/Src/hall_detection.c **** 	}
 491:Core/Src/hall_detection.c **** 	if(//if all buffers are full
 492:Core/Src/hall_detection.c **** 			(gen->currA.numberof_zerocrossings>=N) &&
 493:Core/Src/hall_detection.c **** 			(gen->currB.numberof_zerocrossings>=N) &&
 494:Core/Src/hall_detection.c **** 			(gen->currC.numberof_zerocrossings>=N) &&
 495:Core/Src/hall_detection.c **** 			(gen->hallA.numberof_zerocrossings>=N) &&
 496:Core/Src/hall_detection.c **** 			(gen->hallB.numberof_zerocrossings>=N) &&
 497:Core/Src/hall_detection.c **** 			(gen->hallC.numberof_zerocrossings>=N)
 498:Core/Src/hall_detection.c **** 			){
 499:Core/Src/hall_detection.c **** 		return YES;//done detecting
 500:Core/Src/hall_detection.c **** 	}else{
 501:Core/Src/hall_detection.c **** 		return NO;//still ongoing
 502:Core/Src/hall_detection.c **** 	}
 503:Core/Src/hall_detection.c **** }
 504:Core/Src/hall_detection.c **** 
 505:Core/Src/hall_detection.c **** /**
 506:Core/Src/hall_detection.c **** * \brief reading the current buffers detects 0 crossings and takes notes of the tick number.
 507:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
ARM GAS  /tmp/ccJ2dceG.s 			page 17


 508:Core/Src/hall_detection.c **** */
 509:Core/Src/hall_detection.c **** void detect_N_current_zerocrossings(uint32_t ticks,current_or_hall_measurements_struct* currx,uint3
 394              		.loc 1 509 106 is_stmt 1 view -0
 395              		.cfi_startproc
 396              		@ args = 0, pretend = 0, frame = 0
 397              		@ frame_needed = 0, uses_anonymous_args = 0
 398              		@ link register save eliminated.
 510:Core/Src/hall_detection.c **** 	if(	   (((currx->two_samples_buffer[0]-currentADCoffset)*
 399              		.loc 1 510 2 view .LVU117
 400              		.loc 1 510 37 is_stmt 0 view .LVU118
 401 0000 D1ED007A 		vldr.32	s15, [r1]
 511:Core/Src/hall_detection.c **** 			 (currx->two_samples_buffer[1]-currentADCoffset))<=0)
 402              		.loc 1 511 31 view .LVU119
 403 0004 91ED017A 		vldr.32	s14, [r1, #4]
 510:Core/Src/hall_detection.c **** 	if(	   (((currx->two_samples_buffer[0]-currentADCoffset)*
 404              		.loc 1 510 58 view .LVU120
 405 0008 67EE877A 		vmul.f32	s15, s15, s14
 510:Core/Src/hall_detection.c **** 	if(	   (((currx->two_samples_buffer[0]-currentADCoffset)*
 406              		.loc 1 510 4 view .LVU121
 407 000c F5EEC07A 		vcmpe.f32	s15, #0
 408 0010 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 409 0014 00D9     		bls	.L42
 410              	.LVL17:
 411              	.L27:
 512:Core/Src/hall_detection.c **** 			 && currx->numberof_zerocrossings<N
 513:Core/Src/hall_detection.c **** 			){
 514:Core/Src/hall_detection.c **** 
 515:Core/Src/hall_detection.c **** 		if(currx->numberof_zerocrossings==0){			//only if this is the first zerocrossing detected
 516:Core/Src/hall_detection.c **** 					currx->zerocrossings_tick[currx->numberof_zerocrossings]=ticks;
 517:Core/Src/hall_detection.c **** 					if(currx->two_samples_buffer[0]>currx->two_samples_buffer[1]){
 518:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 519:Core/Src/hall_detection.c **** 					}else{
 520:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=falling_polarity;
 521:Core/Src/hall_detection.c **** 					}
 522:Core/Src/hall_detection.c **** 					currx->numberof_zerocrossings++;
 523:Core/Src/hall_detection.c **** 		}else{
 524:Core/Src/hall_detection.c **** 			if((int32_t)(ticks-(currx->zerocrossings_tick[currx->numberof_zerocrossings-1]))>lowpassfilter_t
 525:Core/Src/hall_detection.c **** 					currx->zerocrossings_tick[currx->numberof_zerocrossings]=ticks;
 526:Core/Src/hall_detection.c **** 					if(currx->two_samples_buffer[0]>currx->two_samples_buffer[1]){
 527:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 528:Core/Src/hall_detection.c **** 					}else{
 529:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=falling_polarity;
 530:Core/Src/hall_detection.c **** 					}
 531:Core/Src/hall_detection.c **** 					currx->numberof_zerocrossings++;
 532:Core/Src/hall_detection.c **** 			}
 533:Core/Src/hall_detection.c **** 		}
 534:Core/Src/hall_detection.c **** 	}
 535:Core/Src/hall_detection.c **** }
 412              		.loc 1 535 1 view .LVU122
 413 0016 7047     		bx	lr
 414              	.LVL18:
 415              	.L42:
 512:Core/Src/hall_detection.c **** 			 && currx->numberof_zerocrossings<N
 416              		.loc 1 512 13 view .LVU123
 417 0018 8B6A     		ldr	r3, [r1, #40]
 512:Core/Src/hall_detection.c **** 			 && currx->numberof_zerocrossings<N
 418              		.loc 1 512 5 view .LVU124
ARM GAS  /tmp/ccJ2dceG.s 			page 18


 419 001a 9342     		cmp	r3, r2
 420 001c FBD2     		bcs	.L27
 515:Core/Src/hall_detection.c **** 					currx->zerocrossings_tick[currx->numberof_zerocrossings]=ticks;
 421              		.loc 1 515 3 is_stmt 1 view .LVU125
 515:Core/Src/hall_detection.c **** 					currx->zerocrossings_tick[currx->numberof_zerocrossings]=ticks;
 422              		.loc 1 515 5 is_stmt 0 view .LVU126
 423 001e BBB9     		cbnz	r3, .L30
 516:Core/Src/hall_detection.c **** 					if(currx->two_samples_buffer[0]>currx->two_samples_buffer[1]){
 424              		.loc 1 516 6 is_stmt 1 view .LVU127
 516:Core/Src/hall_detection.c **** 					if(currx->two_samples_buffer[0]>currx->two_samples_buffer[1]){
 425              		.loc 1 516 62 is_stmt 0 view .LVU128
 426 0020 9A1C     		adds	r2, r3, #2
 427              	.LVL19:
 516:Core/Src/hall_detection.c **** 					if(currx->two_samples_buffer[0]>currx->two_samples_buffer[1]){
 428              		.loc 1 516 62 view .LVU129
 429 0022 41F82200 		str	r0, [r1, r2, lsl #2]
 517:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 430              		.loc 1 517 6 is_stmt 1 view .LVU130
 517:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 431              		.loc 1 517 34 is_stmt 0 view .LVU131
 432 0026 91ED007A 		vldr.32	s14, [r1]
 517:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 433              		.loc 1 517 63 view .LVU132
 434 002a D1ED017A 		vldr.32	s15, [r1, #4]
 517:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 435              		.loc 1 517 8 view .LVU133
 436 002e B4EEE77A 		vcmpe.f32	s14, s15
 437 0032 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 438 0036 06DD     		ble	.L40
 518:Core/Src/hall_detection.c **** 					}else{
 439              		.loc 1 518 7 is_stmt 1 view .LVU134
 518:Core/Src/hall_detection.c **** 					}else{
 440              		.loc 1 518 67 is_stmt 0 view .LVU135
 441 0038 CA18     		adds	r2, r1, r3
 442 003a 0020     		movs	r0, #0
 443              	.LVL20:
 518:Core/Src/hall_detection.c **** 					}else{
 444              		.loc 1 518 67 view .LVU136
 445 003c 82F82000 		strb	r0, [r2, #32]
 446              	.LVL21:
 447              	.L33:
 522:Core/Src/hall_detection.c **** 		}else{
 448              		.loc 1 522 6 is_stmt 1 view .LVU137
 522:Core/Src/hall_detection.c **** 		}else{
 449              		.loc 1 522 35 is_stmt 0 view .LVU138
 450 0040 0133     		adds	r3, r3, #1
 451 0042 8B62     		str	r3, [r1, #40]
 452 0044 7047     		bx	lr
 453              	.LVL22:
 454              	.L40:
 520:Core/Src/hall_detection.c **** 					}
 455              		.loc 1 520 7 is_stmt 1 view .LVU139
 520:Core/Src/hall_detection.c **** 					}
 456              		.loc 1 520 67 is_stmt 0 view .LVU140
 457 0046 CA18     		adds	r2, r1, r3
 458 0048 0120     		movs	r0, #1
 459              	.LVL23:
ARM GAS  /tmp/ccJ2dceG.s 			page 19


 520:Core/Src/hall_detection.c **** 					}
 460              		.loc 1 520 67 view .LVU141
 461 004a 82F82000 		strb	r0, [r2, #32]
 462              	.LVL24:
 520:Core/Src/hall_detection.c **** 					}
 463              		.loc 1 520 67 view .LVU142
 464 004e F7E7     		b	.L33
 465              	.LVL25:
 466              	.L30:
 524:Core/Src/hall_detection.c **** 					currx->zerocrossings_tick[currx->numberof_zerocrossings]=ticks;
 467              		.loc 1 524 4 is_stmt 1 view .LVU143
 524:Core/Src/hall_detection.c **** 					currx->zerocrossings_tick[currx->numberof_zerocrossings]=ticks;
 468              		.loc 1 524 49 is_stmt 0 view .LVU144
 469 0050 5A1C     		adds	r2, r3, #1
 470              	.LVL26:
 524:Core/Src/hall_detection.c **** 					currx->zerocrossings_tick[currx->numberof_zerocrossings]=ticks;
 471              		.loc 1 524 49 view .LVU145
 472 0052 51F82220 		ldr	r2, [r1, r2, lsl #2]
 524:Core/Src/hall_detection.c **** 					currx->zerocrossings_tick[currx->numberof_zerocrossings]=ticks;
 473              		.loc 1 524 22 view .LVU146
 474 0056 821A     		subs	r2, r0, r2
 524:Core/Src/hall_detection.c **** 					currx->zerocrossings_tick[currx->numberof_zerocrossings]=ticks;
 475              		.loc 1 524 6 view .LVU147
 476 0058 0F2A     		cmp	r2, #15
 477 005a DCDD     		ble	.L27
 525:Core/Src/hall_detection.c **** 					if(currx->two_samples_buffer[0]>currx->two_samples_buffer[1]){
 478              		.loc 1 525 6 is_stmt 1 view .LVU148
 525:Core/Src/hall_detection.c **** 					if(currx->two_samples_buffer[0]>currx->two_samples_buffer[1]){
 479              		.loc 1 525 62 is_stmt 0 view .LVU149
 480 005c 9A1C     		adds	r2, r3, #2
 481 005e 41F82200 		str	r0, [r1, r2, lsl #2]
 526:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 482              		.loc 1 526 6 is_stmt 1 view .LVU150
 526:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 483              		.loc 1 526 34 is_stmt 0 view .LVU151
 484 0062 91ED007A 		vldr.32	s14, [r1]
 526:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 485              		.loc 1 526 63 view .LVU152
 486 0066 D1ED017A 		vldr.32	s15, [r1, #4]
 526:Core/Src/hall_detection.c **** 						currx->zerocrossings_polarity[currx->numberof_zerocrossings]=rising_polarity;
 487              		.loc 1 526 8 view .LVU153
 488 006a B4EEE77A 		vcmpe.f32	s14, s15
 489 006e F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 490 0072 06DD     		ble	.L41
 527:Core/Src/hall_detection.c **** 					}else{
 491              		.loc 1 527 7 is_stmt 1 view .LVU154
 527:Core/Src/hall_detection.c **** 					}else{
 492              		.loc 1 527 67 is_stmt 0 view .LVU155
 493 0074 CA18     		adds	r2, r1, r3
 494 0076 0020     		movs	r0, #0
 495              	.LVL27:
 527:Core/Src/hall_detection.c **** 					}else{
 496              		.loc 1 527 67 view .LVU156
 497 0078 82F82000 		strb	r0, [r2, #32]
 498              	.LVL28:
 499              	.L36:
 531:Core/Src/hall_detection.c **** 			}
ARM GAS  /tmp/ccJ2dceG.s 			page 20


 500              		.loc 1 531 6 is_stmt 1 view .LVU157
 531:Core/Src/hall_detection.c **** 			}
 501              		.loc 1 531 35 is_stmt 0 view .LVU158
 502 007c 0133     		adds	r3, r3, #1
 503 007e 8B62     		str	r3, [r1, #40]
 504              		.loc 1 535 1 view .LVU159
 505 0080 C9E7     		b	.L27
 506              	.LVL29:
 507              	.L41:
 529:Core/Src/hall_detection.c **** 					}
 508              		.loc 1 529 7 is_stmt 1 view .LVU160
 529:Core/Src/hall_detection.c **** 					}
 509              		.loc 1 529 67 is_stmt 0 view .LVU161
 510 0082 CA18     		adds	r2, r1, r3
 511 0084 0120     		movs	r0, #1
 512              	.LVL30:
 529:Core/Src/hall_detection.c **** 					}
 513              		.loc 1 529 67 view .LVU162
 514 0086 82F82000 		strb	r0, [r2, #32]
 515              	.LVL31:
 529:Core/Src/hall_detection.c **** 					}
 516              		.loc 1 529 67 view .LVU163
 517 008a F7E7     		b	.L36
 518              		.cfi_endproc
 519              	.LFE245:
 521              		.section	.text.detect_N_hall_zerocrossings,"ax",%progbits
 522              		.align	1
 523              		.global	detect_N_hall_zerocrossings
 524              		.syntax unified
 525              		.thumb
 526              		.thumb_func
 527              		.fpu fpv4-sp-d16
 529              	detect_N_hall_zerocrossings:
 530              	.LVL32:
 531              	.LFB246:
 536:Core/Src/hall_detection.c **** 
 537:Core/Src/hall_detection.c **** /**
 538:Core/Src/hall_detection.c **** * \brief similar to detect_N_current_zerocrossings() reading the hall buffers detects logic changes
 539:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 540:Core/Src/hall_detection.c **** */
 541:Core/Src/hall_detection.c **** void detect_N_hall_zerocrossings(uint32_t ticks,current_or_hall_measurements_struct* hallx,uint32_t
 532              		.loc 1 541 103 is_stmt 1 view -0
 533              		.cfi_startproc
 534              		@ args = 0, pretend = 0, frame = 0
 535              		@ frame_needed = 0, uses_anonymous_args = 0
 536              		@ link register save eliminated.
 542:Core/Src/hall_detection.c **** 	if(
 537              		.loc 1 542 2 view .LVU165
 543:Core/Src/hall_detection.c **** 		hallx->two_samples_buffer[0]!=hallx->two_samples_buffer[1]
 538              		.loc 1 543 28 is_stmt 0 view .LVU166
 539 0000 91ED007A 		vldr.32	s14, [r1]
 540              		.loc 1 543 58 view .LVU167
 541 0004 D1ED017A 		vldr.32	s15, [r1, #4]
 542:Core/Src/hall_detection.c **** 	if(
 542              		.loc 1 542 4 view .LVU168
 543 0008 B4EE677A 		vcmp.f32	s14, s15
 544 000c F1EE10FA 		vmrs	APSR_nzcv, FPSCR
ARM GAS  /tmp/ccJ2dceG.s 			page 21


 545 0010 12D0     		beq	.L43
 544:Core/Src/hall_detection.c **** 		&& hallx->numberof_zerocrossings<N)
 546              		.loc 1 544 11 view .LVU169
 547 0012 8B6A     		ldr	r3, [r1, #40]
 548              		.loc 1 544 3 view .LVU170
 549 0014 9342     		cmp	r3, r2
 550 0016 0FD2     		bcs	.L43
 545:Core/Src/hall_detection.c **** 	{
 546:Core/Src/hall_detection.c **** 			hallx->zerocrossings_tick[hallx->numberof_zerocrossings]=ticks;
 551              		.loc 1 546 4 is_stmt 1 view .LVU171
 552              		.loc 1 546 60 is_stmt 0 view .LVU172
 553 0018 9A1C     		adds	r2, r3, #2
 554              	.LVL33:
 555              		.loc 1 546 60 view .LVU173
 556 001a 41F82200 		str	r0, [r1, r2, lsl #2]
 547:Core/Src/hall_detection.c **** 			if(hallx->two_samples_buffer[0]!=0){
 557              		.loc 1 547 4 is_stmt 1 view .LVU174
 558              		.loc 1 547 32 is_stmt 0 view .LVU175
 559 001e D1ED007A 		vldr.32	s15, [r1]
 560              		.loc 1 547 6 view .LVU176
 561 0022 F5EE407A 		vcmp.f32	s15, #0
 562 0026 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 563 002a 06D0     		beq	.L45
 548:Core/Src/hall_detection.c **** 				hallx->zerocrossings_polarity[hallx->numberof_zerocrossings]=rising_polarity;
 564              		.loc 1 548 5 is_stmt 1 view .LVU177
 565              		.loc 1 548 65 is_stmt 0 view .LVU178
 566 002c CA18     		adds	r2, r1, r3
 567 002e 0020     		movs	r0, #0
 568              	.LVL34:
 569              		.loc 1 548 65 view .LVU179
 570 0030 82F82000 		strb	r0, [r2, #32]
 571              	.LVL35:
 572              	.L46:
 549:Core/Src/hall_detection.c **** 			}else{
 550:Core/Src/hall_detection.c **** 				hallx->zerocrossings_polarity[hallx->numberof_zerocrossings]=falling_polarity;
 551:Core/Src/hall_detection.c **** 			}
 552:Core/Src/hall_detection.c **** 			hallx->numberof_zerocrossings++;
 573              		.loc 1 552 4 is_stmt 1 view .LVU180
 574              		.loc 1 552 33 is_stmt 0 view .LVU181
 575 0034 0133     		adds	r3, r3, #1
 576 0036 8B62     		str	r3, [r1, #40]
 577              	.L43:
 553:Core/Src/hall_detection.c **** 	}
 554:Core/Src/hall_detection.c **** }
 578              		.loc 1 554 1 view .LVU182
 579 0038 7047     		bx	lr
 580              	.LVL36:
 581              	.L45:
 550:Core/Src/hall_detection.c **** 			}
 582              		.loc 1 550 5 is_stmt 1 view .LVU183
 550:Core/Src/hall_detection.c **** 			}
 583              		.loc 1 550 65 is_stmt 0 view .LVU184
 584 003a CA18     		adds	r2, r1, r3
 585 003c 0120     		movs	r0, #1
 586              	.LVL37:
 550:Core/Src/hall_detection.c **** 			}
 587              		.loc 1 550 65 view .LVU185
ARM GAS  /tmp/ccJ2dceG.s 			page 22


 588 003e 82F82000 		strb	r0, [r2, #32]
 589              	.LVL38:
 550:Core/Src/hall_detection.c **** 			}
 590              		.loc 1 550 65 view .LVU186
 591 0042 F7E7     		b	.L46
 592              		.cfi_endproc
 593              	.LFE246:
 595              		.section	.text.detect_N_zerocrossings,"ax",%progbits
 596              		.align	1
 597              		.global	detect_N_zerocrossings
 598              		.syntax unified
 599              		.thumb
 600              		.thumb_func
 601              		.fpu fpv4-sp-d16
 603              	detect_N_zerocrossings:
 604              	.LVL39:
 605              	.LFB244:
 482:Core/Src/hall_detection.c **** 	if((ticks-general.start_adquisition_ticks)>2){ //skip the first two samples to fill the buffers
 606              		.loc 1 482 87 is_stmt 1 view -0
 607              		.cfi_startproc
 608              		@ args = 0, pretend = 0, frame = 0
 609              		@ frame_needed = 0, uses_anonymous_args = 0
 482:Core/Src/hall_detection.c **** 	if((ticks-general.start_adquisition_ticks)>2){ //skip the first two samples to fill the buffers
 610              		.loc 1 482 87 is_stmt 0 view .LVU188
 611 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 612              	.LCFI3:
 613              		.cfi_def_cfa_offset 24
 614              		.cfi_offset 3, -24
 615              		.cfi_offset 4, -20
 616              		.cfi_offset 5, -16
 617              		.cfi_offset 6, -12
 618              		.cfi_offset 7, -8
 619              		.cfi_offset 14, -4
 620 0002 0446     		mov	r4, r0
 621 0004 0D46     		mov	r5, r1
 483:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currA,MAXZEROCROSSI
 622              		.loc 1 483 2 is_stmt 1 view .LVU189
 483:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currA,MAXZEROCROSSI
 623              		.loc 1 483 19 is_stmt 0 view .LVU190
 624 0006 2D4B     		ldr	r3, .L58
 625 0008 1B68     		ldr	r3, [r3]
 483:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currA,MAXZEROCROSSI
 626              		.loc 1 483 11 view .LVU191
 627 000a 2D4A     		ldr	r2, .L58+4
 628 000c 1068     		ldr	r0, [r2]
 629              	.LVL40:
 483:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currA,MAXZEROCROSSI
 630              		.loc 1 483 11 view .LVU192
 631 000e C01A     		subs	r0, r0, r3
 483:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currA,MAXZEROCROSSI
 632              		.loc 1 483 4 view .LVU193
 633 0010 0228     		cmp	r0, #2
 634 0012 17D8     		bhi	.L57
 635              	.LVL41:
 636              	.L48:
 491:Core/Src/hall_detection.c **** 			(gen->currA.numberof_zerocrossings>=N) &&
 637              		.loc 1 491 2 is_stmt 1 view .LVU194
ARM GAS  /tmp/ccJ2dceG.s 			page 23


 492:Core/Src/hall_detection.c **** 			(gen->currB.numberof_zerocrossings>=N) &&
 638              		.loc 1 492 15 is_stmt 0 view .LVU195
 639 0014 E36A     		ldr	r3, [r4, #44]
 491:Core/Src/hall_detection.c **** 			(gen->currA.numberof_zerocrossings>=N) &&
 640              		.loc 1 491 4 view .LVU196
 641 0016 AB42     		cmp	r3, r5
 642 0018 43D3     		bcc	.L50
 493:Core/Src/hall_detection.c **** 			(gen->currC.numberof_zerocrossings>=N) &&
 643              		.loc 1 493 15 view .LVU197
 644 001a A36D     		ldr	r3, [r4, #88]
 492:Core/Src/hall_detection.c **** 			(gen->currB.numberof_zerocrossings>=N) &&
 645              		.loc 1 492 43 view .LVU198
 646 001c AB42     		cmp	r3, r5
 647 001e 42D3     		bcc	.L51
 494:Core/Src/hall_detection.c **** 			(gen->hallA.numberof_zerocrossings>=N) &&
 648              		.loc 1 494 15 view .LVU199
 649 0020 D4F88430 		ldr	r3, [r4, #132]
 493:Core/Src/hall_detection.c **** 			(gen->currC.numberof_zerocrossings>=N) &&
 650              		.loc 1 493 43 view .LVU200
 651 0024 AB42     		cmp	r3, r5
 652 0026 40D3     		bcc	.L52
 495:Core/Src/hall_detection.c **** 			(gen->hallB.numberof_zerocrossings>=N) &&
 653              		.loc 1 495 15 view .LVU201
 654 0028 D4F8B030 		ldr	r3, [r4, #176]
 494:Core/Src/hall_detection.c **** 			(gen->hallA.numberof_zerocrossings>=N) &&
 655              		.loc 1 494 43 view .LVU202
 656 002c AB42     		cmp	r3, r5
 657 002e 3ED3     		bcc	.L53
 496:Core/Src/hall_detection.c **** 			(gen->hallC.numberof_zerocrossings>=N)
 658              		.loc 1 496 15 view .LVU203
 659 0030 D4F8DC30 		ldr	r3, [r4, #220]
 495:Core/Src/hall_detection.c **** 			(gen->hallB.numberof_zerocrossings>=N) &&
 660              		.loc 1 495 43 view .LVU204
 661 0034 AB42     		cmp	r3, r5
 662 0036 3CD3     		bcc	.L54
 497:Core/Src/hall_detection.c **** 			){
 663              		.loc 1 497 15 view .LVU205
 664 0038 D4F80831 		ldr	r3, [r4, #264]
 496:Core/Src/hall_detection.c **** 			(gen->hallC.numberof_zerocrossings>=N)
 665              		.loc 1 496 43 view .LVU206
 666 003c AB42     		cmp	r3, r5
 667 003e 3AD2     		bcs	.L55
 501:Core/Src/hall_detection.c **** 	}
 668              		.loc 1 501 10 view .LVU207
 669 0040 0020     		movs	r0, #0
 670 0042 2FE0     		b	.L49
 671              	.LVL42:
 672              	.L57:
 484:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currB,MAXZEROCROSSI
 673              		.loc 1 484 3 is_stmt 1 view .LVU208
 674 0044 0622     		movs	r2, #6
 675 0046 211D     		adds	r1, r4, #4
 676              	.LVL43:
 484:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currB,MAXZEROCROSSI
 677              		.loc 1 484 3 is_stmt 0 view .LVU209
 678 0048 FFF7FEFF 		bl	detect_N_current_zerocrossings
 679              	.LVL44:
ARM GAS  /tmp/ccJ2dceG.s 			page 24


 485:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currC,MAXZEROCROSSI
 680              		.loc 1 485 3 is_stmt 1 view .LVU210
 485:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currC,MAXZEROCROSSI
 681              		.loc 1 485 49 is_stmt 0 view .LVU211
 682 004c 1B4F     		ldr	r7, .L58
 683 004e 3B68     		ldr	r3, [r7]
 485:Core/Src/hall_detection.c **** 		detect_N_current_zerocrossings	((ticks-general.start_adquisition_ticks),&gen->currC,MAXZEROCROSSI
 684              		.loc 1 485 3 view .LVU212
 685 0050 1B4E     		ldr	r6, .L58+4
 686 0052 3068     		ldr	r0, [r6]
 687 0054 0622     		movs	r2, #6
 688 0056 04F13001 		add	r1, r4, #48
 689 005a C01A     		subs	r0, r0, r3
 690 005c FFF7FEFF 		bl	detect_N_current_zerocrossings
 691              	.LVL45:
 486:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallA,MAXZEROCROSSING
 692              		.loc 1 486 3 is_stmt 1 view .LVU213
 486:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallA,MAXZEROCROSSING
 693              		.loc 1 486 49 is_stmt 0 view .LVU214
 694 0060 3B68     		ldr	r3, [r7]
 486:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallA,MAXZEROCROSSING
 695              		.loc 1 486 3 view .LVU215
 696 0062 3068     		ldr	r0, [r6]
 697 0064 0622     		movs	r2, #6
 698 0066 04F15C01 		add	r1, r4, #92
 699 006a C01A     		subs	r0, r0, r3
 700 006c FFF7FEFF 		bl	detect_N_current_zerocrossings
 701              	.LVL46:
 487:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallB,MAXZEROCROSSING
 702              		.loc 1 487 3 is_stmt 1 view .LVU216
 487:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallB,MAXZEROCROSSING
 703              		.loc 1 487 47 is_stmt 0 view .LVU217
 704 0070 3B68     		ldr	r3, [r7]
 487:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallB,MAXZEROCROSSING
 705              		.loc 1 487 3 view .LVU218
 706 0072 3068     		ldr	r0, [r6]
 707 0074 0622     		movs	r2, #6
 708 0076 04F18801 		add	r1, r4, #136
 709 007a C01A     		subs	r0, r0, r3
 710 007c FFF7FEFF 		bl	detect_N_hall_zerocrossings
 711              	.LVL47:
 488:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallC,MAXZEROCROSSING
 712              		.loc 1 488 3 is_stmt 1 view .LVU219
 488:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallC,MAXZEROCROSSING
 713              		.loc 1 488 47 is_stmt 0 view .LVU220
 714 0080 3B68     		ldr	r3, [r7]
 488:Core/Src/hall_detection.c **** 		detect_N_hall_zerocrossings		((ticks-general.start_adquisition_ticks),&gen->hallC,MAXZEROCROSSING
 715              		.loc 1 488 3 view .LVU221
 716 0082 3068     		ldr	r0, [r6]
 717 0084 0622     		movs	r2, #6
 718 0086 04F1B401 		add	r1, r4, #180
 719 008a C01A     		subs	r0, r0, r3
 720 008c FFF7FEFF 		bl	detect_N_hall_zerocrossings
 721              	.LVL48:
 489:Core/Src/hall_detection.c **** 	}
 722              		.loc 1 489 3 is_stmt 1 view .LVU222
 489:Core/Src/hall_detection.c **** 	}
ARM GAS  /tmp/ccJ2dceG.s 			page 25


 723              		.loc 1 489 47 is_stmt 0 view .LVU223
 724 0090 3B68     		ldr	r3, [r7]
 489:Core/Src/hall_detection.c **** 	}
 725              		.loc 1 489 3 view .LVU224
 726 0092 3068     		ldr	r0, [r6]
 727 0094 0622     		movs	r2, #6
 728 0096 04F1E001 		add	r1, r4, #224
 729 009a C01A     		subs	r0, r0, r3
 730 009c FFF7FEFF 		bl	detect_N_hall_zerocrossings
 731              	.LVL49:
 732 00a0 B8E7     		b	.L48
 733              	.L50:
 501:Core/Src/hall_detection.c **** 	}
 734              		.loc 1 501 10 view .LVU225
 735 00a2 0020     		movs	r0, #0
 736              	.L49:
 503:Core/Src/hall_detection.c **** 
 737              		.loc 1 503 1 view .LVU226
 738 00a4 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 739              	.LVL50:
 740              	.L51:
 501:Core/Src/hall_detection.c **** 	}
 741              		.loc 1 501 10 view .LVU227
 742 00a6 0020     		movs	r0, #0
 743 00a8 FCE7     		b	.L49
 744              	.L52:
 745 00aa 0020     		movs	r0, #0
 746 00ac FAE7     		b	.L49
 747              	.L53:
 748 00ae 0020     		movs	r0, #0
 749 00b0 F8E7     		b	.L49
 750              	.L54:
 751 00b2 0020     		movs	r0, #0
 752 00b4 F6E7     		b	.L49
 753              	.L55:
 499:Core/Src/hall_detection.c **** 	}else{
 754              		.loc 1 499 10 view .LVU228
 755 00b6 0120     		movs	r0, #1
 756 00b8 F4E7     		b	.L49
 757              	.L59:
 758 00ba 00BF     		.align	2
 759              	.L58:
 760 00bc 00000000 		.word	.LANCHOR1
 761 00c0 00000000 		.word	ticks
 762              		.cfi_endproc
 763              	.LFE244:
 765              		.section	.text.calculateElectricPeriod_inTicks,"ax",%progbits
 766              		.align	1
 767              		.global	calculateElectricPeriod_inTicks
 768              		.syntax unified
 769              		.thumb
 770              		.thumb_func
 771              		.fpu fpv4-sp-d16
 773              	calculateElectricPeriod_inTicks:
 774              	.LVL51:
 775              	.LFB247:
 555:Core/Src/hall_detection.c **** 
ARM GAS  /tmp/ccJ2dceG.s 			page 26


 556:Core/Src/hall_detection.c **** /**
 557:Core/Src/hall_detection.c **** * \brief reading differences between noted ticks zerocrossigns averages our motor electric period
 558:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 559:Core/Src/hall_detection.c **** * \param samples number of zerocrossings to be used in the diff calculation
 560:Core/Src/hall_detection.c **** */
 561:Core/Src/hall_detection.c **** void calculateElectricPeriod_inTicks(hall_detection_general_struct *gen, uint32_t samples){
 776              		.loc 1 561 91 is_stmt 1 view -0
 777              		.cfi_startproc
 778              		@ args = 0, pretend = 0, frame = 0
 779              		@ frame_needed = 0, uses_anonymous_args = 0
 780              		@ link register save eliminated.
 781              		.loc 1 561 91 is_stmt 0 view .LVU230
 782 0000 30B4     		push	{r4, r5}
 783              	.LCFI4:
 784              		.cfi_def_cfa_offset 8
 785              		.cfi_offset 4, -8
 786              		.cfi_offset 5, -4
 562:Core/Src/hall_detection.c **** 	uint32_t averagedsemiPeriod=0;
 787              		.loc 1 562 2 is_stmt 1 view .LVU231
 788              	.LVL52:
 563:Core/Src/hall_detection.c **** 	for (uint32_t i = 0; i < samples-1; ++i) {
 789              		.loc 1 563 2 view .LVU232
 790              	.LBB4:
 791              		.loc 1 563 7 view .LVU233
 792              		.loc 1 563 16 is_stmt 0 view .LVU234
 793 0002 0023     		movs	r3, #0
 794              	.LBE4:
 562:Core/Src/hall_detection.c **** 	uint32_t averagedsemiPeriod=0;
 795              		.loc 1 562 11 view .LVU235
 796 0004 1A46     		mov	r2, r3
 797              	.LVL53:
 798              	.L61:
 799              	.LBB5:
 800              		.loc 1 563 34 discriminator 1 view .LVU236
 801 0006 4C1E     		subs	r4, r1, #1
 802              		.loc 1 563 2 discriminator 1 view .LVU237
 803 0008 9C42     		cmp	r4, r3
 804 000a 35D9     		bls	.L64
 564:Core/Src/hall_detection.c **** 		averagedsemiPeriod+=(gen->currA.zerocrossings_tick[i+1]-gen->currA.zerocrossings_tick[i]);
 805              		.loc 1 564 3 is_stmt 1 discriminator 3 view .LVU238
 806              		.loc 1 564 53 is_stmt 0 discriminator 3 view .LVU239
 807 000c DC1C     		adds	r4, r3, #3
 808 000e 00EB8404 		add	r4, r0, r4, lsl #2
 809 0012 6468     		ldr	r4, [r4, #4]
 810              		.loc 1 564 88 discriminator 3 view .LVU240
 811 0014 9D1C     		adds	r5, r3, #2
 812 0016 00EB8505 		add	r5, r0, r5, lsl #2
 813 001a 6D68     		ldr	r5, [r5, #4]
 814              		.loc 1 564 58 discriminator 3 view .LVU241
 815 001c 641B     		subs	r4, r4, r5
 816              		.loc 1 564 21 discriminator 3 view .LVU242
 817 001e 2244     		add	r2, r2, r4
 818              	.LVL54:
 565:Core/Src/hall_detection.c **** 		averagedsemiPeriod+=(gen->currB.zerocrossings_tick[i+1]-gen->currB.zerocrossings_tick[i]);
 819              		.loc 1 565 3 is_stmt 1 discriminator 3 view .LVU243
 820              		.loc 1 565 53 is_stmt 0 discriminator 3 view .LVU244
 821 0020 03F10F04 		add	r4, r3, #15
ARM GAS  /tmp/ccJ2dceG.s 			page 27


 822 0024 50F82440 		ldr	r4, [r0, r4, lsl #2]
 823              		.loc 1 565 88 discriminator 3 view .LVU245
 824 0028 03F10E05 		add	r5, r3, #14
 825 002c 50F82550 		ldr	r5, [r0, r5, lsl #2]
 826              		.loc 1 565 58 discriminator 3 view .LVU246
 827 0030 641B     		subs	r4, r4, r5
 828              		.loc 1 565 21 discriminator 3 view .LVU247
 829 0032 2244     		add	r2, r2, r4
 830              	.LVL55:
 566:Core/Src/hall_detection.c **** 		averagedsemiPeriod+=(gen->hallA.zerocrossings_tick[i+1]-gen->hallA.zerocrossings_tick[i]);
 831              		.loc 1 566 3 is_stmt 1 discriminator 3 view .LVU248
 832              		.loc 1 566 53 is_stmt 0 discriminator 3 view .LVU249
 833 0034 03F12504 		add	r4, r3, #37
 834 0038 50F82440 		ldr	r4, [r0, r4, lsl #2]
 835              		.loc 1 566 88 discriminator 3 view .LVU250
 836 003c 03F12405 		add	r5, r3, #36
 837 0040 50F82550 		ldr	r5, [r0, r5, lsl #2]
 838              		.loc 1 566 58 discriminator 3 view .LVU251
 839 0044 641B     		subs	r4, r4, r5
 840              		.loc 1 566 21 discriminator 3 view .LVU252
 841 0046 1444     		add	r4, r4, r2
 842              	.LVL56:
 567:Core/Src/hall_detection.c **** 		averagedsemiPeriod+=(gen->hallB.zerocrossings_tick[i+1]-gen->hallB.zerocrossings_tick[i]);
 843              		.loc 1 567 3 is_stmt 1 discriminator 3 view .LVU253
 844              		.loc 1 567 53 is_stmt 0 discriminator 3 view .LVU254
 845 0048 03F12F02 		add	r2, r3, #47
 846 004c 00EB8202 		add	r2, r0, r2, lsl #2
 847 0050 5268     		ldr	r2, [r2, #4]
 848              		.loc 1 567 88 discriminator 3 view .LVU255
 849 0052 03F12E05 		add	r5, r3, #46
 850 0056 00EB8505 		add	r5, r0, r5, lsl #2
 851 005a 6D68     		ldr	r5, [r5, #4]
 852              		.loc 1 567 58 discriminator 3 view .LVU256
 853 005c 521B     		subs	r2, r2, r5
 854              		.loc 1 567 21 discriminator 3 view .LVU257
 855 005e 1444     		add	r4, r4, r2
 856              	.LVL57:
 568:Core/Src/hall_detection.c **** 		averagedsemiPeriod+=(gen->hallC.zerocrossings_tick[i+1]-gen->hallC.zerocrossings_tick[i]);
 857              		.loc 1 568 3 is_stmt 1 discriminator 3 view .LVU258
 858              		.loc 1 568 53 is_stmt 0 discriminator 3 view .LVU259
 859 0060 03F13B02 		add	r2, r3, #59
 860 0064 50F82220 		ldr	r2, [r0, r2, lsl #2]
 861              		.loc 1 568 88 discriminator 3 view .LVU260
 862 0068 03F13A05 		add	r5, r3, #58
 863 006c 50F82550 		ldr	r5, [r0, r5, lsl #2]
 864              		.loc 1 568 58 discriminator 3 view .LVU261
 865 0070 521B     		subs	r2, r2, r5
 866              		.loc 1 568 21 discriminator 3 view .LVU262
 867 0072 2244     		add	r2, r2, r4
 868              	.LVL58:
 563:Core/Src/hall_detection.c **** 		averagedsemiPeriod+=(gen->currA.zerocrossings_tick[i+1]-gen->currA.zerocrossings_tick[i]);
 869              		.loc 1 563 38 discriminator 3 view .LVU263
 870 0074 0133     		adds	r3, r3, #1
 871              	.LVL59:
 563:Core/Src/hall_detection.c **** 		averagedsemiPeriod+=(gen->currA.zerocrossings_tick[i+1]-gen->currA.zerocrossings_tick[i]);
 872              		.loc 1 563 38 discriminator 3 view .LVU264
 873 0076 C6E7     		b	.L61
ARM GAS  /tmp/ccJ2dceG.s 			page 28


 874              	.L64:
 563:Core/Src/hall_detection.c **** 		averagedsemiPeriod+=(gen->currA.zerocrossings_tick[i+1]-gen->currA.zerocrossings_tick[i]);
 875              		.loc 1 563 38 discriminator 3 view .LVU265
 876              	.LBE5:
 569:Core/Src/hall_detection.c **** 	}
 570:Core/Src/hall_detection.c **** 
 571:Core/Src/hall_detection.c **** 	averagedsemiPeriod/=(samples-1);
 877              		.loc 1 571 2 is_stmt 1 view .LVU266
 878              		.loc 1 571 20 is_stmt 0 view .LVU267
 879 0078 B2FBF4F3 		udiv	r3, r2, r4
 880              	.LVL60:
 572:Core/Src/hall_detection.c **** 	averagedsemiPeriod/=5;
 881              		.loc 1 572 2 is_stmt 1 view .LVU268
 882              		.loc 1 572 20 is_stmt 0 view .LVU269
 883 007c 064A     		ldr	r2, .L65
 884 007e A2FB0323 		umull	r2, r3, r2, r3
 885              	.LVL61:
 886              		.loc 1 572 20 view .LVU270
 887 0082 9B08     		lsrs	r3, r3, #2
 888              	.LVL62:
 573:Core/Src/hall_detection.c **** 	gen->results[gen->numberOfresults].electricPeriod_ticks=averagedsemiPeriod*2; //FOR torrot emulate
 889              		.loc 1 573 2 is_stmt 1 view .LVU271
 890              		.loc 1 573 18 is_stmt 0 view .LVU272
 891 0084 D0F85421 		ldr	r2, [r0, #340]
 892              		.loc 1 573 76 view .LVU273
 893 0088 5B00     		lsls	r3, r3, #1
 894              	.LVL63:
 895              		.loc 1 573 57 view .LVU274
 896 008a 00EB0210 		add	r0, r0, r2, lsl #4
 897              	.LVL64:
 898              		.loc 1 573 57 view .LVU275
 899 008e C0F86031 		str	r3, [r0, #352]
 574:Core/Src/hall_detection.c **** }
 900              		.loc 1 574 1 view .LVU276
 901 0092 30BC     		pop	{r4, r5}
 902              	.LCFI5:
 903              		.cfi_restore 5
 904              		.cfi_restore 4
 905              		.cfi_def_cfa_offset 0
 906 0094 7047     		bx	lr
 907              	.L66:
 908 0096 00BF     		.align	2
 909              	.L65:
 910 0098 CDCCCCCC 		.word	-858993459
 911              		.cfi_endproc
 912              	.LFE247:
 914              		.section	.text.adquisition,"ax",%progbits
 915              		.align	1
 916              		.global	adquisition
 917              		.syntax unified
 918              		.thumb
 919              		.thumb_func
 920              		.fpu fpv4-sp-d16
 922              	adquisition:
 923              	.LVL65:
 924              	.LFB239:
 272:Core/Src/hall_detection.c **** 
ARM GAS  /tmp/ccJ2dceG.s 			page 29


 925              		.loc 1 272 4 is_stmt 1 view -0
 926              		.cfi_startproc
 927              		@ args = 12, pretend = 0, frame = 0
 928              		@ frame_needed = 0, uses_anonymous_args = 0
 272:Core/Src/hall_detection.c **** 
 929              		.loc 1 272 4 is_stmt 0 view .LVU278
 930 0000 30B5     		push	{r4, r5, lr}
 931              	.LCFI6:
 932              		.cfi_def_cfa_offset 12
 933              		.cfi_offset 4, -12
 934              		.cfi_offset 5, -8
 935              		.cfi_offset 14, -4
 936 0002 83B0     		sub	sp, sp, #12
 937              	.LCFI7:
 938              		.cfi_def_cfa_offset 24
 939 0004 0546     		mov	r5, r0
 940 0006 0C46     		mov	r4, r1
 941 0008 1146     		mov	r1, r2
 942              	.LVL66:
 272:Core/Src/hall_detection.c **** 
 943              		.loc 1 272 4 view .LVU279
 944 000a 1A46     		mov	r2, r3
 945              	.LVL67:
 274:Core/Src/hall_detection.c **** 
 946              		.loc 1 274 2 is_stmt 1 view .LVU280
 947 000c 089B     		ldr	r3, [sp, #32]
 948              	.LVL68:
 274:Core/Src/hall_detection.c **** 
 949              		.loc 1 274 2 is_stmt 0 view .LVU281
 950 000e 0193     		str	r3, [sp, #4]
 951 0010 079B     		ldr	r3, [sp, #28]
 952 0012 0093     		str	r3, [sp]
 953 0014 069B     		ldr	r3, [sp, #24]
 954 0016 2046     		mov	r0, r4
 955              	.LVL69:
 274:Core/Src/hall_detection.c **** 
 956              		.loc 1 274 2 view .LVU282
 957 0018 FFF7FEFF 		bl	fill_buffers
 958              	.LVL70:
 277:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 959              		.loc 1 277 2 is_stmt 1 view .LVU283
 277:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 960              		.loc 1 277 11 is_stmt 0 view .LVU284
 961 001c 0D4B     		ldr	r3, .L73
 962 001e 1B68     		ldr	r3, [r3]
 277:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 963              		.loc 1 277 4 view .LVU285
 964 0020 0D4A     		ldr	r2, .L73+4
 965 0022 9342     		cmp	r3, r2
 966 0024 06D8     		bhi	.L71
 282:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,MAXZEROCROSSINGS)==YES){
 967              		.loc 1 282 2 is_stmt 1 view .LVU286
 282:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,MAXZEROCROSSINGS)==YES){
 968              		.loc 1 282 18 is_stmt 0 view .LVU287
 969 0026 0D4A     		ldr	r2, .L73+8
 970 0028 1268     		ldr	r2, [r2]
 282:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,MAXZEROCROSSINGS)==YES){
ARM GAS  /tmp/ccJ2dceG.s 			page 30


 971              		.loc 1 282 42 view .LVU288
 972 002a 0232     		adds	r2, r2, #2
 282:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,MAXZEROCROSSINGS)==YES){
 973              		.loc 1 282 4 view .LVU289
 974 002c 9342     		cmp	r3, r2
 975 002e 04D8     		bhi	.L72
 976              	.L67:
 288:Core/Src/hall_detection.c **** 
 977              		.loc 1 288 1 view .LVU290
 978 0030 03B0     		add	sp, sp, #12
 979              	.LCFI8:
 980              		.cfi_remember_state
 981              		.cfi_def_cfa_offset 12
 982              		@ sp needed
 983 0032 30BD     		pop	{r4, r5, pc}
 984              	.LVL71:
 985              	.L71:
 986              	.LCFI9:
 987              		.cfi_restore_state
 278:Core/Src/hall_detection.c **** 		return;
 988              		.loc 1 278 3 is_stmt 1 view .LVU291
 278:Core/Src/hall_detection.c **** 		return;
 989              		.loc 1 278 9 is_stmt 0 view .LVU292
 990 0034 0723     		movs	r3, #7
 991 0036 2B70     		strb	r3, [r5]
 279:Core/Src/hall_detection.c **** 	}
 992              		.loc 1 279 3 is_stmt 1 view .LVU293
 993 0038 FAE7     		b	.L67
 994              	.L72:
 283:Core/Src/hall_detection.c **** 			calculateElectricPeriod_inTicks(gen,MAXZEROCROSSINGS);
 995              		.loc 1 283 3 view .LVU294
 283:Core/Src/hall_detection.c **** 			calculateElectricPeriod_inTicks(gen,MAXZEROCROSSINGS);
 996              		.loc 1 283 6 is_stmt 0 view .LVU295
 997 003a 0621     		movs	r1, #6
 998 003c 2046     		mov	r0, r4
 999 003e FFF7FEFF 		bl	detect_N_zerocrossings
 1000              	.LVL72:
 283:Core/Src/hall_detection.c **** 			calculateElectricPeriod_inTicks(gen,MAXZEROCROSSINGS);
 1001              		.loc 1 283 5 view .LVU296
 1002 0042 0128     		cmp	r0, #1
 1003 0044 F4D1     		bne	.L67
 284:Core/Src/hall_detection.c **** 			*state=detection_INTERPRETATION;
 1004              		.loc 1 284 4 is_stmt 1 view .LVU297
 1005 0046 0621     		movs	r1, #6
 1006 0048 2046     		mov	r0, r4
 1007 004a FFF7FEFF 		bl	calculateElectricPeriod_inTicks
 1008              	.LVL73:
 285:Core/Src/hall_detection.c **** 		}
 1009              		.loc 1 285 4 view .LVU298
 285:Core/Src/hall_detection.c **** 		}
 1010              		.loc 1 285 10 is_stmt 0 view .LVU299
 1011 004e 0423     		movs	r3, #4
 1012 0050 2B70     		strb	r3, [r5]
 1013 0052 EDE7     		b	.L67
 1014              	.L74:
 1015              		.align	2
 1016              	.L73:
ARM GAS  /tmp/ccJ2dceG.s 			page 31


 1017 0054 00000000 		.word	ticks
 1018 0058 38900D00 		.word	888888
 1019 005c 00000000 		.word	.LANCHOR1
 1020              		.cfi_endproc
 1021              	.LFE239:
 1023              		.global	__aeabi_ui2d
 1024              		.global	__aeabi_dmul
 1025              		.global	__aeabi_d2f
 1026              		.section	.text.is_deviation_from_period_acceptable,"ax",%progbits
 1027              		.align	1
 1028              		.global	is_deviation_from_period_acceptable
 1029              		.syntax unified
 1030              		.thumb
 1031              		.thumb_func
 1032              		.fpu fpv4-sp-d16
 1034              	is_deviation_from_period_acceptable:
 1035              	.LVL74:
 1036              	.LFB248:
 575:Core/Src/hall_detection.c **** 
 576:Core/Src/hall_detection.c **** /**
 577:Core/Src/hall_detection.c **** * \brief just checks if all zerocrossings fall between acceptable deviation from average period.
 578:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 579:Core/Src/hall_detection.c **** * \param float tolerance_factor, 0.1 would mean +-10%tolerance of deviation from average
 580:Core/Src/hall_detection.c **** * \param samples number of zerocrossings to be used in the diff calculation
 581:Core/Src/hall_detection.c **** * \return YES if all deviations are accceptable, or NO if they are not
 582:Core/Src/hall_detection.c **** */
 583:Core/Src/hall_detection.c **** detection_YES_NO is_deviation_from_period_acceptable(hall_detection_general_struct *gen, float tole
 1037              		.loc 1 583 130 is_stmt 1 view -0
 1038              		.cfi_startproc
 1039              		@ args = 0, pretend = 0, frame = 0
 1040              		@ frame_needed = 0, uses_anonymous_args = 0
 1041              		.loc 1 583 130 is_stmt 0 view .LVU301
 1042 0000 70B5     		push	{r4, r5, r6, lr}
 1043              	.LCFI10:
 1044              		.cfi_def_cfa_offset 16
 1045              		.cfi_offset 4, -16
 1046              		.cfi_offset 5, -12
 1047              		.cfi_offset 6, -8
 1048              		.cfi_offset 14, -4
 1049 0002 2DED028B 		vpush.64	{d8}
 1050              	.LCFI11:
 1051              		.cfi_def_cfa_offset 24
 1052              		.cfi_offset 80, -24
 1053              		.cfi_offset 81, -20
 1054 0006 0446     		mov	r4, r0
 1055 0008 B0EE408A 		vmov.f32	s16, s0
 1056 000c 0D46     		mov	r5, r1
 584:Core/Src/hall_detection.c **** 	float _semiperiod=gen->results[gen->numberOfresults].electricPeriod_ticks/2.0;
 1057              		.loc 1 584 2 is_stmt 1 view .LVU302
 1058              		.loc 1 584 36 is_stmt 0 view .LVU303
 1059 000e D0F85431 		ldr	r3, [r0, #340]
 1060              		.loc 1 584 54 view .LVU304
 1061 0012 00EB0313 		add	r3, r0, r3, lsl #4
 1062              		.loc 1 584 75 view .LVU305
 1063 0016 D3F86001 		ldr	r0, [r3, #352]
 1064              	.LVL75:
 1065              		.loc 1 584 75 view .LVU306
ARM GAS  /tmp/ccJ2dceG.s 			page 32


 1066 001a FFF7FEFF 		bl	__aeabi_ui2d
 1067              	.LVL76:
 1068              		.loc 1 584 75 view .LVU307
 1069 001e 0022     		movs	r2, #0
 1070 0020 174B     		ldr	r3, .L83
 1071 0022 FFF7FEFF 		bl	__aeabi_dmul
 1072              	.LVL77:
 1073              		.loc 1 584 8 view .LVU308
 1074 0026 FFF7FEFF 		bl	__aeabi_d2f
 1075              	.LVL78:
 1076 002a 07EE900A 		vmov	s15, r0
 1077              	.LVL79:
 585:Core/Src/hall_detection.c **** 	uint32_t _deviation_top=	_semiperiod +_semiperiod*tolerance_factor;
 1078              		.loc 1 585 2 is_stmt 1 view .LVU309
 1079              		.loc 1 585 51 is_stmt 0 view .LVU310
 1080 002e 27EE880A 		vmul.f32	s0, s15, s16
 1081              		.loc 1 585 39 view .LVU311
 1082 0032 30EE277A 		vadd.f32	s14, s0, s15
 1083              		.loc 1 585 11 view .LVU312
 1084 0036 BCEEC77A 		vcvt.u32.f32	s14, s14
 1085 003a 17EE106A 		vmov	r6, s14	@ int
 1086              	.LVL80:
 586:Core/Src/hall_detection.c **** 	uint32_t _deviation_bottom=	_semiperiod	-_semiperiod*tolerance_factor;
 1087              		.loc 1 586 2 is_stmt 1 view .LVU313
 1088              		.loc 1 586 42 is_stmt 0 view .LVU314
 1089 003e 77EEC07A 		vsub.f32	s15, s15, s0
 1090              		.loc 1 586 11 view .LVU315
 1091 0042 FCEEE77A 		vcvt.u32.f32	s15, s15
 1092 0046 17EE900A 		vmov	r0, s15	@ int
 1093              	.LVL81:
 587:Core/Src/hall_detection.c **** 
 588:Core/Src/hall_detection.c **** 	for (uint32_t i = samples/2; i < samples-1; ++i) {
 1094              		.loc 1 588 2 is_stmt 1 view .LVU316
 1095              	.LBB6:
 1096              		.loc 1 588 7 view .LVU317
 1097              		.loc 1 588 16 is_stmt 0 view .LVU318
 1098 004a 6B08     		lsrs	r3, r5, #1
 1099              	.LVL82:
 1100              	.L76:
 1101              		.loc 1 588 42 discriminator 1 view .LVU319
 1102 004c 6A1E     		subs	r2, r5, #1
 1103              		.loc 1 588 2 discriminator 1 view .LVU320
 1104 004e 9A42     		cmp	r2, r3
 1105 0050 10D9     		bls	.L82
 1106              	.LBB7:
 589:Core/Src/hall_detection.c **** 		uint32_t _sampled_period=(gen->currA.zerocrossings_tick[i+1]-gen->currA.zerocrossings_tick[i]);
 1107              		.loc 1 589 3 is_stmt 1 view .LVU321
 1108              		.loc 1 589 60 is_stmt 0 view .LVU322
 1109 0052 591C     		adds	r1, r3, #1
 1110              		.loc 1 589 58 view .LVU323
 1111 0054 DA1C     		adds	r2, r3, #3
 1112 0056 04EB8202 		add	r2, r4, r2, lsl #2
 1113 005a 5268     		ldr	r2, [r2, #4]
 1114              		.loc 1 589 93 view .LVU324
 1115 005c 0233     		adds	r3, r3, #2
 1116              	.LVL83:
 1117              		.loc 1 589 93 view .LVU325
ARM GAS  /tmp/ccJ2dceG.s 			page 33


 1118 005e 04EB8303 		add	r3, r4, r3, lsl #2
 1119              	.LVL84:
 1120              		.loc 1 589 93 view .LVU326
 1121 0062 5B68     		ldr	r3, [r3, #4]
 1122              		.loc 1 589 12 view .LVU327
 1123 0064 D21A     		subs	r2, r2, r3
 1124              	.LVL85:
 590:Core/Src/hall_detection.c **** 		if((_sampled_period<(_deviation_bottom))||(_sampled_period>(_deviation_top))){
 1125              		.loc 1 590 3 is_stmt 1 view .LVU328
 1126              		.loc 1 590 5 is_stmt 0 view .LVU329
 1127 0066 9042     		cmp	r0, r2
 1128 0068 08D8     		bhi	.L79
 1129              	.LBE7:
 588:Core/Src/hall_detection.c **** 		uint32_t _sampled_period=(gen->currA.zerocrossings_tick[i+1]-gen->currA.zerocrossings_tick[i]);
 1130              		.loc 1 588 46 discriminator 1 view .LVU330
 1131 006a 0B46     		mov	r3, r1
 1132              	.LBB8:
 1133              		.loc 1 590 43 discriminator 1 view .LVU331
 1134 006c 9642     		cmp	r6, r2
 1135 006e EDD2     		bcs	.L76
 591:Core/Src/hall_detection.c **** 			return NO;//early return, bad news
 1136              		.loc 1 591 11 view .LVU332
 1137 0070 0020     		movs	r0, #0
 1138              	.LVL86:
 1139              		.loc 1 591 11 view .LVU333
 1140 0072 00E0     		b	.L77
 1141              	.LVL87:
 1142              	.L82:
 1143              		.loc 1 591 11 view .LVU334
 1144              	.LBE8:
 1145              	.LBE6:
 592:Core/Src/hall_detection.c **** 		}
 593:Core/Src/hall_detection.c **** 	}
 594:Core/Src/hall_detection.c **** 	return YES;//acceptable
 1146              		.loc 1 594 9 view .LVU335
 1147 0074 0120     		movs	r0, #1
 1148              	.LVL88:
 1149              	.L77:
 595:Core/Src/hall_detection.c **** }
 1150              		.loc 1 595 1 view .LVU336
 1151 0076 BDEC028B 		vldm	sp!, {d8}
 1152              	.LCFI12:
 1153              		.cfi_remember_state
 1154              		.cfi_restore 80
 1155              		.cfi_restore 81
 1156              		.cfi_def_cfa_offset 16
 1157              	.LVL89:
 1158              		.loc 1 595 1 view .LVU337
 1159 007a 70BD     		pop	{r4, r5, r6, pc}
 1160              	.LVL90:
 1161              	.L79:
 1162              	.LCFI13:
 1163              		.cfi_restore_state
 1164              	.LBB10:
 1165              	.LBB9:
 591:Core/Src/hall_detection.c **** 			return NO;//early return, bad news
 1166              		.loc 1 591 11 view .LVU338
ARM GAS  /tmp/ccJ2dceG.s 			page 34


 1167 007c 0020     		movs	r0, #0
 1168              	.LVL91:
 591:Core/Src/hall_detection.c **** 			return NO;//early return, bad news
 1169              		.loc 1 591 11 view .LVU339
 1170 007e FAE7     		b	.L77
 1171              	.L84:
 1172              		.align	2
 1173              	.L83:
 1174 0080 0000E03F 		.word	1071644672
 1175              	.LBE9:
 1176              	.LBE10:
 1177              		.cfi_endproc
 1178              	.LFE248:
 1180              		.section	.text.are_all_periods_stable,"ax",%progbits
 1181              		.align	1
 1182              		.global	are_all_periods_stable
 1183              		.syntax unified
 1184              		.thumb
 1185              		.thumb_func
 1186              		.fpu fpv4-sp-d16
 1188              	are_all_periods_stable:
 1189              	.LVL92:
 1190              	.LFB249:
 596:Core/Src/hall_detection.c **** 
 597:Core/Src/hall_detection.c **** 
 598:Core/Src/hall_detection.c **** /**
 599:Core/Src/hall_detection.c **** * \brief a wrapper to tidy up and make sure we calculate the electric period before calculating dev
 600:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 601:Core/Src/hall_detection.c **** * \param samples number of zerocrossings to be used in the diff calculation
 602:Core/Src/hall_detection.c **** * \return YES if we are in the stable zone of steady periods. NO otherwise
 603:Core/Src/hall_detection.c **** */
 604:Core/Src/hall_detection.c **** detection_YES_NO are_all_periods_stable(hall_detection_general_struct *gen, uint32_t samples){
 1191              		.loc 1 604 94 is_stmt 1 view -0
 1192              		.cfi_startproc
 1193              		@ args = 0, pretend = 0, frame = 0
 1194              		@ frame_needed = 0, uses_anonymous_args = 0
 1195              		.loc 1 604 94 is_stmt 0 view .LVU341
 1196 0000 38B5     		push	{r3, r4, r5, lr}
 1197              	.LCFI14:
 1198              		.cfi_def_cfa_offset 16
 1199              		.cfi_offset 3, -16
 1200              		.cfi_offset 4, -12
 1201              		.cfi_offset 5, -8
 1202              		.cfi_offset 14, -4
 1203 0002 0446     		mov	r4, r0
 1204 0004 0D46     		mov	r5, r1
 605:Core/Src/hall_detection.c **** 			calculateElectricPeriod_inTicks(gen,samples);
 1205              		.loc 1 605 4 is_stmt 1 view .LVU342
 1206 0006 FFF7FEFF 		bl	calculateElectricPeriod_inTicks
 1207              	.LVL93:
 606:Core/Src/hall_detection.c **** 	return 	is_deviation_from_period_acceptable(gen,TOLERANCE_FACTOR_FOR_STATIONARY_CURRENTS,samples);
 1208              		.loc 1 606 2 view .LVU343
 1209              		.loc 1 606 10 is_stmt 0 view .LVU344
 1210 000a 2946     		mov	r1, r5
 1211 000c B5EE000A 		vmov.f32	s0, #2.5e-1
 1212 0010 2046     		mov	r0, r4
 1213 0012 FFF7FEFF 		bl	is_deviation_from_period_acceptable
ARM GAS  /tmp/ccJ2dceG.s 			page 35


 1214              	.LVL94:
 607:Core/Src/hall_detection.c **** }
 1215              		.loc 1 607 1 view .LVU345
 1216 0016 38BD     		pop	{r3, r4, r5, pc}
 1217              		.loc 1 607 1 view .LVU346
 1218              		.cfi_endproc
 1219              	.LFE249:
 1221              		.section	.text.swap_hall_gpios_with_detected_results,"ax",%progbits
 1222              		.align	1
 1223              		.global	swap_hall_gpios_with_detected_results
 1224              		.syntax unified
 1225              		.thumb
 1226              		.thumb_func
 1227              		.fpu fpv4-sp-d16
 1229              	swap_hall_gpios_with_detected_results:
 1230              	.LVL95:
 1231              	.LFB250:
 608:Core/Src/hall_detection.c **** 
 609:Core/Src/hall_detection.c **** 
 610:Core/Src/hall_detection.c **** /**
 611:Core/Src/hall_detection.c **** * \brief
 612:Core/Src/hall_detection.c **** * \param
 613:Core/Src/hall_detection.c **** */
 614:Core/Src/hall_detection.c **** void swap_hall_gpios_with_detected_results(
 615:Core/Src/hall_detection.c **** 		hall_detection_general_struct *gen,
 616:Core/Src/hall_detection.c **** 		hall_pin_info* pin_infoH1,
 617:Core/Src/hall_detection.c **** 		hall_pin_info* pin_infoH2,
 618:Core/Src/hall_detection.c **** 		hall_pin_info* pin_infoH3
 619:Core/Src/hall_detection.c **** 		){
 1232              		.loc 1 619 4 is_stmt 1 view -0
 1233              		.cfi_startproc
 1234              		@ args = 0, pretend = 0, frame = 24
 1235              		@ frame_needed = 0, uses_anonymous_args = 0
 1236              		@ link register save eliminated.
 1237              		.loc 1 619 4 is_stmt 0 view .LVU348
 1238 0000 70B4     		push	{r4, r5, r6}
 1239              	.LCFI15:
 1240              		.cfi_def_cfa_offset 12
 1241              		.cfi_offset 4, -12
 1242              		.cfi_offset 5, -8
 1243              		.cfi_offset 6, -4
 1244 0002 87B0     		sub	sp, sp, #28
 1245              	.LCFI16:
 1246              		.cfi_def_cfa_offset 40
 1247 0004 0446     		mov	r4, r0
 1248 0006 0D46     		mov	r5, r1
 620:Core/Src/hall_detection.c **** 	hall_pin_info old_pin_infoH1=*pin_infoH1;
 1249              		.loc 1 620 2 is_stmt 1 view .LVU349
 1250              		.loc 1 620 16 is_stmt 0 view .LVU350
 1251 0008 D1E90001 		ldrd	r0, r1, [r1]
 1252              	.LVL96:
 1253              		.loc 1 620 16 view .LVU351
 1254 000c 06AE     		add	r6, sp, #24
 1255 000e 06E90300 		stmdb	r6, {r0, r1}
 621:Core/Src/hall_detection.c **** 	hall_pin_info old_pin_infoH2=*pin_infoH2;
 1256              		.loc 1 621 2 is_stmt 1 view .LVU352
 1257              		.loc 1 621 16 is_stmt 0 view .LVU353
ARM GAS  /tmp/ccJ2dceG.s 			page 36


 1258 0012 02AE     		add	r6, sp, #8
 1259 0014 92E80300 		ldm	r2, {r0, r1}
 1260 0018 86E80300 		stm	r6, {r0, r1}
 622:Core/Src/hall_detection.c **** 	hall_pin_info old_pin_infoH3=*pin_infoH3;
 1261              		.loc 1 622 2 is_stmt 1 view .LVU354
 1262              		.loc 1 622 16 is_stmt 0 view .LVU355
 1263 001c 6E46     		mov	r6, sp
 1264 001e 93E80300 		ldm	r3, {r0, r1}
 1265 0022 86E80300 		stm	r6, {r0, r1}
 623:Core/Src/hall_detection.c **** 
 624:Core/Src/hall_detection.c **** 	switch (gen->results[gen->indexOfcorrectResult].hall_order[phase_A]) {
 1266              		.loc 1 624 2 is_stmt 1 view .LVU356
 1267              		.loc 1 624 26 is_stmt 0 view .LVU357
 1268 0026 D4F85811 		ldr	r1, [r4, #344]
 1269              		.loc 1 624 60 view .LVU358
 1270 002a 1631     		adds	r1, r1, #22
 1271 002c 04EB0111 		add	r1, r4, r1, lsl #4
 1272 0030 0979     		ldrb	r1, [r1, #4]	@ zero_extendqisi2
 1273              		.loc 1 624 2 view .LVU359
 1274 0032 0129     		cmp	r1, #1
 1275 0034 24D0     		beq	.L88
 1276 0036 48B2     		sxtb	r0, r1
 1277 0038 E0B1     		cbz	r0, .L89
 1278 003a 0229     		cmp	r1, #2
 1279 003c 26D0     		beq	.L90
 1280              	.L91:
 625:Core/Src/hall_detection.c **** 		case hall_A:
 626:Core/Src/hall_detection.c **** 			*pin_infoH1=old_pin_infoH1;
 627:Core/Src/hall_detection.c **** 			break;
 628:Core/Src/hall_detection.c **** 		case hall_B:
 629:Core/Src/hall_detection.c **** 			*pin_infoH2=old_pin_infoH1;
 630:Core/Src/hall_detection.c **** 			break;
 631:Core/Src/hall_detection.c **** 		case hall_C:
 632:Core/Src/hall_detection.c **** 			*pin_infoH3=old_pin_infoH1;
 633:Core/Src/hall_detection.c **** 			break;
 634:Core/Src/hall_detection.c **** 		default:
 635:Core/Src/hall_detection.c **** 			break;
 636:Core/Src/hall_detection.c **** 	}
 637:Core/Src/hall_detection.c **** 
 638:Core/Src/hall_detection.c **** 	switch (gen->results[gen->indexOfcorrectResult].hall_order[phase_B]) {
 1281              		.loc 1 638 2 is_stmt 1 view .LVU360
 1282              		.loc 1 638 26 is_stmt 0 view .LVU361
 1283 003e D4F85811 		ldr	r1, [r4, #344]
 1284              		.loc 1 638 60 view .LVU362
 1285 0042 04EB0111 		add	r1, r4, r1, lsl #4
 1286 0046 91F86511 		ldrb	r1, [r1, #357]	@ zero_extendqisi2
 1287              		.loc 1 638 2 view .LVU363
 1288 004a 0129     		cmp	r1, #1
 1289 004c 29D0     		beq	.L92
 1290 004e 48B2     		sxtb	r0, r1
 1291 0050 10B3     		cbz	r0, .L93
 1292 0052 0229     		cmp	r1, #2
 1293 0054 2AD0     		beq	.L94
 1294              	.L95:
 639:Core/Src/hall_detection.c **** 		case hall_A:
 640:Core/Src/hall_detection.c **** 			*pin_infoH1=old_pin_infoH2;
 641:Core/Src/hall_detection.c **** 			break;
ARM GAS  /tmp/ccJ2dceG.s 			page 37


 642:Core/Src/hall_detection.c **** 		case hall_B:
 643:Core/Src/hall_detection.c **** 			*pin_infoH2=old_pin_infoH2;
 644:Core/Src/hall_detection.c **** 			break;
 645:Core/Src/hall_detection.c **** 		case hall_C:
 646:Core/Src/hall_detection.c **** 			*pin_infoH3=old_pin_infoH2;
 647:Core/Src/hall_detection.c **** 			break;
 648:Core/Src/hall_detection.c **** 		default:
 649:Core/Src/hall_detection.c **** 			break;
 650:Core/Src/hall_detection.c **** 	}
 651:Core/Src/hall_detection.c **** 
 652:Core/Src/hall_detection.c **** 	switch (gen->results[gen->indexOfcorrectResult].hall_order[phase_C]) {
 1295              		.loc 1 652 2 is_stmt 1 view .LVU364
 1296              		.loc 1 652 26 is_stmt 0 view .LVU365
 1297 0056 D4F85811 		ldr	r1, [r4, #344]
 1298              		.loc 1 652 60 view .LVU366
 1299 005a 04EB0114 		add	r4, r4, r1, lsl #4
 1300              	.LVL97:
 1301              		.loc 1 652 60 view .LVU367
 1302 005e 94F86611 		ldrb	r1, [r4, #358]	@ zero_extendqisi2
 1303              		.loc 1 652 2 view .LVU368
 1304 0062 0129     		cmp	r1, #1
 1305 0064 2DD0     		beq	.L96
 1306 0066 4AB2     		sxtb	r2, r1
 1307              	.LVL98:
 1308              		.loc 1 652 2 view .LVU369
 1309 0068 2AB3     		cbz	r2, .L97
 1310 006a 0229     		cmp	r1, #2
 1311 006c 2FD0     		beq	.L98
 1312              	.LVL99:
 1313              	.L87:
 653:Core/Src/hall_detection.c **** 		case hall_A:
 654:Core/Src/hall_detection.c **** 			*pin_infoH1=old_pin_infoH3;
 655:Core/Src/hall_detection.c **** 			break;
 656:Core/Src/hall_detection.c **** 		case hall_B:
 657:Core/Src/hall_detection.c **** 			*pin_infoH2=old_pin_infoH3;
 658:Core/Src/hall_detection.c **** 			break;
 659:Core/Src/hall_detection.c **** 		case hall_C:
 660:Core/Src/hall_detection.c **** 			*pin_infoH3=old_pin_infoH3;
 661:Core/Src/hall_detection.c **** 			break;
 662:Core/Src/hall_detection.c **** 		default:
 663:Core/Src/hall_detection.c **** 			break;
 664:Core/Src/hall_detection.c **** 	}
 665:Core/Src/hall_detection.c **** 
 666:Core/Src/hall_detection.c **** }
 1314              		.loc 1 666 1 view .LVU370
 1315 006e 07B0     		add	sp, sp, #28
 1316              	.LCFI17:
 1317              		.cfi_remember_state
 1318              		.cfi_def_cfa_offset 12
 1319              		@ sp needed
 1320 0070 70BC     		pop	{r4, r5, r6}
 1321              	.LCFI18:
 1322              		.cfi_restore 6
 1323              		.cfi_restore 5
 1324              		.cfi_restore 4
 1325              		.cfi_def_cfa_offset 0
 1326              	.LVL100:
ARM GAS  /tmp/ccJ2dceG.s 			page 38


 1327              		.loc 1 666 1 view .LVU371
 1328 0072 7047     		bx	lr
 1329              	.LVL101:
 1330              	.L89:
 1331              	.LCFI19:
 1332              		.cfi_restore_state
 626:Core/Src/hall_detection.c **** 			break;
 1333              		.loc 1 626 4 is_stmt 1 view .LVU372
 626:Core/Src/hall_detection.c **** 			break;
 1334              		.loc 1 626 15 is_stmt 0 view .LVU373
 1335 0074 06A9     		add	r1, sp, #24
 1336 0076 11E90300 		ldmdb	r1, {r0, r1}
 1337 007a 85E80300 		stm	r5, {r0, r1}
 627:Core/Src/hall_detection.c **** 		case hall_B:
 1338              		.loc 1 627 4 is_stmt 1 view .LVU374
 1339 007e DEE7     		b	.L91
 1340              	.L88:
 629:Core/Src/hall_detection.c **** 			break;
 1341              		.loc 1 629 4 view .LVU375
 629:Core/Src/hall_detection.c **** 			break;
 1342              		.loc 1 629 15 is_stmt 0 view .LVU376
 1343 0080 06A9     		add	r1, sp, #24
 1344 0082 11E90300 		ldmdb	r1, {r0, r1}
 1345 0086 82E80300 		stm	r2, {r0, r1}
 630:Core/Src/hall_detection.c **** 		case hall_C:
 1346              		.loc 1 630 4 is_stmt 1 view .LVU377
 1347 008a D8E7     		b	.L91
 1348              	.L90:
 632:Core/Src/hall_detection.c **** 			break;
 1349              		.loc 1 632 4 view .LVU378
 632:Core/Src/hall_detection.c **** 			break;
 1350              		.loc 1 632 15 is_stmt 0 view .LVU379
 1351 008c 06A9     		add	r1, sp, #24
 1352 008e 11E90300 		ldmdb	r1, {r0, r1}
 1353 0092 83E80300 		stm	r3, {r0, r1}
 633:Core/Src/hall_detection.c **** 		default:
 1354              		.loc 1 633 4 is_stmt 1 view .LVU380
 1355 0096 D2E7     		b	.L91
 1356              	.L93:
 640:Core/Src/hall_detection.c **** 			break;
 1357              		.loc 1 640 4 view .LVU381
 640:Core/Src/hall_detection.c **** 			break;
 1358              		.loc 1 640 15 is_stmt 0 view .LVU382
 1359 0098 02A9     		add	r1, sp, #8
 1360 009a 03C9     		ldm	r1, {r0, r1}
 1361 009c 85E80300 		stm	r5, {r0, r1}
 641:Core/Src/hall_detection.c **** 		case hall_B:
 1362              		.loc 1 641 4 is_stmt 1 view .LVU383
 1363 00a0 D9E7     		b	.L95
 1364              	.L92:
 643:Core/Src/hall_detection.c **** 			break;
 1365              		.loc 1 643 4 view .LVU384
 643:Core/Src/hall_detection.c **** 			break;
 1366              		.loc 1 643 15 is_stmt 0 view .LVU385
 1367 00a2 02A9     		add	r1, sp, #8
 1368 00a4 03C9     		ldm	r1, {r0, r1}
 1369 00a6 82E80300 		stm	r2, {r0, r1}
ARM GAS  /tmp/ccJ2dceG.s 			page 39


 644:Core/Src/hall_detection.c **** 		case hall_C:
 1370              		.loc 1 644 4 is_stmt 1 view .LVU386
 1371 00aa D4E7     		b	.L95
 1372              	.L94:
 646:Core/Src/hall_detection.c **** 			break;
 1373              		.loc 1 646 4 view .LVU387
 646:Core/Src/hall_detection.c **** 			break;
 1374              		.loc 1 646 15 is_stmt 0 view .LVU388
 1375 00ac 02A9     		add	r1, sp, #8
 1376 00ae 03C9     		ldm	r1, {r0, r1}
 1377 00b0 83E80300 		stm	r3, {r0, r1}
 647:Core/Src/hall_detection.c **** 		default:
 1378              		.loc 1 647 4 is_stmt 1 view .LVU389
 1379 00b4 CFE7     		b	.L95
 1380              	.LVL102:
 1381              	.L97:
 654:Core/Src/hall_detection.c **** 			break;
 1382              		.loc 1 654 4 view .LVU390
 654:Core/Src/hall_detection.c **** 			break;
 1383              		.loc 1 654 15 is_stmt 0 view .LVU391
 1384 00b6 6B46     		mov	r3, sp
 1385              	.LVL103:
 654:Core/Src/hall_detection.c **** 			break;
 1386              		.loc 1 654 15 view .LVU392
 1387 00b8 93E80300 		ldm	r3, {r0, r1}
 1388 00bc 85E80300 		stm	r5, {r0, r1}
 655:Core/Src/hall_detection.c **** 		case hall_B:
 1389              		.loc 1 655 4 is_stmt 1 view .LVU393
 1390 00c0 D5E7     		b	.L87
 1391              	.LVL104:
 1392              	.L96:
 657:Core/Src/hall_detection.c **** 			break;
 1393              		.loc 1 657 4 view .LVU394
 657:Core/Src/hall_detection.c **** 			break;
 1394              		.loc 1 657 15 is_stmt 0 view .LVU395
 1395 00c2 6B46     		mov	r3, sp
 1396              	.LVL105:
 657:Core/Src/hall_detection.c **** 			break;
 1397              		.loc 1 657 15 view .LVU396
 1398 00c4 93E80300 		ldm	r3, {r0, r1}
 1399 00c8 82E80300 		stm	r2, {r0, r1}
 658:Core/Src/hall_detection.c **** 		case hall_C:
 1400              		.loc 1 658 4 is_stmt 1 view .LVU397
 1401 00cc CFE7     		b	.L87
 1402              	.LVL106:
 1403              	.L98:
 660:Core/Src/hall_detection.c **** 			break;
 1404              		.loc 1 660 4 view .LVU398
 660:Core/Src/hall_detection.c **** 			break;
 1405              		.loc 1 660 15 is_stmt 0 view .LVU399
 1406 00ce 6A46     		mov	r2, sp
 1407 00d0 92E80300 		ldm	r2, {r0, r1}
 1408 00d4 83E80300 		stm	r3, {r0, r1}
 661:Core/Src/hall_detection.c **** 		default:
 1409              		.loc 1 661 4 is_stmt 1 view .LVU400
 1410              		.loc 1 666 1 is_stmt 0 view .LVU401
 1411 00d8 C9E7     		b	.L87
ARM GAS  /tmp/ccJ2dceG.s 			page 40


 1412              		.cfi_endproc
 1413              	.LFE250:
 1415              		.section	.text.absolute,"ax",%progbits
 1416              		.align	1
 1417              		.global	absolute
 1418              		.syntax unified
 1419              		.thumb
 1420              		.thumb_func
 1421              		.fpu fpv4-sp-d16
 1423              	absolute:
 1424              	.LVL107:
 1425              	.LFB251:
 667:Core/Src/hall_detection.c **** 
 668:Core/Src/hall_detection.c **** /**
 669:Core/Src/hall_detection.c **** * \brief small and util to calculate signed absolute values
 670:Core/Src/hall_detection.c **** * \param the number to be absoluted
 671:Core/Src/hall_detection.c **** * \return |x|
 672:Core/Src/hall_detection.c **** */
 673:Core/Src/hall_detection.c **** int32_t absolute(int32_t x){
 1426              		.loc 1 673 28 is_stmt 1 view -0
 1427              		.cfi_startproc
 1428              		@ args = 0, pretend = 0, frame = 0
 1429              		@ frame_needed = 0, uses_anonymous_args = 0
 1430              		@ link register save eliminated.
 674:Core/Src/hall_detection.c ****     return (int32_t)x < (int32_t)0 ? -x : x;
 1431              		.loc 1 674 5 view .LVU403
 675:Core/Src/hall_detection.c **** }
 1432              		.loc 1 675 1 is_stmt 0 view .LVU404
 1433 0000 0028     		cmp	r0, #0
 1434 0002 B8BF     		it	lt
 1435 0004 4042     		rsblt	r0, r0, #0
 1436              	.LVL108:
 1437              		.loc 1 675 1 view .LVU405
 1438 0006 7047     		bx	lr
 1439              		.cfi_endproc
 1440              	.LFE251:
 1442              		.section	.text.assign_polarity,"ax",%progbits
 1443              		.align	1
 1444              		.global	assign_polarity
 1445              		.syntax unified
 1446              		.thumb
 1447              		.thumb_func
 1448              		.fpu fpv4-sp-d16
 1450              	assign_polarity:
 1451              	.LVL109:
 1452              	.LFB253:
 676:Core/Src/hall_detection.c **** 
 677:Core/Src/hall_detection.c **** /**
 678:Core/Src/hall_detection.c **** * \brief magic function, from zerocrossings decides actuall order of hall/current signals, this fun
 679:Core/Src/hall_detection.c **** * right now has a cyclomatic complexity of 21, that should be reduced.
 680:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 681:Core/Src/hall_detection.c **** */
 682:Core/Src/hall_detection.c **** void assign_closest_phase_to_hall(hall_detection_general_struct *gen){
 683:Core/Src/hall_detection.c **** 
 684:Core/Src/hall_detection.c **** 	resetVariables_diferences(gen);
 685:Core/Src/hall_detection.c **** 
 686:Core/Src/hall_detection.c **** 	for (uint32_t i = 0; i < MAXZEROCROSSINGS; ++i) {// all zerocrossings loop
ARM GAS  /tmp/ccJ2dceG.s 			page 41


 687:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_A]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 688:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_B]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 689:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_C]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 690:Core/Src/hall_detection.c **** 
 691:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_A]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 692:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_B]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 693:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_C]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 694:Core/Src/hall_detection.c **** 
 695:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_A]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 696:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_B]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 697:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_C]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 698:Core/Src/hall_detection.c **** 	}
 699:Core/Src/hall_detection.c **** 
 700:Core/Src/hall_detection.c **** 	int32_t _bottom_limit	=(int32_t)((gen->results[gen->numberOfresults].electricPeriod_ticks/2)*0.95)
 701:Core/Src/hall_detection.c **** 	int32_t _top_limit		=(int32_t)(gen->results[gen->numberOfresults].electricPeriod_ticks);
 702:Core/Src/hall_detection.c **** 	int32_t minimum[NUMBEROFPHASES]={0xFF,0xFF,0xFF};
 703:Core/Src/hall_detection.c **** 
 704:Core/Src/hall_detection.c **** 	for (uint32_t i = 0; i < NUMBEROFPHASES; ++i) {
 705:Core/Src/hall_detection.c **** 		gen->differences_phaseA[i]/=MAXZEROCROSSINGS;
 706:Core/Src/hall_detection.c **** 		gen->differences_phaseB[i]/=MAXZEROCROSSINGS;
 707:Core/Src/hall_detection.c **** 		gen->differences_phaseC[i]/=MAXZEROCROSSINGS;
 708:Core/Src/hall_detection.c **** 
 709:Core/Src/hall_detection.c **** 		//sometimes the toggled polarity is detected from a non relevant phase, in this case we are wrong
 710:Core/Src/hall_detection.c **** 		if(gen->differences_phaseA[i]>_bottom_limit && gen->differences_phaseA[i]<_top_limit){
 711:Core/Src/hall_detection.c **** 			gen->differences_phaseA[i]%=_bottom_limit;
 712:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_A][i]=1;
 713:Core/Src/hall_detection.c **** 		}else{
 714:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_A][i]=0;
 715:Core/Src/hall_detection.c **** 		}
 716:Core/Src/hall_detection.c **** 
 717:Core/Src/hall_detection.c **** 		if(gen->differences_phaseB[i]>_bottom_limit && gen->differences_phaseB[i]<_top_limit){
 718:Core/Src/hall_detection.c **** 			gen->differences_phaseB[i]%=_bottom_limit;
 719:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_B][i]=1;
 720:Core/Src/hall_detection.c **** 		}else{
 721:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_B][i]=0;
 722:Core/Src/hall_detection.c **** 		}
 723:Core/Src/hall_detection.c **** 
 724:Core/Src/hall_detection.c **** 		if(gen->differences_phaseC[i]>_bottom_limit && gen->differences_phaseC[i]<_top_limit){
 725:Core/Src/hall_detection.c **** 			gen->differences_phaseC[i]%=_bottom_limit;
 726:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_C][i]=1;
 727:Core/Src/hall_detection.c **** 		}else{
 728:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_C][i]=0;
 729:Core/Src/hall_detection.c **** 		}
 730:Core/Src/hall_detection.c **** 
 731:Core/Src/hall_detection.c **** 		//takes notes of the minimum difference
 732:Core/Src/hall_detection.c **** 		if(gen->differences_phaseA[i]<minimum[phase_A]){
 733:Core/Src/hall_detection.c **** 			minimum[phase_A]=gen->differences_phaseA[i];
 734:Core/Src/hall_detection.c **** 		}
 735:Core/Src/hall_detection.c **** 
 736:Core/Src/hall_detection.c **** 		if(gen->differences_phaseB[i]<minimum[phase_B]){
 737:Core/Src/hall_detection.c **** 			minimum[phase_B]=gen->differences_phaseB[i];
 738:Core/Src/hall_detection.c **** 		}
 739:Core/Src/hall_detection.c **** 
 740:Core/Src/hall_detection.c **** 		if(gen->differences_phaseC[i]<minimum[phase_C]){
 741:Core/Src/hall_detection.c **** 			minimum[phase_C]=gen->differences_phaseC[i];
 742:Core/Src/hall_detection.c **** 		}
 743:Core/Src/hall_detection.c **** 	}
ARM GAS  /tmp/ccJ2dceG.s 			page 42


 744:Core/Src/hall_detection.c **** 	//finds out wichone is the minimum diff
 745:Core/Src/hall_detection.c **** 	for (uint32_t i = 0; i < NUMBEROFPHASES; ++i) {
 746:Core/Src/hall_detection.c **** 		if(gen->differences_phaseA[i]==minimum[phase_A]){
 747:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_A;
 748:Core/Src/hall_detection.c **** 		}
 749:Core/Src/hall_detection.c **** 
 750:Core/Src/hall_detection.c **** 		if(gen->differences_phaseB[i]==minimum[phase_B]){
 751:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_B;
 752:Core/Src/hall_detection.c **** 		}
 753:Core/Src/hall_detection.c **** 
 754:Core/Src/hall_detection.c **** 		if(gen->differences_phaseC[i]==minimum[phase_C]){
 755:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_C;
 756:Core/Src/hall_detection.c **** 		}
 757:Core/Src/hall_detection.c **** 	}
 758:Core/Src/hall_detection.c **** }
 759:Core/Src/hall_detection.c **** 
 760:Core/Src/hall_detection.c **** 
 761:Core/Src/hall_detection.c **** 
 762:Core/Src/hall_detection.c **** /**
 763:Core/Src/hall_detection.c **** * \brief the other magic function, asigns polarity from risign or falling edges, it also takes into
 764:Core/Src/hall_detection.c **** * right now has a cyclomatic complexity of 21, that should be reduced.
 765:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, 	pointer to the huge structure containing everything t
 766:Core/Src/hall_detection.c **** */
 767:Core/Src/hall_detection.c **** void assign_polarity(hall_detection_general_struct *gen){
 1453              		.loc 1 767 57 is_stmt 1 view -0
 1454              		.cfi_startproc
 1455              		@ args = 0, pretend = 0, frame = 24
 1456              		@ frame_needed = 0, uses_anonymous_args = 0
 1457              		@ link register save eliminated.
 1458              		.loc 1 767 57 is_stmt 0 view .LVU407
 1459 0000 30B4     		push	{r4, r5}
 1460              	.LCFI20:
 1461              		.cfi_def_cfa_offset 8
 1462              		.cfi_offset 4, -8
 1463              		.cfi_offset 5, -4
 1464 0002 86B0     		sub	sp, sp, #24
 1465              	.LCFI21:
 1466              		.cfi_def_cfa_offset 32
 768:Core/Src/hall_detection.c **** 	current_or_hall_measurements_struct*	currents[NUMBEROFPHASES]={&gen->currA,&gen->currB,&gen->currC
 1467              		.loc 1 768 2 is_stmt 1 view .LVU408
 1468              		.loc 1 768 65 is_stmt 0 view .LVU409
 1469 0004 031D     		adds	r3, r0, #4
 1470              		.loc 1 768 39 view .LVU410
 1471 0006 0393     		str	r3, [sp, #12]
 1472              		.loc 1 768 77 view .LVU411
 1473 0008 00F13003 		add	r3, r0, #48
 1474              		.loc 1 768 39 view .LVU412
 1475 000c 0493     		str	r3, [sp, #16]
 1476              		.loc 1 768 89 view .LVU413
 1477 000e 00F15C03 		add	r3, r0, #92
 1478              		.loc 1 768 39 view .LVU414
 1479 0012 0593     		str	r3, [sp, #20]
 769:Core/Src/hall_detection.c **** 	current_or_hall_measurements_struct*	halls[NUMBEROFPHASES]	={&gen->hallA,&gen->hallB,&gen->hallC};
 1480              		.loc 1 769 2 is_stmt 1 view .LVU415
 1481              		.loc 1 769 63 is_stmt 0 view .LVU416
 1482 0014 00F18803 		add	r3, r0, #136
 1483              		.loc 1 769 39 view .LVU417
ARM GAS  /tmp/ccJ2dceG.s 			page 43


 1484 0018 0093     		str	r3, [sp]
 1485              		.loc 1 769 75 view .LVU418
 1486 001a 00F1B403 		add	r3, r0, #180
 1487              		.loc 1 769 39 view .LVU419
 1488 001e 0193     		str	r3, [sp, #4]
 1489              		.loc 1 769 87 view .LVU420
 1490 0020 00F1E003 		add	r3, r0, #224
 1491              		.loc 1 769 39 view .LVU421
 1492 0024 0293     		str	r3, [sp, #8]
 770:Core/Src/hall_detection.c **** 	detection_results_struct *pointerOfcurrentResult=&gen->results[gen->numberOfresults];
 1493              		.loc 1 770 2 is_stmt 1 view .LVU422
 1494              		.loc 1 770 68 is_stmt 0 view .LVU423
 1495 0026 D0F85441 		ldr	r4, [r0, #340]
 1496              	.LVL110:
 771:Core/Src/hall_detection.c **** 
 772:Core/Src/hall_detection.c **** 	for (uint32_t i = 0; i < NUMBEROFPHASES; ++i) {
 1497              		.loc 1 772 2 is_stmt 1 view .LVU424
 1498              	.LBB11:
 1499              		.loc 1 772 7 view .LVU425
 1500              		.loc 1 772 16 is_stmt 0 view .LVU426
 1501 002a 0023     		movs	r3, #0
 1502              		.loc 1 772 2 view .LVU427
 1503 002c 1BE0     		b	.L103
 1504              	.LVL111:
 1505              	.L111:
 773:Core/Src/hall_detection.c **** 		if(currents[pointerOfcurrentResult->hall_order[i]]->zerocrossings_polarity[1]==halls[i]->zerocros
 774:Core/Src/hall_detection.c **** 			if(gen->shifted_polarity[pointerOfcurrentResult->hall_order[i]][i]==0){
 1506              		.loc 1 774 4 is_stmt 1 view .LVU428
 1507              		.loc 1 774 67 is_stmt 0 view .LVU429
 1508 002e 02EB4201 		add	r1, r2, r2, lsl #1
 1509 0032 1944     		add	r1, r1, r3
 1510 0034 4C31     		adds	r1, r1, #76
 1511 0036 50F82110 		ldr	r1, [r0, r1, lsl #2]
 1512              		.loc 1 774 6 view .LVU430
 1513 003a 31B9     		cbnz	r1, .L105
 775:Core/Src/hall_detection.c **** 				pointerOfcurrentResult->hall_polarity[pointerOfcurrentResult->hall_order[i]]=hall_direct;
 1514              		.loc 1 775 5 is_stmt 1 view .LVU431
 1515              		.loc 1 775 81 is_stmt 0 view .LVU432
 1516 003c 00EB0411 		add	r1, r0, r4, lsl #4
 1517 0040 0A44     		add	r2, r2, r1
 1518 0042 0021     		movs	r1, #0
 1519 0044 82F86711 		strb	r1, [r2, #359]
 1520 0048 0CE0     		b	.L106
 1521              	.L105:
 776:Core/Src/hall_detection.c **** 			}else{
 777:Core/Src/hall_detection.c **** 				pointerOfcurrentResult->hall_polarity[pointerOfcurrentResult->hall_order[i]]=hall_inverse;
 1522              		.loc 1 777 5 is_stmt 1 view .LVU433
 1523              		.loc 1 777 81 is_stmt 0 view .LVU434
 1524 004a 00EB0411 		add	r1, r0, r4, lsl #4
 1525 004e 0A44     		add	r2, r2, r1
 1526 0050 0121     		movs	r1, #1
 1527 0052 82F86711 		strb	r1, [r2, #359]
 1528 0056 05E0     		b	.L106
 1529              	.L107:
 778:Core/Src/hall_detection.c **** 			}
 779:Core/Src/hall_detection.c **** 		}else{
 780:Core/Src/hall_detection.c **** 			if(gen->shifted_polarity[pointerOfcurrentResult->hall_order[i]][i]==0){
ARM GAS  /tmp/ccJ2dceG.s 			page 44


 781:Core/Src/hall_detection.c **** 				pointerOfcurrentResult->hall_polarity[pointerOfcurrentResult->hall_order[i]]=hall_inverse;
 782:Core/Src/hall_detection.c **** 			}else{
 783:Core/Src/hall_detection.c **** 				pointerOfcurrentResult->hall_polarity[pointerOfcurrentResult->hall_order[i]]=hall_direct;
 1530              		.loc 1 783 5 is_stmt 1 view .LVU435
 1531              		.loc 1 783 81 is_stmt 0 view .LVU436
 1532 0058 00EB0411 		add	r1, r0, r4, lsl #4
 1533 005c 0A44     		add	r2, r2, r1
 1534 005e 0021     		movs	r1, #0
 1535 0060 82F86711 		strb	r1, [r2, #359]
 1536              	.L106:
 772:Core/Src/hall_detection.c **** 		if(currents[pointerOfcurrentResult->hall_order[i]]->zerocrossings_polarity[1]==halls[i]->zerocros
 1537              		.loc 1 772 43 discriminator 2 view .LVU437
 1538 0064 0133     		adds	r3, r3, #1
 1539              	.LVL112:
 1540              	.L103:
 772:Core/Src/hall_detection.c **** 		if(currents[pointerOfcurrentResult->hall_order[i]]->zerocrossings_polarity[1]==halls[i]->zerocros
 1541              		.loc 1 772 2 discriminator 1 view .LVU438
 1542 0066 022B     		cmp	r3, #2
 1543 0068 23D8     		bhi	.L110
 773:Core/Src/hall_detection.c **** 			if(gen->shifted_polarity[pointerOfcurrentResult->hall_order[i]][i]==0){
 1544              		.loc 1 773 3 is_stmt 1 view .LVU439
 773:Core/Src/hall_detection.c **** 			if(gen->shifted_polarity[pointerOfcurrentResult->hall_order[i]][i]==0){
 1545              		.loc 1 773 49 is_stmt 0 view .LVU440
 1546 006a 00EB0412 		add	r2, r0, r4, lsl #4
 1547 006e 1A44     		add	r2, r2, r3
 1548 0070 92F86421 		ldrb	r2, [r2, #356]	@ zero_extendqisi2
 773:Core/Src/hall_detection.c **** 			if(gen->shifted_polarity[pointerOfcurrentResult->hall_order[i]][i]==0){
 1549              		.loc 1 773 14 view .LVU441
 1550 0074 06A9     		add	r1, sp, #24
 1551 0076 01EB8201 		add	r1, r1, r2, lsl #2
 1552 007a 51F80C1C 		ldr	r1, [r1, #-12]
 773:Core/Src/hall_detection.c **** 			if(gen->shifted_polarity[pointerOfcurrentResult->hall_order[i]][i]==0){
 1553              		.loc 1 773 77 view .LVU442
 1554 007e 91F82150 		ldrb	r5, [r1, #33]	@ zero_extendqisi2
 773:Core/Src/hall_detection.c **** 			if(gen->shifted_polarity[pointerOfcurrentResult->hall_order[i]][i]==0){
 1555              		.loc 1 773 87 view .LVU443
 1556 0082 06A9     		add	r1, sp, #24
 1557 0084 01EB8301 		add	r1, r1, r3, lsl #2
 1558 0088 51F8181C 		ldr	r1, [r1, #-24]
 773:Core/Src/hall_detection.c **** 			if(gen->shifted_polarity[pointerOfcurrentResult->hall_order[i]][i]==0){
 1559              		.loc 1 773 114 view .LVU444
 1560 008c 91F82110 		ldrb	r1, [r1, #33]	@ zero_extendqisi2
 773:Core/Src/hall_detection.c **** 			if(gen->shifted_polarity[pointerOfcurrentResult->hall_order[i]][i]==0){
 1561              		.loc 1 773 5 view .LVU445
 1562 0090 8D42     		cmp	r5, r1
 1563 0092 CCD0     		beq	.L111
 780:Core/Src/hall_detection.c **** 				pointerOfcurrentResult->hall_polarity[pointerOfcurrentResult->hall_order[i]]=hall_inverse;
 1564              		.loc 1 780 4 is_stmt 1 view .LVU446
 780:Core/Src/hall_detection.c **** 				pointerOfcurrentResult->hall_polarity[pointerOfcurrentResult->hall_order[i]]=hall_inverse;
 1565              		.loc 1 780 67 is_stmt 0 view .LVU447
 1566 0094 02EB4201 		add	r1, r2, r2, lsl #1
 1567 0098 1944     		add	r1, r1, r3
 1568 009a 4C31     		adds	r1, r1, #76
 1569 009c 50F82110 		ldr	r1, [r0, r1, lsl #2]
 780:Core/Src/hall_detection.c **** 				pointerOfcurrentResult->hall_polarity[pointerOfcurrentResult->hall_order[i]]=hall_inverse;
 1570              		.loc 1 780 6 view .LVU448
 1571 00a0 0029     		cmp	r1, #0
ARM GAS  /tmp/ccJ2dceG.s 			page 45


 1572 00a2 D9D1     		bne	.L107
 781:Core/Src/hall_detection.c **** 			}else{
 1573              		.loc 1 781 5 is_stmt 1 view .LVU449
 781:Core/Src/hall_detection.c **** 			}else{
 1574              		.loc 1 781 81 is_stmt 0 view .LVU450
 1575 00a4 00EB0411 		add	r1, r0, r4, lsl #4
 1576 00a8 0A44     		add	r2, r2, r1
 1577 00aa 0121     		movs	r1, #1
 1578 00ac 82F86711 		strb	r1, [r2, #359]
 1579 00b0 D8E7     		b	.L106
 1580              	.L110:
 781:Core/Src/hall_detection.c **** 			}else{
 1581              		.loc 1 781 81 view .LVU451
 1582              	.LBE11:
 784:Core/Src/hall_detection.c **** 			}
 785:Core/Src/hall_detection.c **** 		}
 786:Core/Src/hall_detection.c **** 	}
 787:Core/Src/hall_detection.c **** 
 788:Core/Src/hall_detection.c **** }
 1583              		.loc 1 788 1 view .LVU452
 1584 00b2 06B0     		add	sp, sp, #24
 1585              	.LCFI22:
 1586              		.cfi_def_cfa_offset 8
 1587              		@ sp needed
 1588 00b4 30BC     		pop	{r4, r5}
 1589              	.LCFI23:
 1590              		.cfi_restore 5
 1591              		.cfi_restore 4
 1592              		.cfi_def_cfa_offset 0
 1593              	.LVL113:
 1594              		.loc 1 788 1 view .LVU453
 1595 00b6 7047     		bx	lr
 1596              		.cfi_endproc
 1597              	.LFE253:
 1599              		.section	.text.resetVariables_adquisition,"ax",%progbits
 1600              		.align	1
 1601              		.global	resetVariables_adquisition
 1602              		.syntax unified
 1603              		.thumb
 1604              		.thumb_func
 1605              		.fpu fpv4-sp-d16
 1607              	resetVariables_adquisition:
 1608              	.LVL114:
 1609              	.LFB254:
 789:Core/Src/hall_detection.c **** 
 790:Core/Src/hall_detection.c **** /**
 791:Core/Src/hall_detection.c **** * \brief just resets to 0 the adquisition related part from the huge structure used by the detectio
 792:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, pointer to the huge structure.
 793:Core/Src/hall_detection.c **** */
 794:Core/Src/hall_detection.c **** void resetVariables_adquisition(hall_detection_general_struct *gen){
 1610              		.loc 1 794 68 is_stmt 1 view -0
 1611              		.cfi_startproc
 1612              		@ args = 0, pretend = 0, frame = 0
 1613              		@ frame_needed = 0, uses_anonymous_args = 0
 1614              		@ link register save eliminated.
 1615              		.loc 1 794 68 is_stmt 0 view .LVU455
 1616 0000 F0B4     		push	{r4, r5, r6, r7}
ARM GAS  /tmp/ccJ2dceG.s 			page 46


 1617              	.LCFI24:
 1618              		.cfi_def_cfa_offset 16
 1619              		.cfi_offset 4, -16
 1620              		.cfi_offset 5, -12
 1621              		.cfi_offset 6, -8
 1622              		.cfi_offset 7, -4
 1623 0002 0546     		mov	r5, r0
 795:Core/Src/hall_detection.c **** 	//wow this was taking too long it was throwing execution errors
 796:Core/Src/hall_detection.c **** 	//*gen=empty_general;		//i dont want to use memset, so we sacrifice flash memory space filled with
 797:Core/Src/hall_detection.c **** 	gen->currA=empty_general.currA;
 1624              		.loc 1 797 2 is_stmt 1 view .LVU456
 1625              		.loc 1 797 12 is_stmt 0 view .LVU457
 1626 0004 2D4C     		ldr	r4, .L114
 1627 0006 061D     		adds	r6, r0, #4
 1628 0008 271D     		adds	r7, r4, #4
 1629 000a 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1630              	.LVL115:
 1631              		.loc 1 797 12 view .LVU458
 1632 000c 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1633 000e 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1634 0010 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1635 0012 97E80700 		ldm	r7, {r0, r1, r2}
 1636 0016 86E80700 		stm	r6, {r0, r1, r2}
 798:Core/Src/hall_detection.c **** 	gen->currB=empty_general.currB;
 1637              		.loc 1 798 2 is_stmt 1 view .LVU459
 1638              		.loc 1 798 12 is_stmt 0 view .LVU460
 1639 001a 05F13006 		add	r6, r5, #48
 1640 001e 04F13007 		add	r7, r4, #48
 1641 0022 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1642 0024 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1643 0026 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1644 0028 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1645 002a 97E80700 		ldm	r7, {r0, r1, r2}
 1646 002e 86E80700 		stm	r6, {r0, r1, r2}
 799:Core/Src/hall_detection.c **** 	gen->currC=empty_general.currC;
 1647              		.loc 1 799 2 is_stmt 1 view .LVU461
 1648              		.loc 1 799 12 is_stmt 0 view .LVU462
 1649 0032 05F15C06 		add	r6, r5, #92
 1650 0036 04F15C07 		add	r7, r4, #92
 1651 003a 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1652 003c 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1653 003e 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1654 0040 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1655 0042 97E80700 		ldm	r7, {r0, r1, r2}
 1656 0046 86E80700 		stm	r6, {r0, r1, r2}
 800:Core/Src/hall_detection.c **** 	gen->hallA=empty_general.hallA;
 1657              		.loc 1 800 2 is_stmt 1 view .LVU463
 1658              		.loc 1 800 12 is_stmt 0 view .LVU464
 1659 004a 05F18806 		add	r6, r5, #136
 1660 004e 04F18807 		add	r7, r4, #136
 1661 0052 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1662 0054 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1663 0056 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1664 0058 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1665 005a 97E80700 		ldm	r7, {r0, r1, r2}
 1666 005e 86E80700 		stm	r6, {r0, r1, r2}
 801:Core/Src/hall_detection.c **** 	gen->hallB=empty_general.hallB;
ARM GAS  /tmp/ccJ2dceG.s 			page 47


 1667              		.loc 1 801 2 is_stmt 1 view .LVU465
 1668              		.loc 1 801 12 is_stmt 0 view .LVU466
 1669 0062 05F1B406 		add	r6, r5, #180
 1670 0066 04F1B407 		add	r7, r4, #180
 1671 006a 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1672 006c 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1673 006e 0FCF     		ldmia	r7!, {r0, r1, r2, r3}
 1674 0070 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1675 0072 97E80700 		ldm	r7, {r0, r1, r2}
 1676 0076 86E80700 		stm	r6, {r0, r1, r2}
 802:Core/Src/hall_detection.c **** 	gen->hallC=empty_general.hallC;
 1677              		.loc 1 802 2 is_stmt 1 view .LVU467
 1678              		.loc 1 802 12 is_stmt 0 view .LVU468
 1679 007a 05F1E006 		add	r6, r5, #224
 1680 007e E034     		adds	r4, r4, #224
 1681 0080 0FCC     		ldmia	r4!, {r0, r1, r2, r3}
 1682 0082 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1683 0084 0FCC     		ldmia	r4!, {r0, r1, r2, r3}
 1684 0086 0FC6     		stmia	r6!, {r0, r1, r2, r3}
 1685 0088 94E80700 		ldm	r4, {r0, r1, r2}
 1686 008c 86E80700 		stm	r6, {r0, r1, r2}
 803:Core/Src/hall_detection.c **** 
 804:Core/Src/hall_detection.c **** 	gen->differences_phaseA[0]=empty_general.differences_phaseA[0];
 1687              		.loc 1 804 2 is_stmt 1 view .LVU469
 1688              		.loc 1 804 28 is_stmt 0 view .LVU470
 1689 0090 0023     		movs	r3, #0
 1690 0092 C5F80C31 		str	r3, [r5, #268]
 805:Core/Src/hall_detection.c **** 	gen->differences_phaseA[1]=empty_general.differences_phaseA[1];
 1691              		.loc 1 805 2 is_stmt 1 view .LVU471
 1692              		.loc 1 805 28 is_stmt 0 view .LVU472
 1693 0096 C5F81031 		str	r3, [r5, #272]
 806:Core/Src/hall_detection.c **** 	gen->differences_phaseA[2]=empty_general.differences_phaseA[2];
 1694              		.loc 1 806 2 is_stmt 1 view .LVU473
 1695              		.loc 1 806 28 is_stmt 0 view .LVU474
 1696 009a C5F81431 		str	r3, [r5, #276]
 807:Core/Src/hall_detection.c **** 
 808:Core/Src/hall_detection.c **** 	gen->differences_phaseB[0]=empty_general.differences_phaseB[0];
 1697              		.loc 1 808 2 is_stmt 1 view .LVU475
 1698              		.loc 1 808 28 is_stmt 0 view .LVU476
 1699 009e C5F81831 		str	r3, [r5, #280]
 809:Core/Src/hall_detection.c **** 	gen->differences_phaseB[1]=empty_general.differences_phaseB[1];
 1700              		.loc 1 809 2 is_stmt 1 view .LVU477
 1701              		.loc 1 809 28 is_stmt 0 view .LVU478
 1702 00a2 C5F81C31 		str	r3, [r5, #284]
 810:Core/Src/hall_detection.c **** 	gen->differences_phaseB[2]=empty_general.differences_phaseB[2];
 1703              		.loc 1 810 2 is_stmt 1 view .LVU479
 1704              		.loc 1 810 28 is_stmt 0 view .LVU480
 1705 00a6 C5F82031 		str	r3, [r5, #288]
 811:Core/Src/hall_detection.c **** 
 812:Core/Src/hall_detection.c **** 	gen->differences_phaseC[0]=empty_general.differences_phaseC[0];
 1706              		.loc 1 812 2 is_stmt 1 view .LVU481
 1707              		.loc 1 812 28 is_stmt 0 view .LVU482
 1708 00aa C5F82431 		str	r3, [r5, #292]
 813:Core/Src/hall_detection.c **** 	gen->differences_phaseC[1]=empty_general.differences_phaseC[1];
 1709              		.loc 1 813 2 is_stmt 1 view .LVU483
 1710              		.loc 1 813 28 is_stmt 0 view .LVU484
 1711 00ae C5F82831 		str	r3, [r5, #296]
ARM GAS  /tmp/ccJ2dceG.s 			page 48


 814:Core/Src/hall_detection.c **** 	gen->differences_phaseC[2]=empty_general.differences_phaseC[2];
 1712              		.loc 1 814 2 is_stmt 1 view .LVU485
 1713              		.loc 1 814 28 is_stmt 0 view .LVU486
 1714 00b2 C5F82C31 		str	r3, [r5, #300]
 815:Core/Src/hall_detection.c **** }
 1715              		.loc 1 815 1 view .LVU487
 1716 00b6 F0BC     		pop	{r4, r5, r6, r7}
 1717              	.LCFI25:
 1718              		.cfi_restore 7
 1719              		.cfi_restore 6
 1720              		.cfi_restore 5
 1721              		.cfi_restore 4
 1722              		.cfi_def_cfa_offset 0
 1723              	.LVL116:
 1724              		.loc 1 815 1 view .LVU488
 1725 00b8 7047     		bx	lr
 1726              	.L115:
 1727 00ba 00BF     		.align	2
 1728              	.L114:
 1729 00bc 00000000 		.word	.LANCHOR2
 1730              		.cfi_endproc
 1731              	.LFE254:
 1733              		.section	.text.resetVariables_diferences,"ax",%progbits
 1734              		.align	1
 1735              		.global	resetVariables_diferences
 1736              		.syntax unified
 1737              		.thumb
 1738              		.thumb_func
 1739              		.fpu fpv4-sp-d16
 1741              	resetVariables_diferences:
 1742              	.LVL117:
 1743              	.LFB255:
 816:Core/Src/hall_detection.c **** 
 817:Core/Src/hall_detection.c **** /**
 818:Core/Src/hall_detection.c **** * \brief just resets to 0 the identification related part
 819:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, pointer to the huge structure.
 820:Core/Src/hall_detection.c **** */
 821:Core/Src/hall_detection.c **** void resetVariables_diferences(hall_detection_general_struct *gen){
 1744              		.loc 1 821 67 is_stmt 1 view -0
 1745              		.cfi_startproc
 1746              		@ args = 0, pretend = 0, frame = 0
 1747              		@ frame_needed = 0, uses_anonymous_args = 0
 1748              		@ link register save eliminated.
 822:Core/Src/hall_detection.c **** 	gen->differences_phaseA[0]=empty_general.differences_phaseA[0];
 1749              		.loc 1 822 2 view .LVU490
 1750              		.loc 1 822 28 is_stmt 0 view .LVU491
 1751 0000 0023     		movs	r3, #0
 1752 0002 C0F80C31 		str	r3, [r0, #268]
 823:Core/Src/hall_detection.c **** 	gen->differences_phaseA[1]=empty_general.differences_phaseA[1];
 1753              		.loc 1 823 2 is_stmt 1 view .LVU492
 1754              		.loc 1 823 28 is_stmt 0 view .LVU493
 1755 0006 C0F81031 		str	r3, [r0, #272]
 824:Core/Src/hall_detection.c **** 	gen->differences_phaseA[2]=empty_general.differences_phaseA[2];
 1756              		.loc 1 824 2 is_stmt 1 view .LVU494
 1757              		.loc 1 824 28 is_stmt 0 view .LVU495
 1758 000a C0F81431 		str	r3, [r0, #276]
 825:Core/Src/hall_detection.c **** 
ARM GAS  /tmp/ccJ2dceG.s 			page 49


 826:Core/Src/hall_detection.c **** 	gen->differences_phaseB[0]=empty_general.differences_phaseB[0];
 1759              		.loc 1 826 2 is_stmt 1 view .LVU496
 1760              		.loc 1 826 28 is_stmt 0 view .LVU497
 1761 000e C0F81831 		str	r3, [r0, #280]
 827:Core/Src/hall_detection.c **** 	gen->differences_phaseB[1]=empty_general.differences_phaseB[1];
 1762              		.loc 1 827 2 is_stmt 1 view .LVU498
 1763              		.loc 1 827 28 is_stmt 0 view .LVU499
 1764 0012 C0F81C31 		str	r3, [r0, #284]
 828:Core/Src/hall_detection.c **** 	gen->differences_phaseB[2]=empty_general.differences_phaseB[2];
 1765              		.loc 1 828 2 is_stmt 1 view .LVU500
 1766              		.loc 1 828 28 is_stmt 0 view .LVU501
 1767 0016 C0F82031 		str	r3, [r0, #288]
 829:Core/Src/hall_detection.c **** 
 830:Core/Src/hall_detection.c **** 	gen->differences_phaseC[0]=empty_general.differences_phaseC[0];
 1768              		.loc 1 830 2 is_stmt 1 view .LVU502
 1769              		.loc 1 830 28 is_stmt 0 view .LVU503
 1770 001a C0F82431 		str	r3, [r0, #292]
 831:Core/Src/hall_detection.c **** 	gen->differences_phaseC[1]=empty_general.differences_phaseC[1];
 1771              		.loc 1 831 2 is_stmt 1 view .LVU504
 1772              		.loc 1 831 28 is_stmt 0 view .LVU505
 1773 001e C0F82831 		str	r3, [r0, #296]
 832:Core/Src/hall_detection.c **** 	gen->differences_phaseC[2]=empty_general.differences_phaseC[2];
 1774              		.loc 1 832 2 is_stmt 1 view .LVU506
 1775              		.loc 1 832 28 is_stmt 0 view .LVU507
 1776 0022 C0F82C31 		str	r3, [r0, #300]
 833:Core/Src/hall_detection.c **** }
 1777              		.loc 1 833 1 view .LVU508
 1778 0026 7047     		bx	lr
 1779              		.cfi_endproc
 1780              	.LFE255:
 1782              		.section	.text.validation,"ax",%progbits
 1783              		.align	1
 1784              		.global	validation
 1785              		.syntax unified
 1786              		.thumb
 1787              		.thumb_func
 1788              		.fpu fpv4-sp-d16
 1790              	validation:
 1791              	.LVL118:
 1792              	.LFB241:
 314:Core/Src/hall_detection.c **** 	//timeout or 	//reached results buffer full capacity
 1793              		.loc 1 314 80 is_stmt 1 view -0
 1794              		.cfi_startproc
 1795              		@ args = 0, pretend = 0, frame = 0
 1796              		@ frame_needed = 0, uses_anonymous_args = 0
 314:Core/Src/hall_detection.c **** 	//timeout or 	//reached results buffer full capacity
 1797              		.loc 1 314 80 is_stmt 0 view .LVU510
 1798 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 1799              	.LCFI26:
 1800              		.cfi_def_cfa_offset 24
 1801              		.cfi_offset 3, -24
 1802              		.cfi_offset 4, -20
 1803              		.cfi_offset 5, -16
 1804              		.cfi_offset 6, -12
 1805              		.cfi_offset 7, -8
 1806              		.cfi_offset 14, -4
 316:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
ARM GAS  /tmp/ccJ2dceG.s 			page 50


 1807              		.loc 1 316 2 is_stmt 1 view .LVU511
 316:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 1808              		.loc 1 316 11 is_stmt 0 view .LVU512
 1809 0002 564B     		ldr	r3, .L146
 1810 0004 1A68     		ldr	r2, [r3]
 316:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 1811              		.loc 1 316 4 view .LVU513
 1812 0006 564B     		ldr	r3, .L146+4
 1813 0008 9A42     		cmp	r2, r3
 1814 000a 06D8     		bhi	.L118
 316:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 1815              		.loc 1 316 27 discriminator 1 view .LVU514
 1816 000c D1F85461 		ldr	r6, [r1, #340]
 316:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 1817              		.loc 1 316 21 discriminator 1 view .LVU515
 1818 0010 062E     		cmp	r6, #6
 1819 0012 02D8     		bhi	.L118
 1820              	.LBB12:
 322:Core/Src/hall_detection.c **** 		if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_A){
 1821              		.loc 1 322 16 view .LVU516
 1822 0014 0022     		movs	r2, #0
 1823              	.LBE12:
 321:Core/Src/hall_detection.c **** 	for (uint32_t i = 0;  i < NUMBEROFPHASES; ++ i) {
 1824              		.loc 1 321 11 view .LVU517
 1825 0016 1446     		mov	r4, r2
 1826 0018 07E0     		b	.L119
 1827              	.L118:
 317:Core/Src/hall_detection.c **** 		return;
 1828              		.loc 1 317 3 is_stmt 1 view .LVU518
 317:Core/Src/hall_detection.c **** 		return;
 1829              		.loc 1 317 9 is_stmt 0 view .LVU519
 1830 001a 0723     		movs	r3, #7
 1831 001c 0370     		strb	r3, [r0]
 318:Core/Src/hall_detection.c **** 	}
 1832              		.loc 1 318 3 is_stmt 1 view .LVU520
 1833              	.LVL119:
 1834              	.L117:
 376:Core/Src/hall_detection.c **** 
 1835              		.loc 1 376 1 is_stmt 0 view .LVU521
 1836 001e F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1837              	.LVL120:
 1838              	.L121:
 1839              	.LBB13:
 325:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_B);
 1840              		.loc 1 325 9 is_stmt 1 view .LVU522
 325:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_B);
 1841              		.loc 1 325 11 is_stmt 0 view .LVU523
 1842 0020 012B     		cmp	r3, #1
 1843 0022 0FD0     		beq	.L141
 327:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_C);
 1844              		.loc 1 327 9 is_stmt 1 view .LVU524
 327:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_C);
 1845              		.loc 1 327 11 is_stmt 0 view .LVU525
 1846 0024 022B     		cmp	r3, #2
 1847 0026 10D0     		beq	.L142
 1848              	.L122:
 322:Core/Src/hall_detection.c **** 		if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_A){
ARM GAS  /tmp/ccJ2dceG.s 			page 51


 1849              		.loc 1 322 44 discriminator 2 view .LVU526
 1850 0028 0132     		adds	r2, r2, #1
 1851              	.LVL121:
 1852              	.L119:
 322:Core/Src/hall_detection.c **** 		if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_A){
 1853              		.loc 1 322 2 discriminator 1 view .LVU527
 1854 002a 022A     		cmp	r2, #2
 1855 002c 10D8     		bhi	.L143
 323:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_A);
 1856              		.loc 1 323 3 is_stmt 1 view .LVU528
 323:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_A);
 1857              		.loc 1 323 39 is_stmt 0 view .LVU529
 1858 002e 731E     		subs	r3, r6, #1
 323:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_A);
 1859              		.loc 1 323 53 view .LVU530
 1860 0030 01EB0313 		add	r3, r1, r3, lsl #4
 1861 0034 1344     		add	r3, r3, r2
 1862 0036 93F86431 		ldrb	r3, [r3, #356]	@ zero_extendqisi2
 323:Core/Src/hall_detection.c **** 			all_phases_not_repeated|=(1<<hall_A);
 1863              		.loc 1 323 5 view .LVU531
 1864 003a 002B     		cmp	r3, #0
 1865 003c F0D1     		bne	.L121
 324:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_B){
 1866              		.loc 1 324 4 is_stmt 1 view .LVU532
 324:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_B){
 1867              		.loc 1 324 27 is_stmt 0 view .LVU533
 1868 003e 44F00104 		orr	r4, r4, #1
 1869              	.LVL122:
 324:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_B){
 1870              		.loc 1 324 27 view .LVU534
 1871 0042 F1E7     		b	.L122
 1872              	.L141:
 326:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_C){
 1873              		.loc 1 326 4 is_stmt 1 view .LVU535
 326:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_C){
 1874              		.loc 1 326 27 is_stmt 0 view .LVU536
 1875 0044 44F00204 		orr	r4, r4, #2
 1876              	.LVL123:
 326:Core/Src/hall_detection.c **** 		}else if(gen->results[gen->numberOfresults-1].hall_order[i]==hall_C){
 1877              		.loc 1 326 27 view .LVU537
 1878 0048 EEE7     		b	.L122
 1879              	.L142:
 328:Core/Src/hall_detection.c **** 		}
 1880              		.loc 1 328 4 is_stmt 1 view .LVU538
 328:Core/Src/hall_detection.c **** 		}
 1881              		.loc 1 328 27 is_stmt 0 view .LVU539
 1882 004a 44F00404 		orr	r4, r4, #4
 1883              	.LVL124:
 328:Core/Src/hall_detection.c **** 		}
 1884              		.loc 1 328 27 view .LVU540
 1885 004e EBE7     		b	.L122
 1886              	.L143:
 328:Core/Src/hall_detection.c **** 		}
 1887              		.loc 1 328 27 view .LVU541
 1888              	.LBE13:
 332:Core/Src/hall_detection.c **** 		gen->results[gen->numberOfresults-1].is_valid=YES;
 1889              		.loc 1 332 2 is_stmt 1 view .LVU542
ARM GAS  /tmp/ccJ2dceG.s 			page 52


 332:Core/Src/hall_detection.c **** 		gen->results[gen->numberOfresults-1].is_valid=YES;
 1890              		.loc 1 332 4 is_stmt 0 view .LVU543
 1891 0050 072C     		cmp	r4, #7
 1892 0052 08D0     		beq	.L144
 335:Core/Src/hall_detection.c **** 	}
 1893              		.loc 1 335 3 is_stmt 1 view .LVU544
 335:Core/Src/hall_detection.c **** 	}
 1894              		.loc 1 335 36 is_stmt 0 view .LVU545
 1895 0054 731E     		subs	r3, r6, #1
 335:Core/Src/hall_detection.c **** 	}
 1896              		.loc 1 335 48 view .LVU546
 1897 0056 01EB0313 		add	r3, r1, r3, lsl #4
 1898 005a 0022     		movs	r2, #0
 1899              	.LVL125:
 335:Core/Src/hall_detection.c **** 	}
 1900              		.loc 1 335 48 view .LVU547
 1901 005c 83F85C21 		strb	r2, [r3, #348]
 1902              	.L126:
 338:Core/Src/hall_detection.c **** 	for (uint32_t i = 0;  i < TOTAL_NUMBEROFRESULTS; ++ i) {
 1903              		.loc 1 338 2 is_stmt 1 view .LVU548
 1904              	.LVL126:
 339:Core/Src/hall_detection.c **** 		if(gen->results[i].is_valid==YES){
 1905              		.loc 1 339 2 view .LVU549
 1906              	.LBB14:
 339:Core/Src/hall_detection.c **** 		if(gen->results[i].is_valid==YES){
 1907              		.loc 1 339 7 view .LVU550
 339:Core/Src/hall_detection.c **** 		if(gen->results[i].is_valid==YES){
 1908              		.loc 1 339 16 is_stmt 0 view .LVU551
 1909 0060 0023     		movs	r3, #0
 1910              	.LBE14:
 338:Core/Src/hall_detection.c **** 	for (uint32_t i = 0;  i < TOTAL_NUMBEROFRESULTS; ++ i) {
 1911              		.loc 1 338 11 view .LVU552
 1912 0062 1C46     		mov	r4, r3
 1913              	.LVL127:
 1914              	.LBB15:
 339:Core/Src/hall_detection.c **** 		if(gen->results[i].is_valid==YES){
 1915              		.loc 1 339 2 view .LVU553
 1916 0064 07E0     		b	.L127
 1917              	.LVL128:
 1918              	.L144:
 339:Core/Src/hall_detection.c **** 		if(gen->results[i].is_valid==YES){
 1919              		.loc 1 339 2 view .LVU554
 1920              	.LBE15:
 333:Core/Src/hall_detection.c **** 	}else{
 1921              		.loc 1 333 3 is_stmt 1 view .LVU555
 333:Core/Src/hall_detection.c **** 	}else{
 1922              		.loc 1 333 36 is_stmt 0 view .LVU556
 1923 0066 731E     		subs	r3, r6, #1
 333:Core/Src/hall_detection.c **** 	}else{
 1924              		.loc 1 333 48 view .LVU557
 1925 0068 01EB0313 		add	r3, r1, r3, lsl #4
 1926 006c 0122     		movs	r2, #1
 1927              	.LVL129:
 333:Core/Src/hall_detection.c **** 	}else{
 1928              		.loc 1 333 48 view .LVU558
 1929 006e 83F85C21 		strb	r2, [r3, #348]
 1930 0072 F5E7     		b	.L126
ARM GAS  /tmp/ccJ2dceG.s 			page 53


 1931              	.LVL130:
 1932              	.L128:
 1933              	.LBB16:
 339:Core/Src/hall_detection.c **** 		if(gen->results[i].is_valid==YES){
 1934              		.loc 1 339 51 discriminator 2 view .LVU559
 1935 0074 0133     		adds	r3, r3, #1
 1936              	.LVL131:
 1937              	.L127:
 339:Core/Src/hall_detection.c **** 		if(gen->results[i].is_valid==YES){
 1938              		.loc 1 339 2 discriminator 1 view .LVU560
 1939 0076 052B     		cmp	r3, #5
 1940 0078 07D8     		bhi	.L145
 340:Core/Src/hall_detection.c **** 			numberofvalid++;
 1941              		.loc 1 340 3 is_stmt 1 view .LVU561
 340:Core/Src/hall_detection.c **** 			numberofvalid++;
 1942              		.loc 1 340 21 is_stmt 0 view .LVU562
 1943 007a 01EB0312 		add	r2, r1, r3, lsl #4
 1944 007e 92F85C21 		ldrb	r2, [r2, #348]	@ zero_extendqisi2
 340:Core/Src/hall_detection.c **** 			numberofvalid++;
 1945              		.loc 1 340 5 view .LVU563
 1946 0082 012A     		cmp	r2, #1
 1947 0084 F6D1     		bne	.L128
 341:Core/Src/hall_detection.c **** 		}
 1948              		.loc 1 341 4 is_stmt 1 view .LVU564
 341:Core/Src/hall_detection.c **** 		}
 1949              		.loc 1 341 17 is_stmt 0 view .LVU565
 1950 0086 0134     		adds	r4, r4, #1
 1951              	.LVL132:
 341:Core/Src/hall_detection.c **** 		}
 1952              		.loc 1 341 17 view .LVU566
 1953 0088 F4E7     		b	.L128
 1954              	.L145:
 341:Core/Src/hall_detection.c **** 		}
 1955              		.loc 1 341 17 view .LVU567
 1956              	.LBE16:
 345:Core/Src/hall_detection.c **** 		for (uint32_t i = 0; i < gen->numberOfresults; ++i) {			//loop trough results
 1957              		.loc 1 345 2 is_stmt 1 view .LVU568
 345:Core/Src/hall_detection.c **** 		for (uint32_t i = 0; i < gen->numberOfresults; ++i) {			//loop trough results
 1958              		.loc 1 345 4 is_stmt 0 view .LVU569
 1959 008a 022C     		cmp	r4, #2
 1960 008c 58D9     		bls	.L131
 1961              	.LBB17:
 346:Core/Src/hall_detection.c **** 			if(gen->results[i].is_valid==YES){	//skip the not valid results.
 1962              		.loc 1 346 17 view .LVU570
 1963 008e 0024     		movs	r4, #0
 1964              	.LVL133:
 346:Core/Src/hall_detection.c **** 			if(gen->results[i].is_valid==YES){	//skip the not valid results.
 1965              		.loc 1 346 17 view .LVU571
 1966 0090 4BE0     		b	.L130
 1967              	.LVL134:
 1968              	.L134:
 1969              	.LBB18:
 1970              	.LBB19:
 349:Core/Src/hall_detection.c **** 					if(
 1971              		.loc 1 349 52 discriminator 2 view .LVU572
 1972 0092 0133     		adds	r3, r3, #1
 1973              	.LVL135:
ARM GAS  /tmp/ccJ2dceG.s 			page 54


 1974              	.L132:
 349:Core/Src/hall_detection.c **** 					if(
 1975              		.loc 1 349 5 discriminator 1 view .LVU573
 1976 0094 9E42     		cmp	r6, r3
 1977 0096 47D9     		bls	.L133
 350:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[0]==gen->results[j].hall_order[0] &&
 1978              		.loc 1 350 6 is_stmt 1 view .LVU574
 351:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[1]==gen->results[j].hall_order[1] &&
 1979              		.loc 1 351 34 is_stmt 0 view .LVU575
 1980 0098 04F11602 		add	r2, r4, #22
 1981 009c 01EB0212 		add	r2, r1, r2, lsl #4
 1982 00a0 1579     		ldrb	r5, [r2, #4]	@ zero_extendqisi2
 351:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[1]==gen->results[j].hall_order[1] &&
 1983              		.loc 1 351 65 view .LVU576
 1984 00a2 03F11602 		add	r2, r3, #22
 1985 00a6 01EB0212 		add	r2, r1, r2, lsl #4
 1986 00aa 1279     		ldrb	r2, [r2, #4]	@ zero_extendqisi2
 350:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[0]==gen->results[j].hall_order[0] &&
 1987              		.loc 1 350 8 view .LVU577
 1988 00ac 9542     		cmp	r5, r2
 1989 00ae F0D1     		bne	.L134
 352:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[2]==gen->results[j].hall_order[2] &&
 1990              		.loc 1 352 34 view .LVU578
 1991 00b0 01EB0412 		add	r2, r1, r4, lsl #4
 1992 00b4 92F86551 		ldrb	r5, [r2, #357]	@ zero_extendqisi2
 352:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[2]==gen->results[j].hall_order[2] &&
 1993              		.loc 1 352 65 view .LVU579
 1994 00b8 01EB0312 		add	r2, r1, r3, lsl #4
 1995 00bc 92F86521 		ldrb	r2, [r2, #357]	@ zero_extendqisi2
 351:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[1]==gen->results[j].hall_order[1] &&
 1996              		.loc 1 351 69 view .LVU580
 1997 00c0 9542     		cmp	r5, r2
 1998 00c2 E6D1     		bne	.L134
 353:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[0]==gen->results[j].hall_polarity[0] &&
 1999              		.loc 1 353 34 view .LVU581
 2000 00c4 01EB0412 		add	r2, r1, r4, lsl #4
 2001 00c8 92F86651 		ldrb	r5, [r2, #358]	@ zero_extendqisi2
 353:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[0]==gen->results[j].hall_polarity[0] &&
 2002              		.loc 1 353 65 view .LVU582
 2003 00cc 01EB0312 		add	r2, r1, r3, lsl #4
 2004 00d0 92F86621 		ldrb	r2, [r2, #358]	@ zero_extendqisi2
 352:Core/Src/hall_detection.c **** 							gen->results[i].hall_order[2]==gen->results[j].hall_order[2] &&
 2005              		.loc 1 352 69 view .LVU583
 2006 00d4 9542     		cmp	r5, r2
 2007 00d6 DCD1     		bne	.L134
 354:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[1]==gen->results[j].hall_polarity[1] &&
 2008              		.loc 1 354 37 view .LVU584
 2009 00d8 04F11602 		add	r2, r4, #22
 2010 00dc 01EB0212 		add	r2, r1, r2, lsl #4
 2011 00e0 D579     		ldrb	r5, [r2, #7]	@ zero_extendqisi2
 354:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[1]==gen->results[j].hall_polarity[1] &&
 2012              		.loc 1 354 71 view .LVU585
 2013 00e2 03F11602 		add	r2, r3, #22
 2014 00e6 01EB0212 		add	r2, r1, r2, lsl #4
 2015 00ea D279     		ldrb	r2, [r2, #7]	@ zero_extendqisi2
 353:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[0]==gen->results[j].hall_polarity[0] &&
 2016              		.loc 1 353 69 view .LVU586
ARM GAS  /tmp/ccJ2dceG.s 			page 55


 2017 00ec 9542     		cmp	r5, r2
 2018 00ee D0D1     		bne	.L134
 355:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[2]==gen->results[j].hall_polarity[2]
 2019              		.loc 1 355 37 view .LVU587
 2020 00f0 01EB0412 		add	r2, r1, r4, lsl #4
 2021 00f4 92F86851 		ldrb	r5, [r2, #360]	@ zero_extendqisi2
 355:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[2]==gen->results[j].hall_polarity[2]
 2022              		.loc 1 355 71 view .LVU588
 2023 00f8 01EB0312 		add	r2, r1, r3, lsl #4
 2024 00fc 92F86821 		ldrb	r2, [r2, #360]	@ zero_extendqisi2
 354:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[1]==gen->results[j].hall_polarity[1] &&
 2025              		.loc 1 354 75 view .LVU589
 2026 0100 9542     		cmp	r5, r2
 2027 0102 C6D1     		bne	.L134
 356:Core/Src/hall_detection.c **** 							){//do they match?
 2028              		.loc 1 356 37 view .LVU590
 2029 0104 01EB0412 		add	r2, r1, r4, lsl #4
 2030 0108 92F86951 		ldrb	r5, [r2, #361]	@ zero_extendqisi2
 356:Core/Src/hall_detection.c **** 							){//do they match?
 2031              		.loc 1 356 71 view .LVU591
 2032 010c 01EB0312 		add	r2, r1, r3, lsl #4
 2033 0110 92F86921 		ldrb	r2, [r2, #361]	@ zero_extendqisi2
 355:Core/Src/hall_detection.c **** 							gen->results[i].hall_polarity[2]==gen->results[j].hall_polarity[2]
 2034              		.loc 1 355 75 view .LVU592
 2035 0114 9542     		cmp	r5, r2
 2036 0116 BCD1     		bne	.L134
 358:Core/Src/hall_detection.c **** 						if(number_of_results_matching>=NUMBER_OF_VALID_MATCHING_RESULTS){
 2037              		.loc 1 358 8 is_stmt 1 view .LVU593
 358:Core/Src/hall_detection.c **** 						if(number_of_results_matching>=NUMBER_OF_VALID_MATCHING_RESULTS){
 2038              		.loc 1 358 34 is_stmt 0 view .LVU594
 2039 0118 0137     		adds	r7, r7, #1
 2040              	.LVL136:
 359:Core/Src/hall_detection.c **** 							gen->indexOfcorrectResult=i;
 2041              		.loc 1 359 7 is_stmt 1 view .LVU595
 359:Core/Src/hall_detection.c **** 							gen->indexOfcorrectResult=i;
 2042              		.loc 1 359 9 is_stmt 0 view .LVU596
 2043 011a 022F     		cmp	r7, #2
 2044 011c B9D9     		bls	.L134
 360:Core/Src/hall_detection.c **** 							*state=detection_PRESENTATION_FINISH;
 2045              		.loc 1 360 8 is_stmt 1 view .LVU597
 360:Core/Src/hall_detection.c **** 							*state=detection_PRESENTATION_FINISH;
 2046              		.loc 1 360 33 is_stmt 0 view .LVU598
 2047 011e C1F85841 		str	r4, [r1, #344]
 361:Core/Src/hall_detection.c **** 							return;
 2048              		.loc 1 361 8 is_stmt 1 view .LVU599
 361:Core/Src/hall_detection.c **** 							return;
 2049              		.loc 1 361 14 is_stmt 0 view .LVU600
 2050 0122 0623     		movs	r3, #6
 2051              	.LVL137:
 361:Core/Src/hall_detection.c **** 							return;
 2052              		.loc 1 361 14 view .LVU601
 2053 0124 0370     		strb	r3, [r0]
 362:Core/Src/hall_detection.c **** 						}
 2054              		.loc 1 362 8 is_stmt 1 view .LVU602
 2055 0126 7AE7     		b	.L117
 2056              	.LVL138:
 2057              	.L133:
ARM GAS  /tmp/ccJ2dceG.s 			page 56


 362:Core/Src/hall_detection.c **** 						}
 2058              		.loc 1 362 8 is_stmt 0 view .LVU603
 2059              	.LBE19:
 2060              	.LBE18:
 346:Core/Src/hall_detection.c **** 			if(gen->results[i].is_valid==YES){	//skip the not valid results.
 2061              		.loc 1 346 50 discriminator 2 view .LVU604
 2062 0128 0134     		adds	r4, r4, #1
 2063              	.LVL139:
 2064              	.L130:
 346:Core/Src/hall_detection.c **** 			if(gen->results[i].is_valid==YES){	//skip the not valid results.
 2065              		.loc 1 346 3 discriminator 1 view .LVU605
 2066 012a A642     		cmp	r6, r4
 2067 012c 08D9     		bls	.L131
 347:Core/Src/hall_detection.c **** 				uint32_t number_of_results_matching=0;
 2068              		.loc 1 347 4 is_stmt 1 view .LVU606
 347:Core/Src/hall_detection.c **** 				uint32_t number_of_results_matching=0;
 2069              		.loc 1 347 22 is_stmt 0 view .LVU607
 2070 012e 01EB0413 		add	r3, r1, r4, lsl #4
 2071 0132 93F85C31 		ldrb	r3, [r3, #348]	@ zero_extendqisi2
 347:Core/Src/hall_detection.c **** 				uint32_t number_of_results_matching=0;
 2072              		.loc 1 347 6 view .LVU608
 2073 0136 012B     		cmp	r3, #1
 2074 0138 F6D1     		bne	.L133
 2075              	.LBB21:
 2076              	.LBB20:
 349:Core/Src/hall_detection.c **** 					if(
 2077              		.loc 1 349 19 view .LVU609
 2078 013a 0023     		movs	r3, #0
 2079              	.LBE20:
 348:Core/Src/hall_detection.c **** 				for (uint32_t j = 0; j < gen->numberOfresults; ++j) {	//compare that one result with the rest
 2080              		.loc 1 348 14 view .LVU610
 2081 013c 1F46     		mov	r7, r3
 2082 013e A9E7     		b	.L132
 2083              	.LVL140:
 2084              	.L131:
 348:Core/Src/hall_detection.c **** 				for (uint32_t j = 0; j < gen->numberOfresults; ++j) {	//compare that one result with the rest
 2085              		.loc 1 348 14 view .LVU611
 2086 0140 0C46     		mov	r4, r1
 2087 0142 0546     		mov	r5, r0
 2088              	.LBE21:
 2089              	.LBE17:
 371:Core/Src/hall_detection.c **** 	resetVariables_diferences(gen);
 2090              		.loc 1 371 2 is_stmt 1 view .LVU612
 2091 0144 0846     		mov	r0, r1
 2092              	.LVL141:
 371:Core/Src/hall_detection.c **** 	resetVariables_diferences(gen);
 2093              		.loc 1 371 2 is_stmt 0 view .LVU613
 2094 0146 FFF7FEFF 		bl	resetVariables_adquisition
 2095              	.LVL142:
 372:Core/Src/hall_detection.c **** 	gen->start_adquisition_ticks=ticks;
 2096              		.loc 1 372 2 is_stmt 1 view .LVU614
 2097 014a 2046     		mov	r0, r4
 2098 014c FFF7FEFF 		bl	resetVariables_diferences
 2099              	.LVL143:
 373:Core/Src/hall_detection.c **** 	*state=detection_ADQUISITION;
 2100              		.loc 1 373 2 view .LVU615
 373:Core/Src/hall_detection.c **** 	*state=detection_ADQUISITION;
ARM GAS  /tmp/ccJ2dceG.s 			page 57


 2101              		.loc 1 373 30 is_stmt 0 view .LVU616
 2102 0150 024B     		ldr	r3, .L146
 2103 0152 1B68     		ldr	r3, [r3]
 2104 0154 2360     		str	r3, [r4]
 374:Core/Src/hall_detection.c **** 	return;
 2105              		.loc 1 374 2 is_stmt 1 view .LVU617
 374:Core/Src/hall_detection.c **** 	return;
 2106              		.loc 1 374 8 is_stmt 0 view .LVU618
 2107 0156 0323     		movs	r3, #3
 2108 0158 2B70     		strb	r3, [r5]
 375:Core/Src/hall_detection.c **** }
 2109              		.loc 1 375 2 is_stmt 1 view .LVU619
 2110 015a 60E7     		b	.L117
 2111              	.L147:
 2112              		.align	2
 2113              	.L146:
 2114 015c 00000000 		.word	ticks
 2115 0160 38900D00 		.word	888888
 2116              		.cfi_endproc
 2117              	.LFE241:
 2119              		.global	__aeabi_d2iz
 2120              		.section	.text.assign_closest_phase_to_hall,"ax",%progbits
 2121              		.align	1
 2122              		.global	assign_closest_phase_to_hall
 2123              		.syntax unified
 2124              		.thumb
 2125              		.thumb_func
 2126              		.fpu fpv4-sp-d16
 2128              	assign_closest_phase_to_hall:
 2129              	.LVL144:
 2130              	.LFB252:
 682:Core/Src/hall_detection.c **** 
 2131              		.loc 1 682 70 view -0
 2132              		.cfi_startproc
 2133              		@ args = 0, pretend = 0, frame = 16
 2134              		@ frame_needed = 0, uses_anonymous_args = 0
 682:Core/Src/hall_detection.c **** 
 2135              		.loc 1 682 70 is_stmt 0 view .LVU621
 2136 0000 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
 2137              	.LCFI27:
 2138              		.cfi_def_cfa_offset 28
 2139              		.cfi_offset 4, -28
 2140              		.cfi_offset 5, -24
 2141              		.cfi_offset 6, -20
 2142              		.cfi_offset 7, -16
 2143              		.cfi_offset 8, -12
 2144              		.cfi_offset 9, -8
 2145              		.cfi_offset 14, -4
 2146 0004 85B0     		sub	sp, sp, #20
 2147              	.LCFI28:
 2148              		.cfi_def_cfa_offset 48
 2149 0006 0446     		mov	r4, r0
 684:Core/Src/hall_detection.c **** 
 2150              		.loc 1 684 2 is_stmt 1 view .LVU622
 2151 0008 FFF7FEFF 		bl	resetVariables_diferences
 2152              	.LVL145:
 686:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_A]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
ARM GAS  /tmp/ccJ2dceG.s 			page 58


 2153              		.loc 1 686 2 view .LVU623
 2154              	.LBB22:
 686:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_A]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2155              		.loc 1 686 7 view .LVU624
 686:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_A]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2156              		.loc 1 686 16 is_stmt 0 view .LVU625
 2157 000c 0025     		movs	r5, #0
 2158              	.LVL146:
 2159              	.L149:
 686:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_A]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2160              		.loc 1 686 2 discriminator 1 view .LVU626
 2161 000e 052D     		cmp	r5, #5
 2162 0010 6AD8     		bhi	.L168
 687:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_B]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2163              		.loc 1 687 3 is_stmt 1 discriminator 3 view .LVU627
 687:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_B]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2164              		.loc 1 687 84 is_stmt 0 discriminator 3 view .LVU628
 2165 0012 AB1C     		adds	r3, r5, #2
 2166 0014 04EB8303 		add	r3, r4, r3, lsl #2
 2167 0018 5F68     		ldr	r7, [r3, #4]
 687:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_B]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2168              		.loc 1 687 126 discriminator 3 view .LVU629
 2169 001a 05F12403 		add	r3, r5, #36
 2170 001e 54F82390 		ldr	r9, [r4, r3, lsl #2]
 687:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_B]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2171              		.loc 1 687 37 discriminator 3 view .LVU630
 2172 0022 A7EB0900 		sub	r0, r7, r9
 2173 0026 FFF7FEFF 		bl	absolute
 2174              	.LVL147:
 687:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_B]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2175              		.loc 1 687 35 discriminator 3 view .LVU631
 2176 002a D4F80C31 		ldr	r3, [r4, #268]
 2177 002e 1844     		add	r0, r0, r3
 2178 0030 C4F80C01 		str	r0, [r4, #268]
 688:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_C]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2179              		.loc 1 688 3 is_stmt 1 discriminator 3 view .LVU632
 688:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_C]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2180              		.loc 1 688 126 is_stmt 0 discriminator 3 view .LVU633
 2181 0034 05F12E03 		add	r3, r5, #46
 2182 0038 04EB8303 		add	r3, r4, r3, lsl #2
 2183 003c D3F80480 		ldr	r8, [r3, #4]
 688:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_C]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2184              		.loc 1 688 37 discriminator 3 view .LVU634
 2185 0040 A7EB0800 		sub	r0, r7, r8
 2186 0044 FFF7FEFF 		bl	absolute
 2187              	.LVL148:
 688:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_C]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2188              		.loc 1 688 35 discriminator 3 view .LVU635
 2189 0048 D4F81031 		ldr	r3, [r4, #272]
 2190 004c 1844     		add	r0, r0, r3
 2191 004e C4F81001 		str	r0, [r4, #272]
 689:Core/Src/hall_detection.c **** 
 2192              		.loc 1 689 3 is_stmt 1 discriminator 3 view .LVU636
 689:Core/Src/hall_detection.c **** 
 2193              		.loc 1 689 126 is_stmt 0 discriminator 3 view .LVU637
 2194 0052 05F13A03 		add	r3, r5, #58
 2195 0056 54F82360 		ldr	r6, [r4, r3, lsl #2]
ARM GAS  /tmp/ccJ2dceG.s 			page 59


 689:Core/Src/hall_detection.c **** 
 2196              		.loc 1 689 37 discriminator 3 view .LVU638
 2197 005a B81B     		subs	r0, r7, r6
 2198 005c FFF7FEFF 		bl	absolute
 2199              	.LVL149:
 689:Core/Src/hall_detection.c **** 
 2200              		.loc 1 689 35 discriminator 3 view .LVU639
 2201 0060 D4F81431 		ldr	r3, [r4, #276]
 2202 0064 1844     		add	r0, r0, r3
 2203 0066 C4F81401 		str	r0, [r4, #276]
 691:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_B]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 2204              		.loc 1 691 3 is_stmt 1 discriminator 3 view .LVU640
 691:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_B]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 2205              		.loc 1 691 84 is_stmt 0 discriminator 3 view .LVU641
 2206 006a 05F10E03 		add	r3, r5, #14
 2207 006e 54F82370 		ldr	r7, [r4, r3, lsl #2]
 691:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_B]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 2208              		.loc 1 691 37 discriminator 3 view .LVU642
 2209 0072 A7EB0900 		sub	r0, r7, r9
 2210 0076 FFF7FEFF 		bl	absolute
 2211              	.LVL150:
 691:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_B]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 2212              		.loc 1 691 35 discriminator 3 view .LVU643
 2213 007a D4F81831 		ldr	r3, [r4, #280]
 2214 007e 1844     		add	r0, r0, r3
 2215 0080 C4F81801 		str	r0, [r4, #280]
 692:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_C]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 2216              		.loc 1 692 3 is_stmt 1 discriminator 3 view .LVU644
 692:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_C]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 2217              		.loc 1 692 37 is_stmt 0 discriminator 3 view .LVU645
 2218 0084 A7EB0800 		sub	r0, r7, r8
 2219 0088 FFF7FEFF 		bl	absolute
 2220              	.LVL151:
 692:Core/Src/hall_detection.c **** 		gen->differences_phaseB[phase_C]+=absolute((int32_t)gen->currB.zerocrossings_tick[i]-(int32_t)gen
 2221              		.loc 1 692 35 discriminator 3 view .LVU646
 2222 008c D4F81C31 		ldr	r3, [r4, #284]
 2223 0090 1844     		add	r0, r0, r3
 2224 0092 C4F81C01 		str	r0, [r4, #284]
 693:Core/Src/hall_detection.c **** 
 2225              		.loc 1 693 3 is_stmt 1 discriminator 3 view .LVU647
 693:Core/Src/hall_detection.c **** 
 2226              		.loc 1 693 37 is_stmt 0 discriminator 3 view .LVU648
 2227 0096 B81B     		subs	r0, r7, r6
 2228 0098 FFF7FEFF 		bl	absolute
 2229              	.LVL152:
 693:Core/Src/hall_detection.c **** 
 2230              		.loc 1 693 35 discriminator 3 view .LVU649
 2231 009c D4F82031 		ldr	r3, [r4, #288]
 2232 00a0 1844     		add	r0, r0, r3
 2233 00a2 C4F82001 		str	r0, [r4, #288]
 695:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_B]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 2234              		.loc 1 695 3 is_stmt 1 discriminator 3 view .LVU650
 695:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_B]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 2235              		.loc 1 695 84 is_stmt 0 discriminator 3 view .LVU651
 2236 00a6 05F11803 		add	r3, r5, #24
 2237 00aa 04EB8303 		add	r3, r4, r3, lsl #2
 2238 00ae 5F68     		ldr	r7, [r3, #4]
ARM GAS  /tmp/ccJ2dceG.s 			page 60


 695:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_B]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 2239              		.loc 1 695 37 discriminator 3 view .LVU652
 2240 00b0 A7EB0900 		sub	r0, r7, r9
 2241 00b4 FFF7FEFF 		bl	absolute
 2242              	.LVL153:
 695:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_B]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 2243              		.loc 1 695 35 discriminator 3 view .LVU653
 2244 00b8 D4F82431 		ldr	r3, [r4, #292]
 2245 00bc 1844     		add	r0, r0, r3
 2246 00be C4F82401 		str	r0, [r4, #292]
 696:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_C]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 2247              		.loc 1 696 3 is_stmt 1 discriminator 3 view .LVU654
 696:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_C]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 2248              		.loc 1 696 37 is_stmt 0 discriminator 3 view .LVU655
 2249 00c2 A7EB0800 		sub	r0, r7, r8
 2250 00c6 FFF7FEFF 		bl	absolute
 2251              	.LVL154:
 696:Core/Src/hall_detection.c **** 		gen->differences_phaseC[phase_C]+=absolute((int32_t)gen->currC.zerocrossings_tick[i]-(int32_t)gen
 2252              		.loc 1 696 35 discriminator 3 view .LVU656
 2253 00ca D4F82831 		ldr	r3, [r4, #296]
 2254 00ce 1844     		add	r0, r0, r3
 2255 00d0 C4F82801 		str	r0, [r4, #296]
 697:Core/Src/hall_detection.c **** 	}
 2256              		.loc 1 697 3 is_stmt 1 discriminator 3 view .LVU657
 697:Core/Src/hall_detection.c **** 	}
 2257              		.loc 1 697 37 is_stmt 0 discriminator 3 view .LVU658
 2258 00d4 B81B     		subs	r0, r7, r6
 2259 00d6 FFF7FEFF 		bl	absolute
 2260              	.LVL155:
 697:Core/Src/hall_detection.c **** 	}
 2261              		.loc 1 697 35 discriminator 3 view .LVU659
 2262 00da D4F82C31 		ldr	r3, [r4, #300]
 2263 00de 1844     		add	r0, r0, r3
 2264 00e0 C4F82C01 		str	r0, [r4, #300]
 686:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_A]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2265              		.loc 1 686 45 discriminator 3 view .LVU660
 2266 00e4 0135     		adds	r5, r5, #1
 2267              	.LVL156:
 686:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_A]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2268              		.loc 1 686 45 discriminator 3 view .LVU661
 2269 00e6 92E7     		b	.L149
 2270              	.L168:
 686:Core/Src/hall_detection.c **** 		gen->differences_phaseA[phase_A]+=absolute((int32_t)gen->currA.zerocrossings_tick[i]-(int32_t)gen
 2271              		.loc 1 686 45 discriminator 3 view .LVU662
 2272              	.LBE22:
 700:Core/Src/hall_detection.c **** 	int32_t _top_limit		=(int32_t)(gen->results[gen->numberOfresults].electricPeriod_ticks);
 2273              		.loc 1 700 2 is_stmt 1 view .LVU663
 700:Core/Src/hall_detection.c **** 	int32_t _top_limit		=(int32_t)(gen->results[gen->numberOfresults].electricPeriod_ticks);
 2274              		.loc 1 700 52 is_stmt 0 view .LVU664
 2275 00e8 D4F85431 		ldr	r3, [r4, #340]
 700:Core/Src/hall_detection.c **** 	int32_t _top_limit		=(int32_t)(gen->results[gen->numberOfresults].electricPeriod_ticks);
 2276              		.loc 1 700 70 view .LVU665
 2277 00ec 04EB0313 		add	r3, r4, r3, lsl #4
 2278 00f0 D3F86071 		ldr	r7, [r3, #352]
 700:Core/Src/hall_detection.c **** 	int32_t _top_limit		=(int32_t)(gen->results[gen->numberOfresults].electricPeriod_ticks);
 2279              		.loc 1 700 94 view .LVU666
 2280 00f4 7808     		lsrs	r0, r7, #1
ARM GAS  /tmp/ccJ2dceG.s 			page 61


 2281 00f6 FFF7FEFF 		bl	__aeabi_ui2d
 2282              	.LVL157:
 2283 00fa 6BA3     		adr	r3, .L173+8
 2284 00fc D3E90023 		ldrd	r2, [r3]
 2285 0100 FFF7FEFF 		bl	__aeabi_dmul
 2286              	.LVL158:
 700:Core/Src/hall_detection.c **** 	int32_t _top_limit		=(int32_t)(gen->results[gen->numberOfresults].electricPeriod_ticks);
 2287              		.loc 1 700 10 view .LVU667
 2288 0104 FFF7FEFF 		bl	__aeabi_d2iz
 2289              	.LVL159:
 2290 0108 0646     		mov	r6, r0
 2291              	.LVL160:
 701:Core/Src/hall_detection.c **** 	int32_t minimum[NUMBEROFPHASES]={0xFF,0xFF,0xFF};
 2292              		.loc 1 701 2 is_stmt 1 view .LVU668
 702:Core/Src/hall_detection.c **** 
 2293              		.loc 1 702 2 view .LVU669
 702:Core/Src/hall_detection.c **** 
 2294              		.loc 1 702 10 is_stmt 0 view .LVU670
 2295 010a 654B     		ldr	r3, .L173
 2296 010c 93E80700 		ldm	r3, {r0, r1, r2}
 2297              	.LVL161:
 702:Core/Src/hall_detection.c **** 
 2298              		.loc 1 702 10 view .LVU671
 2299 0110 04AB     		add	r3, sp, #16
 2300 0112 03E90700 		stmdb	r3, {r0, r1, r2}
 704:Core/Src/hall_detection.c **** 		gen->differences_phaseA[i]/=MAXZEROCROSSINGS;
 2301              		.loc 1 704 2 is_stmt 1 view .LVU672
 2302              	.LBB23:
 704:Core/Src/hall_detection.c **** 		gen->differences_phaseA[i]/=MAXZEROCROSSINGS;
 2303              		.loc 1 704 7 view .LVU673
 2304              	.LVL162:
 704:Core/Src/hall_detection.c **** 		gen->differences_phaseA[i]/=MAXZEROCROSSINGS;
 2305              		.loc 1 704 16 is_stmt 0 view .LVU674
 2306 0116 0023     		movs	r3, #0
 704:Core/Src/hall_detection.c **** 		gen->differences_phaseA[i]/=MAXZEROCROSSINGS;
 2307              		.loc 1 704 2 view .LVU675
 2308 0118 53E0     		b	.L151
 2309              	.LVL163:
 2310              	.L152:
 714:Core/Src/hall_detection.c **** 		}
 2311              		.loc 1 714 4 is_stmt 1 view .LVU676
 714:Core/Src/hall_detection.c **** 		}
 2312              		.loc 1 714 36 is_stmt 0 view .LVU677
 2313 011a 03F14C02 		add	r2, r3, #76
 2314 011e 0020     		movs	r0, #0
 2315 0120 44F82200 		str	r0, [r4, r2, lsl #2]
 2316              	.L153:
 717:Core/Src/hall_detection.c **** 			gen->differences_phaseB[i]%=_bottom_limit;
 2317              		.loc 1 717 3 is_stmt 1 view .LVU678
 717:Core/Src/hall_detection.c **** 			gen->differences_phaseB[i]%=_bottom_limit;
 2318              		.loc 1 717 5 is_stmt 0 view .LVU679
 2319 0124 B142     		cmp	r1, r6
 2320 0126 0FDD     		ble	.L154
 717:Core/Src/hall_detection.c **** 			gen->differences_phaseB[i]%=_bottom_limit;
 2321              		.loc 1 717 47 discriminator 1 view .LVU680
 2322 0128 B942     		cmp	r1, r7
 2323 012a 0DDA     		bge	.L154
ARM GAS  /tmp/ccJ2dceG.s 			page 62


 718:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_B][i]=1;
 2324              		.loc 1 718 4 is_stmt 1 view .LVU681
 718:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_B][i]=1;
 2325              		.loc 1 718 30 is_stmt 0 view .LVU682
 2326 012c 03F14600 		add	r0, r3, #70
 2327 0130 91FBF6F2 		sdiv	r2, r1, r6
 2328 0134 06FB1211 		mls	r1, r6, r2, r1
 2329 0138 44F82010 		str	r1, [r4, r0, lsl #2]
 719:Core/Src/hall_detection.c **** 		}else{
 2330              		.loc 1 719 4 is_stmt 1 view .LVU683
 719:Core/Src/hall_detection.c **** 		}else{
 2331              		.loc 1 719 36 is_stmt 0 view .LVU684
 2332 013c 03F14F02 		add	r2, r3, #79
 2333 0140 0121     		movs	r1, #1
 2334 0142 44F82210 		str	r1, [r4, r2, lsl #2]
 2335 0146 04E0     		b	.L155
 2336              	.L154:
 721:Core/Src/hall_detection.c **** 		}
 2337              		.loc 1 721 4 is_stmt 1 view .LVU685
 721:Core/Src/hall_detection.c **** 		}
 2338              		.loc 1 721 36 is_stmt 0 view .LVU686
 2339 0148 03F14F02 		add	r2, r3, #79
 2340 014c 0021     		movs	r1, #0
 2341 014e 44F82210 		str	r1, [r4, r2, lsl #2]
 2342              	.L155:
 724:Core/Src/hall_detection.c **** 			gen->differences_phaseC[i]%=_bottom_limit;
 2343              		.loc 1 724 3 is_stmt 1 view .LVU687
 724:Core/Src/hall_detection.c **** 			gen->differences_phaseC[i]%=_bottom_limit;
 2344              		.loc 1 724 29 is_stmt 0 view .LVU688
 2345 0152 03F14802 		add	r2, r3, #72
 2346 0156 04EB8202 		add	r2, r4, r2, lsl #2
 2347 015a 5268     		ldr	r2, [r2, #4]
 724:Core/Src/hall_detection.c **** 			gen->differences_phaseC[i]%=_bottom_limit;
 2348              		.loc 1 724 5 view .LVU689
 2349 015c B242     		cmp	r2, r6
 2350 015e 10DD     		ble	.L156
 724:Core/Src/hall_detection.c **** 			gen->differences_phaseC[i]%=_bottom_limit;
 2351              		.loc 1 724 47 discriminator 1 view .LVU690
 2352 0160 BA42     		cmp	r2, r7
 2353 0162 0EDA     		bge	.L156
 725:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_C][i]=1;
 2354              		.loc 1 725 4 is_stmt 1 view .LVU691
 725:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_C][i]=1;
 2355              		.loc 1 725 30 is_stmt 0 view .LVU692
 2356 0164 03F14801 		add	r1, r3, #72
 2357 0168 04EB8101 		add	r1, r4, r1, lsl #2
 2358 016c 92FBF6F0 		sdiv	r0, r2, r6
 2359 0170 06FB1022 		mls	r2, r6, r0, r2
 2360 0174 4A60     		str	r2, [r1, #4]
 726:Core/Src/hall_detection.c **** 		}else{
 2361              		.loc 1 726 4 is_stmt 1 view .LVU693
 726:Core/Src/hall_detection.c **** 		}else{
 2362              		.loc 1 726 36 is_stmt 0 view .LVU694
 2363 0176 03F15202 		add	r2, r3, #82
 2364 017a 0121     		movs	r1, #1
 2365 017c 44F82210 		str	r1, [r4, r2, lsl #2]
 2366 0180 04E0     		b	.L157
ARM GAS  /tmp/ccJ2dceG.s 			page 63


 2367              	.L156:
 728:Core/Src/hall_detection.c **** 		}
 2368              		.loc 1 728 4 is_stmt 1 view .LVU695
 728:Core/Src/hall_detection.c **** 		}
 2369              		.loc 1 728 36 is_stmt 0 view .LVU696
 2370 0182 03F15202 		add	r2, r3, #82
 2371 0186 0021     		movs	r1, #0
 2372 0188 44F82210 		str	r1, [r4, r2, lsl #2]
 2373              	.L157:
 732:Core/Src/hall_detection.c **** 			minimum[phase_A]=gen->differences_phaseA[i];
 2374              		.loc 1 732 3 is_stmt 1 view .LVU697
 732:Core/Src/hall_detection.c **** 			minimum[phase_A]=gen->differences_phaseA[i];
 2375              		.loc 1 732 29 is_stmt 0 view .LVU698
 2376 018c 03F14202 		add	r2, r3, #66
 2377 0190 04EB8202 		add	r2, r4, r2, lsl #2
 2378 0194 5268     		ldr	r2, [r2, #4]
 732:Core/Src/hall_detection.c **** 			minimum[phase_A]=gen->differences_phaseA[i];
 2379              		.loc 1 732 40 view .LVU699
 2380 0196 0199     		ldr	r1, [sp, #4]
 732:Core/Src/hall_detection.c **** 			minimum[phase_A]=gen->differences_phaseA[i];
 2381              		.loc 1 732 5 view .LVU700
 2382 0198 8A42     		cmp	r2, r1
 2383 019a 00DA     		bge	.L158
 733:Core/Src/hall_detection.c **** 		}
 2384              		.loc 1 733 4 is_stmt 1 view .LVU701
 733:Core/Src/hall_detection.c **** 		}
 2385              		.loc 1 733 20 is_stmt 0 view .LVU702
 2386 019c 0192     		str	r2, [sp, #4]
 2387              	.L158:
 736:Core/Src/hall_detection.c **** 			minimum[phase_B]=gen->differences_phaseB[i];
 2388              		.loc 1 736 3 is_stmt 1 view .LVU703
 736:Core/Src/hall_detection.c **** 			minimum[phase_B]=gen->differences_phaseB[i];
 2389              		.loc 1 736 29 is_stmt 0 view .LVU704
 2390 019e 03F14602 		add	r2, r3, #70
 2391 01a2 54F82220 		ldr	r2, [r4, r2, lsl #2]
 736:Core/Src/hall_detection.c **** 			minimum[phase_B]=gen->differences_phaseB[i];
 2392              		.loc 1 736 40 view .LVU705
 2393 01a6 0299     		ldr	r1, [sp, #8]
 736:Core/Src/hall_detection.c **** 			minimum[phase_B]=gen->differences_phaseB[i];
 2394              		.loc 1 736 5 view .LVU706
 2395 01a8 8A42     		cmp	r2, r1
 2396 01aa 00DA     		bge	.L159
 737:Core/Src/hall_detection.c **** 		}
 2397              		.loc 1 737 4 is_stmt 1 view .LVU707
 737:Core/Src/hall_detection.c **** 		}
 2398              		.loc 1 737 20 is_stmt 0 view .LVU708
 2399 01ac 0292     		str	r2, [sp, #8]
 2400              	.L159:
 740:Core/Src/hall_detection.c **** 			minimum[phase_C]=gen->differences_phaseC[i];
 2401              		.loc 1 740 3 is_stmt 1 view .LVU709
 740:Core/Src/hall_detection.c **** 			minimum[phase_C]=gen->differences_phaseC[i];
 2402              		.loc 1 740 29 is_stmt 0 view .LVU710
 2403 01ae 03F14802 		add	r2, r3, #72
 2404 01b2 04EB8202 		add	r2, r4, r2, lsl #2
 2405 01b6 5268     		ldr	r2, [r2, #4]
 740:Core/Src/hall_detection.c **** 			minimum[phase_C]=gen->differences_phaseC[i];
 2406              		.loc 1 740 40 view .LVU711
ARM GAS  /tmp/ccJ2dceG.s 			page 64


 2407 01b8 0399     		ldr	r1, [sp, #12]
 740:Core/Src/hall_detection.c **** 			minimum[phase_C]=gen->differences_phaseC[i];
 2408              		.loc 1 740 5 view .LVU712
 2409 01ba 8A42     		cmp	r2, r1
 2410 01bc 00DA     		bge	.L160
 741:Core/Src/hall_detection.c **** 		}
 2411              		.loc 1 741 4 is_stmt 1 view .LVU713
 741:Core/Src/hall_detection.c **** 		}
 2412              		.loc 1 741 20 is_stmt 0 view .LVU714
 2413 01be 0392     		str	r2, [sp, #12]
 2414              	.L160:
 704:Core/Src/hall_detection.c **** 		gen->differences_phaseA[i]/=MAXZEROCROSSINGS;
 2415              		.loc 1 704 43 discriminator 2 view .LVU715
 2416 01c0 0133     		adds	r3, r3, #1
 2417              	.LVL164:
 2418              	.L151:
 704:Core/Src/hall_detection.c **** 		gen->differences_phaseA[i]/=MAXZEROCROSSINGS;
 2419              		.loc 1 704 2 discriminator 1 view .LVU716
 2420 01c2 022B     		cmp	r3, #2
 2421 01c4 32D8     		bhi	.L169
 705:Core/Src/hall_detection.c **** 		gen->differences_phaseB[i]/=MAXZEROCROSSINGS;
 2422              		.loc 1 705 3 is_stmt 1 view .LVU717
 705:Core/Src/hall_detection.c **** 		gen->differences_phaseB[i]/=MAXZEROCROSSINGS;
 2423              		.loc 1 705 29 is_stmt 0 view .LVU718
 2424 01c6 03F14201 		add	r1, r3, #66
 2425 01ca 04EB8101 		add	r1, r4, r1, lsl #2
 2426 01ce 4868     		ldr	r0, [r1, #4]
 2427 01d0 344A     		ldr	r2, .L173+4
 2428 01d2 82FB00C5 		smull	ip, r5, r2, r0
 2429 01d6 A5EBE070 		sub	r0, r5, r0, asr #31
 2430 01da 4860     		str	r0, [r1, #4]
 706:Core/Src/hall_detection.c **** 		gen->differences_phaseC[i]/=MAXZEROCROSSINGS;
 2431              		.loc 1 706 3 is_stmt 1 view .LVU719
 706:Core/Src/hall_detection.c **** 		gen->differences_phaseC[i]/=MAXZEROCROSSINGS;
 2432              		.loc 1 706 29 is_stmt 0 view .LVU720
 2433 01dc 03F14605 		add	r5, r3, #70
 2434 01e0 54F82510 		ldr	r1, [r4, r5, lsl #2]
 2435 01e4 82FB01EC 		smull	lr, ip, r2, r1
 2436 01e8 ACEBE171 		sub	r1, ip, r1, asr #31
 2437 01ec 44F82510 		str	r1, [r4, r5, lsl #2]
 707:Core/Src/hall_detection.c **** 
 2438              		.loc 1 707 3 is_stmt 1 view .LVU721
 707:Core/Src/hall_detection.c **** 
 2439              		.loc 1 707 29 is_stmt 0 view .LVU722
 2440 01f0 03F14805 		add	r5, r3, #72
 2441 01f4 04EB8505 		add	r5, r4, r5, lsl #2
 2442 01f8 D5F804C0 		ldr	ip, [r5, #4]
 2443 01fc 82FB0CE2 		smull	lr, r2, r2, ip
 2444 0200 A2EBEC72 		sub	r2, r2, ip, asr #31
 2445 0204 6A60     		str	r2, [r5, #4]
 710:Core/Src/hall_detection.c **** 			gen->differences_phaseA[i]%=_bottom_limit;
 2446              		.loc 1 710 3 is_stmt 1 view .LVU723
 710:Core/Src/hall_detection.c **** 			gen->differences_phaseA[i]%=_bottom_limit;
 2447              		.loc 1 710 5 is_stmt 0 view .LVU724
 2448 0206 B042     		cmp	r0, r6
 2449 0208 87DD     		ble	.L152
 710:Core/Src/hall_detection.c **** 			gen->differences_phaseA[i]%=_bottom_limit;
ARM GAS  /tmp/ccJ2dceG.s 			page 65


 2450              		.loc 1 710 47 discriminator 1 view .LVU725
 2451 020a B842     		cmp	r0, r7
 2452 020c 85DA     		bge	.L152
 711:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_A][i]=1;
 2453              		.loc 1 711 4 is_stmt 1 view .LVU726
 711:Core/Src/hall_detection.c **** 			gen->shifted_polarity[hall_A][i]=1;
 2454              		.loc 1 711 30 is_stmt 0 view .LVU727
 2455 020e 03F14202 		add	r2, r3, #66
 2456 0212 04EB8202 		add	r2, r4, r2, lsl #2
 2457 0216 90FBF6F5 		sdiv	r5, r0, r6
 2458 021a 06FB1500 		mls	r0, r6, r5, r0
 2459 021e 5060     		str	r0, [r2, #4]
 712:Core/Src/hall_detection.c **** 		}else{
 2460              		.loc 1 712 4 is_stmt 1 view .LVU728
 712:Core/Src/hall_detection.c **** 		}else{
 2461              		.loc 1 712 36 is_stmt 0 view .LVU729
 2462 0220 03F14C02 		add	r2, r3, #76
 2463 0224 0120     		movs	r0, #1
 2464 0226 44F82200 		str	r0, [r4, r2, lsl #2]
 2465 022a 7BE7     		b	.L153
 2466              	.L169:
 712:Core/Src/hall_detection.c **** 		}else{
 2467              		.loc 1 712 36 view .LVU730
 2468              	.LBE23:
 2469              	.LBB24:
 745:Core/Src/hall_detection.c **** 		if(gen->differences_phaseA[i]==minimum[phase_A]){
 2470              		.loc 1 745 16 view .LVU731
 2471 022c 0023     		movs	r3, #0
 2472              	.LVL165:
 745:Core/Src/hall_detection.c **** 		if(gen->differences_phaseA[i]==minimum[phase_A]){
 2473              		.loc 1 745 16 view .LVU732
 2474 022e 12E0     		b	.L162
 2475              	.LVL166:
 2476              	.L171:
 747:Core/Src/hall_detection.c **** 		}
 2477              		.loc 1 747 4 is_stmt 1 view .LVU733
 747:Core/Src/hall_detection.c **** 		}
 2478              		.loc 1 747 20 is_stmt 0 view .LVU734
 2479 0230 D4F85421 		ldr	r2, [r4, #340]
 747:Core/Src/hall_detection.c **** 		}
 2480              		.loc 1 747 52 view .LVU735
 2481 0234 04EB0212 		add	r2, r4, r2, lsl #4
 2482 0238 1A44     		add	r2, r2, r3
 2483 023a 0021     		movs	r1, #0
 2484 023c 82F86411 		strb	r1, [r2, #356]
 2485 0240 13E0     		b	.L163
 2486              	.L172:
 751:Core/Src/hall_detection.c **** 		}
 2487              		.loc 1 751 4 is_stmt 1 view .LVU736
 751:Core/Src/hall_detection.c **** 		}
 2488              		.loc 1 751 20 is_stmt 0 view .LVU737
 2489 0242 D4F85421 		ldr	r2, [r4, #340]
 751:Core/Src/hall_detection.c **** 		}
 2490              		.loc 1 751 52 view .LVU738
 2491 0246 04EB0212 		add	r2, r4, r2, lsl #4
 2492 024a 1A44     		add	r2, r2, r3
 2493 024c 0121     		movs	r1, #1
ARM GAS  /tmp/ccJ2dceG.s 			page 66


 2494 024e 82F86411 		strb	r1, [r2, #356]
 2495 0252 11E0     		b	.L164
 2496              	.L165:
 745:Core/Src/hall_detection.c **** 		if(gen->differences_phaseA[i]==minimum[phase_A]){
 2497              		.loc 1 745 43 discriminator 2 view .LVU739
 2498 0254 0133     		adds	r3, r3, #1
 2499              	.LVL167:
 2500              	.L162:
 745:Core/Src/hall_detection.c **** 		if(gen->differences_phaseA[i]==minimum[phase_A]){
 2501              		.loc 1 745 2 discriminator 1 view .LVU740
 2502 0256 022B     		cmp	r3, #2
 2503 0258 1FD8     		bhi	.L170
 746:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_A;
 2504              		.loc 1 746 3 is_stmt 1 view .LVU741
 746:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_A;
 2505              		.loc 1 746 29 is_stmt 0 view .LVU742
 2506 025a 03F14202 		add	r2, r3, #66
 2507 025e 04EB8202 		add	r2, r4, r2, lsl #2
 2508 0262 5168     		ldr	r1, [r2, #4]
 746:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_A;
 2509              		.loc 1 746 41 view .LVU743
 2510 0264 019A     		ldr	r2, [sp, #4]
 746:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_A;
 2511              		.loc 1 746 5 view .LVU744
 2512 0266 9142     		cmp	r1, r2
 2513 0268 E2D0     		beq	.L171
 2514              	.L163:
 750:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_B;
 2515              		.loc 1 750 3 is_stmt 1 view .LVU745
 750:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_B;
 2516              		.loc 1 750 29 is_stmt 0 view .LVU746
 2517 026a 03F14602 		add	r2, r3, #70
 2518 026e 54F82210 		ldr	r1, [r4, r2, lsl #2]
 750:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_B;
 2519              		.loc 1 750 41 view .LVU747
 2520 0272 029A     		ldr	r2, [sp, #8]
 750:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_B;
 2521              		.loc 1 750 5 view .LVU748
 2522 0274 9142     		cmp	r1, r2
 2523 0276 E4D0     		beq	.L172
 2524              	.L164:
 754:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_C;
 2525              		.loc 1 754 3 is_stmt 1 view .LVU749
 754:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_C;
 2526              		.loc 1 754 29 is_stmt 0 view .LVU750
 2527 0278 03F14802 		add	r2, r3, #72
 2528 027c 04EB8202 		add	r2, r4, r2, lsl #2
 2529 0280 5168     		ldr	r1, [r2, #4]
 754:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_C;
 2530              		.loc 1 754 41 view .LVU751
 2531 0282 039A     		ldr	r2, [sp, #12]
 754:Core/Src/hall_detection.c **** 			gen->results[gen->numberOfresults].hall_order[i]=phase_C;
 2532              		.loc 1 754 5 view .LVU752
 2533 0284 9142     		cmp	r1, r2
 2534 0286 E5D1     		bne	.L165
 755:Core/Src/hall_detection.c **** 		}
 2535              		.loc 1 755 4 is_stmt 1 view .LVU753
ARM GAS  /tmp/ccJ2dceG.s 			page 67


 755:Core/Src/hall_detection.c **** 		}
 2536              		.loc 1 755 20 is_stmt 0 view .LVU754
 2537 0288 D4F85421 		ldr	r2, [r4, #340]
 755:Core/Src/hall_detection.c **** 		}
 2538              		.loc 1 755 52 view .LVU755
 2539 028c 04EB0212 		add	r2, r4, r2, lsl #4
 2540 0290 1A44     		add	r2, r2, r3
 2541 0292 0221     		movs	r1, #2
 2542 0294 82F86411 		strb	r1, [r2, #356]
 2543 0298 DCE7     		b	.L165
 2544              	.L170:
 755:Core/Src/hall_detection.c **** 		}
 2545              		.loc 1 755 52 view .LVU756
 2546              	.LBE24:
 758:Core/Src/hall_detection.c **** 
 2547              		.loc 1 758 1 view .LVU757
 2548 029a 05B0     		add	sp, sp, #20
 2549              	.LCFI29:
 2550              		.cfi_def_cfa_offset 28
 2551              		@ sp needed
 2552 029c BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 2553              	.LVL168:
 2554              	.L174:
 758:Core/Src/hall_detection.c **** 
 2555              		.loc 1 758 1 view .LVU758
 2556              		.align	3
 2557              	.L173:
 2558 02a0 00000000 		.word	.LANCHOR3
 2559 02a4 ABAAAA2A 		.word	715827883
 2560 02a8 66666666 		.word	1717986918
 2561 02ac 6666EE3F 		.word	1072588390
 2562              		.cfi_endproc
 2563              	.LFE252:
 2565              		.section	.text.interpretation,"ax",%progbits
 2566              		.align	1
 2567              		.global	interpretation
 2568              		.syntax unified
 2569              		.thumb
 2570              		.thumb_func
 2571              		.fpu fpv4-sp-d16
 2573              	interpretation:
 2574              	.LVL169:
 2575              	.LFB240:
 295:Core/Src/hall_detection.c **** 	//timeout
 2576              		.loc 1 295 84 is_stmt 1 view -0
 2577              		.cfi_startproc
 2578              		@ args = 0, pretend = 0, frame = 0
 2579              		@ frame_needed = 0, uses_anonymous_args = 0
 295:Core/Src/hall_detection.c **** 	//timeout
 2580              		.loc 1 295 84 is_stmt 0 view .LVU760
 2581 0000 38B5     		push	{r3, r4, r5, lr}
 2582              	.LCFI30:
 2583              		.cfi_def_cfa_offset 16
 2584              		.cfi_offset 3, -16
 2585              		.cfi_offset 4, -12
 2586              		.cfi_offset 5, -8
 2587              		.cfi_offset 14, -4
ARM GAS  /tmp/ccJ2dceG.s 			page 68


 297:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 2588              		.loc 1 297 2 is_stmt 1 view .LVU761
 297:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 2589              		.loc 1 297 11 is_stmt 0 view .LVU762
 2590 0002 0D4B     		ldr	r3, .L179
 2591 0004 1A68     		ldr	r2, [r3]
 297:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 2592              		.loc 1 297 4 view .LVU763
 2593 0006 0D4B     		ldr	r3, .L179+4
 2594 0008 9A42     		cmp	r2, r3
 2595 000a 02D9     		bls	.L176
 298:Core/Src/hall_detection.c **** 		return;
 2596              		.loc 1 298 3 is_stmt 1 view .LVU764
 298:Core/Src/hall_detection.c **** 		return;
 2597              		.loc 1 298 9 is_stmt 0 view .LVU765
 2598 000c 0723     		movs	r3, #7
 2599 000e 0370     		strb	r3, [r0]
 299:Core/Src/hall_detection.c **** 	}
 2600              		.loc 1 299 3 is_stmt 1 view .LVU766
 2601              	.LVL170:
 2602              	.L175:
 306:Core/Src/hall_detection.c **** 
 2603              		.loc 1 306 1 is_stmt 0 view .LVU767
 2604 0010 38BD     		pop	{r3, r4, r5, pc}
 2605              	.LVL171:
 2606              	.L176:
 306:Core/Src/hall_detection.c **** 
 2607              		.loc 1 306 1 view .LVU768
 2608 0012 0C46     		mov	r4, r1
 2609 0014 0546     		mov	r5, r0
 301:Core/Src/hall_detection.c **** 	assign_polarity(gen);
 2610              		.loc 1 301 2 is_stmt 1 view .LVU769
 2611 0016 0846     		mov	r0, r1
 2612              	.LVL172:
 301:Core/Src/hall_detection.c **** 	assign_polarity(gen);
 2613              		.loc 1 301 2 is_stmt 0 view .LVU770
 2614 0018 FFF7FEFF 		bl	assign_closest_phase_to_hall
 2615              	.LVL173:
 302:Core/Src/hall_detection.c **** 	gen->numberOfresults++;
 2616              		.loc 1 302 2 is_stmt 1 view .LVU771
 2617 001c 2046     		mov	r0, r4
 2618 001e FFF7FEFF 		bl	assign_polarity
 2619              	.LVL174:
 303:Core/Src/hall_detection.c **** 	gen->start_adquisition_ticks=ticks;
 2620              		.loc 1 303 2 view .LVU772
 303:Core/Src/hall_detection.c **** 	gen->start_adquisition_ticks=ticks;
 2621              		.loc 1 303 5 is_stmt 0 view .LVU773
 2622 0022 D4F85431 		ldr	r3, [r4, #340]
 303:Core/Src/hall_detection.c **** 	gen->start_adquisition_ticks=ticks;
 2623              		.loc 1 303 22 view .LVU774
 2624 0026 0133     		adds	r3, r3, #1
 2625 0028 C4F85431 		str	r3, [r4, #340]
 304:Core/Src/hall_detection.c **** 	*state=detection_VALIDATION;
 2626              		.loc 1 304 2 is_stmt 1 view .LVU775
 304:Core/Src/hall_detection.c **** 	*state=detection_VALIDATION;
 2627              		.loc 1 304 30 is_stmt 0 view .LVU776
 2628 002c 024B     		ldr	r3, .L179
ARM GAS  /tmp/ccJ2dceG.s 			page 69


 2629 002e 1B68     		ldr	r3, [r3]
 2630 0030 2360     		str	r3, [r4]
 305:Core/Src/hall_detection.c **** }
 2631              		.loc 1 305 2 is_stmt 1 view .LVU777
 305:Core/Src/hall_detection.c **** }
 2632              		.loc 1 305 8 is_stmt 0 view .LVU778
 2633 0032 0523     		movs	r3, #5
 2634 0034 2B70     		strb	r3, [r5]
 2635 0036 EBE7     		b	.L175
 2636              	.L180:
 2637              		.align	2
 2638              	.L179:
 2639 0038 00000000 		.word	ticks
 2640 003c 38900D00 		.word	888888
 2641              		.cfi_endproc
 2642              	.LFE240:
 2644              		.section	.text.resetVariables_results,"ax",%progbits
 2645              		.align	1
 2646              		.global	resetVariables_results
 2647              		.syntax unified
 2648              		.thumb
 2649              		.thumb_func
 2650              		.fpu fpv4-sp-d16
 2652              	resetVariables_results:
 2653              	.LVL175:
 2654              	.LFB256:
 834:Core/Src/hall_detection.c **** 
 835:Core/Src/hall_detection.c **** /**
 836:Core/Src/hall_detection.c **** * \brief just resets to 0 the results (al resets are split like this because we are exection time c
 837:Core/Src/hall_detection.c **** * \param hall_detection_general_struct *gen, pointer to the huge structure.
 838:Core/Src/hall_detection.c **** */
 839:Core/Src/hall_detection.c **** void resetVariables_results(hall_detection_general_struct *gen){
 2655              		.loc 1 839 64 is_stmt 1 view -0
 2656              		.cfi_startproc
 2657              		@ args = 0, pretend = 0, frame = 0
 2658              		@ frame_needed = 0, uses_anonymous_args = 0
 2659              		@ link register save eliminated.
 2660              		.loc 1 839 64 is_stmt 0 view .LVU780
 2661 0000 70B4     		push	{r4, r5, r6}
 2662              	.LCFI31:
 2663              		.cfi_def_cfa_offset 12
 2664              		.cfi_offset 4, -12
 2665              		.cfi_offset 5, -8
 2666              		.cfi_offset 6, -4
 2667 0002 0446     		mov	r4, r0
 840:Core/Src/hall_detection.c **** 	gen->results[0]=empty_general.results[0];
 2668              		.loc 1 840 2 is_stmt 1 view .LVU781
 2669              		.loc 1 840 17 is_stmt 0 view .LVU782
 2670 0004 204D     		ldr	r5, .L183
 2671 0006 00F5AE76 		add	r6, r0, #348
 2672 000a 05F5AE73 		add	r3, r5, #348
 2673 000e 0FCB     		ldm	r3, {r0, r1, r2, r3}
 2674              	.LVL176:
 2675              		.loc 1 840 17 view .LVU783
 2676 0010 86E80F00 		stm	r6, {r0, r1, r2, r3}
 841:Core/Src/hall_detection.c **** 	gen->results[1]=empty_general.results[1];
 2677              		.loc 1 841 2 is_stmt 1 view .LVU784
ARM GAS  /tmp/ccJ2dceG.s 			page 70


 2678              		.loc 1 841 17 is_stmt 0 view .LVU785
 2679 0014 04F5B676 		add	r6, r4, #364
 2680 0018 05F5B673 		add	r3, r5, #364
 2681 001c 0FCB     		ldm	r3, {r0, r1, r2, r3}
 2682 001e 86E80F00 		stm	r6, {r0, r1, r2, r3}
 842:Core/Src/hall_detection.c **** 	gen->results[2]=empty_general.results[2];
 2683              		.loc 1 842 2 is_stmt 1 view .LVU786
 2684              		.loc 1 842 17 is_stmt 0 view .LVU787
 2685 0022 04F5BE76 		add	r6, r4, #380
 2686 0026 05F5BE73 		add	r3, r5, #380
 2687 002a 0FCB     		ldm	r3, {r0, r1, r2, r3}
 2688 002c 86E80F00 		stm	r6, {r0, r1, r2, r3}
 843:Core/Src/hall_detection.c **** 	gen->results[3]=empty_general.results[3];
 2689              		.loc 1 843 2 is_stmt 1 view .LVU788
 2690              		.loc 1 843 17 is_stmt 0 view .LVU789
 2691 0030 04F5C676 		add	r6, r4, #396
 2692 0034 05F5C673 		add	r3, r5, #396
 2693 0038 0FCB     		ldm	r3, {r0, r1, r2, r3}
 2694 003a 86E80F00 		stm	r6, {r0, r1, r2, r3}
 844:Core/Src/hall_detection.c **** 	gen->results[4]=empty_general.results[4];
 2695              		.loc 1 844 2 is_stmt 1 view .LVU790
 2696              		.loc 1 844 17 is_stmt 0 view .LVU791
 2697 003e 04F5CE76 		add	r6, r4, #412
 2698 0042 05F5CE73 		add	r3, r5, #412
 2699 0046 0FCB     		ldm	r3, {r0, r1, r2, r3}
 2700 0048 86E80F00 		stm	r6, {r0, r1, r2, r3}
 845:Core/Src/hall_detection.c **** 	gen->results[5]=empty_general.results[5];
 2701              		.loc 1 845 2 is_stmt 1 view .LVU792
 2702              		.loc 1 845 17 is_stmt 0 view .LVU793
 2703 004c 04F5D676 		add	r6, r4, #428
 2704 0050 05F5D675 		add	r5, r5, #428
 2705 0054 95E80F00 		ldm	r5, {r0, r1, r2, r3}
 2706 0058 86E80F00 		stm	r6, {r0, r1, r2, r3}
 846:Core/Src/hall_detection.c **** 
 847:Core/Src/hall_detection.c **** 	gen->shifted_polarity[0][0]=empty_general.shifted_polarity[0][0];
 2707              		.loc 1 847 2 is_stmt 1 view .LVU794
 2708              		.loc 1 847 29 is_stmt 0 view .LVU795
 2709 005c 0023     		movs	r3, #0
 2710 005e C4F83031 		str	r3, [r4, #304]
 848:Core/Src/hall_detection.c **** 	gen->shifted_polarity[0][1]=empty_general.shifted_polarity[0][0];
 2711              		.loc 1 848 2 is_stmt 1 view .LVU796
 2712              		.loc 1 848 29 is_stmt 0 view .LVU797
 2713 0062 C4F83431 		str	r3, [r4, #308]
 849:Core/Src/hall_detection.c **** 	gen->shifted_polarity[0][2]=empty_general.shifted_polarity[0][0];
 2714              		.loc 1 849 2 is_stmt 1 view .LVU798
 2715              		.loc 1 849 29 is_stmt 0 view .LVU799
 2716 0066 C4F83831 		str	r3, [r4, #312]
 850:Core/Src/hall_detection.c **** 
 851:Core/Src/hall_detection.c **** 	gen->shifted_polarity[1][0]=empty_general.shifted_polarity[0][0];
 2717              		.loc 1 851 2 is_stmt 1 view .LVU800
 2718              		.loc 1 851 29 is_stmt 0 view .LVU801
 2719 006a C4F83C31 		str	r3, [r4, #316]
 852:Core/Src/hall_detection.c **** 	gen->shifted_polarity[1][1]=empty_general.shifted_polarity[0][0];
 2720              		.loc 1 852 2 is_stmt 1 view .LVU802
 2721              		.loc 1 852 29 is_stmt 0 view .LVU803
 2722 006e C4F84031 		str	r3, [r4, #320]
 853:Core/Src/hall_detection.c **** 	gen->shifted_polarity[1][2]=empty_general.shifted_polarity[0][0];
ARM GAS  /tmp/ccJ2dceG.s 			page 71


 2723              		.loc 1 853 2 is_stmt 1 view .LVU804
 2724              		.loc 1 853 29 is_stmt 0 view .LVU805
 2725 0072 C4F84431 		str	r3, [r4, #324]
 854:Core/Src/hall_detection.c **** 
 855:Core/Src/hall_detection.c **** 	gen->shifted_polarity[2][0]=empty_general.shifted_polarity[0][0];
 2726              		.loc 1 855 2 is_stmt 1 view .LVU806
 2727              		.loc 1 855 29 is_stmt 0 view .LVU807
 2728 0076 C4F84831 		str	r3, [r4, #328]
 856:Core/Src/hall_detection.c **** 	gen->shifted_polarity[2][1]=empty_general.shifted_polarity[0][0];
 2729              		.loc 1 856 2 is_stmt 1 view .LVU808
 2730              		.loc 1 856 29 is_stmt 0 view .LVU809
 2731 007a C4F84C31 		str	r3, [r4, #332]
 857:Core/Src/hall_detection.c **** 	gen->shifted_polarity[2][2]=empty_general.shifted_polarity[0][0];
 2732              		.loc 1 857 2 is_stmt 1 view .LVU810
 2733              		.loc 1 857 29 is_stmt 0 view .LVU811
 2734 007e C4F85031 		str	r3, [r4, #336]
 858:Core/Src/hall_detection.c **** }
 2735              		.loc 1 858 1 view .LVU812
 2736 0082 70BC     		pop	{r4, r5, r6}
 2737              	.LCFI32:
 2738              		.cfi_restore 6
 2739              		.cfi_restore 5
 2740              		.cfi_restore 4
 2741              		.cfi_def_cfa_offset 0
 2742              	.LVL177:
 2743              		.loc 1 858 1 view .LVU813
 2744 0084 7047     		bx	lr
 2745              	.L184:
 2746 0086 00BF     		.align	2
 2747              	.L183:
 2748 0088 00000000 		.word	.LANCHOR2
 2749              		.cfi_endproc
 2750              	.LFE256:
 2752              		.section	.text.wait_for_the_current_stationary,"ax",%progbits
 2753              		.align	1
 2754              		.global	wait_for_the_current_stationary
 2755              		.syntax unified
 2756              		.thumb
 2757              		.thumb_func
 2758              		.fpu fpv4-sp-d16
 2760              	wait_for_the_current_stationary:
 2761              	.LVL178:
 2762              	.LFB238:
 228:Core/Src/hall_detection.c **** 	//timeout or currentisstationary
 2763              		.loc 1 228 4 is_stmt 1 view -0
 2764              		.cfi_startproc
 2765              		@ args = 12, pretend = 0, frame = 0
 2766              		@ frame_needed = 0, uses_anonymous_args = 0
 228:Core/Src/hall_detection.c **** 	//timeout or currentisstationary
 2767              		.loc 1 228 4 is_stmt 0 view .LVU815
 2768 0000 30B5     		push	{r4, r5, lr}
 2769              	.LCFI33:
 2770              		.cfi_def_cfa_offset 12
 2771              		.cfi_offset 4, -12
 2772              		.cfi_offset 5, -8
 2773              		.cfi_offset 14, -4
 2774 0002 83B0     		sub	sp, sp, #12
ARM GAS  /tmp/ccJ2dceG.s 			page 72


 2775              	.LCFI34:
 2776              		.cfi_def_cfa_offset 24
 2777 0004 0546     		mov	r5, r0
 2778 0006 0C46     		mov	r4, r1
 2779 0008 1146     		mov	r1, r2
 2780              	.LVL179:
 228:Core/Src/hall_detection.c **** 	//timeout or currentisstationary
 2781              		.loc 1 228 4 view .LVU816
 2782 000a 1A46     		mov	r2, r3
 2783              	.LVL180:
 230:Core/Src/hall_detection.c **** 	//timeout
 2784              		.loc 1 230 2 is_stmt 1 view .LVU817
 2785 000c 089B     		ldr	r3, [sp, #32]
 2786              	.LVL181:
 230:Core/Src/hall_detection.c **** 	//timeout
 2787              		.loc 1 230 2 is_stmt 0 view .LVU818
 2788 000e 0193     		str	r3, [sp, #4]
 2789 0010 079B     		ldr	r3, [sp, #28]
 2790 0012 0093     		str	r3, [sp]
 2791 0014 069B     		ldr	r3, [sp, #24]
 2792 0016 2046     		mov	r0, r4
 2793              	.LVL182:
 230:Core/Src/hall_detection.c **** 	//timeout
 2794              		.loc 1 230 2 view .LVU819
 2795 0018 FFF7FEFF 		bl	fill_buffers
 2796              	.LVL183:
 232:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 2797              		.loc 1 232 2 is_stmt 1 view .LVU820
 232:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 2798              		.loc 1 232 11 is_stmt 0 view .LVU821
 2799 001c 174B     		ldr	r3, .L193
 2800 001e 1B68     		ldr	r3, [r3]
 232:Core/Src/hall_detection.c **** 		*state=detection_ERROR_OR_TIMEOUT;
 2801              		.loc 1 232 4 view .LVU822
 2802 0020 174A     		ldr	r2, .L193+4
 2803 0022 9342     		cmp	r3, r2
 2804 0024 06D8     		bhi	.L190
 238:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,WAITING_STATIONARY_MAXZEROCROSSINGS)==YES){
 2805              		.loc 1 238 2 is_stmt 1 view .LVU823
 238:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,WAITING_STATIONARY_MAXZEROCROSSINGS)==YES){
 2806              		.loc 1 238 18 is_stmt 0 view .LVU824
 2807 0026 174A     		ldr	r2, .L193+8
 2808 0028 1268     		ldr	r2, [r2]
 238:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,WAITING_STATIONARY_MAXZEROCROSSINGS)==YES){
 2809              		.loc 1 238 42 view .LVU825
 2810 002a 0232     		adds	r2, r2, #2
 238:Core/Src/hall_detection.c **** 		if(detect_N_zerocrossings(gen,WAITING_STATIONARY_MAXZEROCROSSINGS)==YES){
 2811              		.loc 1 238 4 view .LVU826
 2812 002c 9342     		cmp	r3, r2
 2813 002e 04D8     		bhi	.L191
 2814              	.L185:
 252:Core/Src/hall_detection.c **** 
 2815              		.loc 1 252 1 view .LVU827
 2816 0030 03B0     		add	sp, sp, #12
 2817              	.LCFI35:
 2818              		.cfi_remember_state
 2819              		.cfi_def_cfa_offset 12
ARM GAS  /tmp/ccJ2dceG.s 			page 73


 2820              		@ sp needed
 2821 0032 30BD     		pop	{r4, r5, pc}
 2822              	.LVL184:
 2823              	.L190:
 2824              	.LCFI36:
 2825              		.cfi_restore_state
 233:Core/Src/hall_detection.c **** 		return;
 2826              		.loc 1 233 3 is_stmt 1 view .LVU828
 233:Core/Src/hall_detection.c **** 		return;
 2827              		.loc 1 233 9 is_stmt 0 view .LVU829
 2828 0034 0723     		movs	r3, #7
 2829 0036 2B70     		strb	r3, [r5]
 234:Core/Src/hall_detection.c **** 	}
 2830              		.loc 1 234 3 is_stmt 1 view .LVU830
 2831 0038 FAE7     		b	.L185
 2832              	.L191:
 239:Core/Src/hall_detection.c **** 			if(are_all_periods_stable(gen,WAITING_STATIONARY_MAXZEROCROSSINGS)==YES){
 2833              		.loc 1 239 3 view .LVU831
 239:Core/Src/hall_detection.c **** 			if(are_all_periods_stable(gen,WAITING_STATIONARY_MAXZEROCROSSINGS)==YES){
 2834              		.loc 1 239 6 is_stmt 0 view .LVU832
 2835 003a 0621     		movs	r1, #6
 2836 003c 2046     		mov	r0, r4
 2837 003e FFF7FEFF 		bl	detect_N_zerocrossings
 2838              	.LVL185:
 239:Core/Src/hall_detection.c **** 			if(are_all_periods_stable(gen,WAITING_STATIONARY_MAXZEROCROSSINGS)==YES){
 2839              		.loc 1 239 5 view .LVU833
 2840 0042 0128     		cmp	r0, #1
 2841 0044 F4D1     		bne	.L185
 240:Core/Src/hall_detection.c **** 				resetVariables_adquisition(gen);
 2842              		.loc 1 240 4 is_stmt 1 view .LVU834
 240:Core/Src/hall_detection.c **** 				resetVariables_adquisition(gen);
 2843              		.loc 1 240 7 is_stmt 0 view .LVU835
 2844 0046 0621     		movs	r1, #6
 2845 0048 2046     		mov	r0, r4
 2846 004a FFF7FEFF 		bl	are_all_periods_stable
 2847              	.LVL186:
 240:Core/Src/hall_detection.c **** 				resetVariables_adquisition(gen);
 2848              		.loc 1 240 6 view .LVU836
 2849 004e 0128     		cmp	r0, #1
 2850 0050 07D0     		beq	.L192
 247:Core/Src/hall_detection.c **** 				general.start_adquisition_ticks=ticks;
 2851              		.loc 1 247 5 is_stmt 1 view .LVU837
 2852 0052 2046     		mov	r0, r4
 2853 0054 FFF7FEFF 		bl	resetVariables_adquisition
 2854              	.LVL187:
 248:Core/Src/hall_detection.c **** 			}
 2855              		.loc 1 248 5 view .LVU838
 248:Core/Src/hall_detection.c **** 			}
 2856              		.loc 1 248 36 is_stmt 0 view .LVU839
 2857 0058 084B     		ldr	r3, .L193
 2858 005a 1A68     		ldr	r2, [r3]
 2859 005c 094B     		ldr	r3, .L193+8
 2860 005e 1A60     		str	r2, [r3]
 2861 0060 E6E7     		b	.L185
 2862              	.L192:
 241:Core/Src/hall_detection.c **** 				resetVariables_results(gen);
 2863              		.loc 1 241 5 is_stmt 1 view .LVU840
ARM GAS  /tmp/ccJ2dceG.s 			page 74


 2864 0062 2046     		mov	r0, r4
 2865 0064 FFF7FEFF 		bl	resetVariables_adquisition
 2866              	.LVL188:
 242:Core/Src/hall_detection.c **** 				general.start_adquisition_ticks=ticks;
 2867              		.loc 1 242 5 view .LVU841
 2868 0068 2046     		mov	r0, r4
 2869 006a FFF7FEFF 		bl	resetVariables_results
 2870              	.LVL189:
 243:Core/Src/hall_detection.c **** 				*state=detection_ADQUISITION;
 2871              		.loc 1 243 5 view .LVU842
 243:Core/Src/hall_detection.c **** 				*state=detection_ADQUISITION;
 2872              		.loc 1 243 36 is_stmt 0 view .LVU843
 2873 006e 034B     		ldr	r3, .L193
 2874 0070 1A68     		ldr	r2, [r3]
 2875 0072 044B     		ldr	r3, .L193+8
 2876 0074 1A60     		str	r2, [r3]
 244:Core/Src/hall_detection.c **** 				return;
 2877              		.loc 1 244 5 is_stmt 1 view .LVU844
 244:Core/Src/hall_detection.c **** 				return;
 2878              		.loc 1 244 11 is_stmt 0 view .LVU845
 2879 0076 0323     		movs	r3, #3
 2880 0078 2B70     		strb	r3, [r5]
 245:Core/Src/hall_detection.c **** 			}else{
 2881              		.loc 1 245 5 is_stmt 1 view .LVU846
 2882 007a D9E7     		b	.L185
 2883              	.L194:
 2884              		.align	2
 2885              	.L193:
 2886 007c 00000000 		.word	ticks
 2887 0080 38900D00 		.word	888888
 2888 0084 00000000 		.word	.LANCHOR1
 2889              		.cfi_endproc
 2890              	.LFE238:
 2892              		.section	.text.error_handler,"ax",%progbits
 2893              		.align	1
 2894              		.global	error_handler
 2895              		.syntax unified
 2896              		.thumb
 2897              		.thumb_func
 2898              		.fpu fpv4-sp-d16
 2900              	error_handler:
 2901              	.LFB257:
 859:Core/Src/hall_detection.c **** 
 860:Core/Src/hall_detection.c **** /**
 861:Core/Src/hall_detection.c **** * \brief for now just sends "error" via uart but it should do much more in the future
 862:Core/Src/hall_detection.c **** */
 863:Core/Src/hall_detection.c **** void error_handler(){
 2902              		.loc 1 863 21 view -0
 2903              		.cfi_startproc
 2904              		@ args = 0, pretend = 0, frame = 8
 2905              		@ frame_needed = 0, uses_anonymous_args = 0
 2906 0000 00B5     		push	{lr}
 2907              	.LCFI37:
 2908              		.cfi_def_cfa_offset 4
 2909              		.cfi_offset 14, -4
 2910 0002 83B0     		sub	sp, sp, #12
 2911              	.LCFI38:
ARM GAS  /tmp/ccJ2dceG.s 			page 75


 2912              		.cfi_def_cfa_offset 16
 864:Core/Src/hall_detection.c **** const uint8_t error_message[]="error";
 2913              		.loc 1 864 1 view .LVU848
 2914              		.loc 1 864 15 is_stmt 0 view .LVU849
 2915 0004 074B     		ldr	r3, .L197
 2916 0006 93E80300 		ldm	r3, {r0, r1}
 2917 000a 0090     		str	r0, [sp]
 2918 000c ADF80410 		strh	r1, [sp, #4]	@ movhi
 865:Core/Src/hall_detection.c **** #ifdef TESTuart
 866:Core/Src/hall_detection.c **** 	HAL_UART_Transmit(&huart2, (const uint8_t *)&error_message, sizeof(error_message),100);
 2919              		.loc 1 866 2 is_stmt 1 view .LVU850
 2920 0010 6423     		movs	r3, #100
 2921 0012 0622     		movs	r2, #6
 2922 0014 6946     		mov	r1, sp
 2923 0016 0448     		ldr	r0, .L197+4
 2924 0018 FFF7FEFF 		bl	HAL_UART_Transmit
 2925              	.LVL190:
 867:Core/Src/hall_detection.c **** #endif
 868:Core/Src/hall_detection.c **** }
 2926              		.loc 1 868 1 is_stmt 0 view .LVU851
 2927 001c 03B0     		add	sp, sp, #12
 2928              	.LCFI39:
 2929              		.cfi_def_cfa_offset 4
 2930              		@ sp needed
 2931 001e 5DF804FB 		ldr	pc, [sp], #4
 2932              	.L198:
 2933 0022 00BF     		.align	2
 2934              	.L197:
 2935 0024 00000000 		.word	.LC1
 2936 0028 00000000 		.word	huart2
 2937              		.cfi_endproc
 2938              	.LFE257:
 2940              		.section	.text.Hall_Identification_Test_measurement,"ax",%progbits
 2941              		.align	1
 2942              		.global	Hall_Identification_Test_measurement
 2943              		.syntax unified
 2944              		.thumb
 2945              		.thumb_func
 2946              		.fpu fpv4-sp-d16
 2948              	Hall_Identification_Test_measurement:
 2949              	.LVL191:
 2950              	.LFB237:
 175:Core/Src/hall_detection.c **** 	switch (detection_state) {
 2951              		.loc 1 175 4 is_stmt 1 view -0
 2952              		.cfi_startproc
 2953              		@ args = 4, pretend = 0, frame = 0
 2954              		@ frame_needed = 0, uses_anonymous_args = 0
 175:Core/Src/hall_detection.c **** 	switch (detection_state) {
 2955              		.loc 1 175 4 is_stmt 0 view .LVU853
 2956 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 2957              	.LCFI40:
 2958              		.cfi_def_cfa_offset 20
 2959              		.cfi_offset 4, -20
 2960              		.cfi_offset 5, -16
 2961              		.cfi_offset 6, -12
 2962              		.cfi_offset 7, -8
 2963              		.cfi_offset 14, -4
ARM GAS  /tmp/ccJ2dceG.s 			page 76


 2964 0002 85B0     		sub	sp, sp, #20
 2965              	.LCFI41:
 2966              		.cfi_def_cfa_offset 40
 2967 0004 0446     		mov	r4, r0
 2968 0006 0D46     		mov	r5, r1
 2969 0008 1646     		mov	r6, r2
 176:Core/Src/hall_detection.c **** 		case detection_ENABLED:
 2970              		.loc 1 176 2 is_stmt 1 view .LVU854
 2971 000a 2E4A     		ldr	r2, .L210
 2972              	.LVL192:
 176:Core/Src/hall_detection.c **** 		case detection_ENABLED:
 2973              		.loc 1 176 2 is_stmt 0 view .LVU855
 2974 000c 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
 2975 000e 013A     		subs	r2, r2, #1
 2976 0010 062A     		cmp	r2, #6
 2977 0012 0ED8     		bhi	.L199
 2978 0014 DFE802F0 		tbb	[pc, r2]
 2979              	.LVL193:
 2980              	.L202:
 2981 0018 04       		.byte	(.L208-.L202)/2
 2982 0019 0F       		.byte	(.L207-.L202)/2
 2983 001a 1E       		.byte	(.L206-.L202)/2
 2984 001b 2D       		.byte	(.L205-.L202)/2
 2985 001c 36       		.byte	(.L204-.L202)/2
 2986 001d 3F       		.byte	(.L203-.L202)/2
 2987 001e 4F       		.byte	(.L201-.L202)/2
 2988 001f 00       		.p2align 1
 2989              	.L208:
 178:Core/Src/hall_detection.c **** 			resetVariables_adquisition(&general);
 2990              		.loc 1 178 4 is_stmt 1 view .LVU856
 178:Core/Src/hall_detection.c **** 			resetVariables_adquisition(&general);
 2991              		.loc 1 178 9 is_stmt 0 view .LVU857
 2992 0020 294B     		ldr	r3, .L210+4
 2993              	.LVL194:
 178:Core/Src/hall_detection.c **** 			resetVariables_adquisition(&general);
 2994              		.loc 1 178 9 view .LVU858
 2995 0022 0022     		movs	r2, #0
 2996 0024 1A60     		str	r2, [r3]
 179:Core/Src/hall_detection.c **** 			detection_state=detection_WAIT_CURRENT_STATIONARY;
 2997              		.loc 1 179 4 is_stmt 1 view .LVU859
 2998 0026 2948     		ldr	r0, .L210+8
 2999              	.LVL195:
 179:Core/Src/hall_detection.c **** 			detection_state=detection_WAIT_CURRENT_STATIONARY;
 3000              		.loc 1 179 4 is_stmt 0 view .LVU860
 3001 0028 FFF7FEFF 		bl	resetVariables_adquisition
 3002              	.LVL196:
 180:Core/Src/hall_detection.c **** 			break;
 3003              		.loc 1 180 4 is_stmt 1 view .LVU861
 180:Core/Src/hall_detection.c **** 			break;
 3004              		.loc 1 180 19 is_stmt 0 view .LVU862
 3005 002c 254B     		ldr	r3, .L210
 3006 002e 0222     		movs	r2, #2
 3007 0030 1A70     		strb	r2, [r3]
 181:Core/Src/hall_detection.c **** 		case detection_WAIT_CURRENT_STATIONARY:
 3008              		.loc 1 181 4 is_stmt 1 view .LVU863
 3009              	.L199:
 210:Core/Src/hall_detection.c **** 
ARM GAS  /tmp/ccJ2dceG.s 			page 77


 3010              		.loc 1 210 1 is_stmt 0 view .LVU864
 3011 0032 05B0     		add	sp, sp, #20
 3012              	.LCFI42:
 3013              		.cfi_remember_state
 3014              		.cfi_def_cfa_offset 20
 3015              		@ sp needed
 3016 0034 F0BD     		pop	{r4, r5, r6, r7, pc}
 3017              	.LVL197:
 3018              	.L207:
 3019              	.LCFI43:
 3020              		.cfi_restore_state
 183:Core/Src/hall_detection.c **** 			ticks++;
 3021              		.loc 1 183 4 is_stmt 1 view .LVU865
 3022 0036 0A9A     		ldr	r2, [sp, #40]
 3023 0038 0292     		str	r2, [sp, #8]
 3024 003a 0193     		str	r3, [sp, #4]
 3025 003c 0096     		str	r6, [sp]
 3026 003e 2B46     		mov	r3, r5
 3027              	.LVL198:
 183:Core/Src/hall_detection.c **** 			ticks++;
 3028              		.loc 1 183 4 is_stmt 0 view .LVU866
 3029 0040 0246     		mov	r2, r0
 3030 0042 2249     		ldr	r1, .L210+8
 3031 0044 1F48     		ldr	r0, .L210
 3032              	.LVL199:
 183:Core/Src/hall_detection.c **** 			ticks++;
 3033              		.loc 1 183 4 view .LVU867
 3034 0046 FFF7FEFF 		bl	wait_for_the_current_stationary
 3035              	.LVL200:
 184:Core/Src/hall_detection.c **** 			break;
 3036              		.loc 1 184 4 is_stmt 1 view .LVU868
 184:Core/Src/hall_detection.c **** 			break;
 3037              		.loc 1 184 9 is_stmt 0 view .LVU869
 3038 004a 1F4A     		ldr	r2, .L210+4
 3039 004c 1368     		ldr	r3, [r2]
 3040 004e 0133     		adds	r3, r3, #1
 3041 0050 1360     		str	r3, [r2]
 185:Core/Src/hall_detection.c **** 		case detection_ADQUISITION:
 3042              		.loc 1 185 4 is_stmt 1 view .LVU870
 3043 0052 EEE7     		b	.L199
 3044              	.LVL201:
 3045              	.L206:
 187:Core/Src/hall_detection.c **** 			ticks++;
 3046              		.loc 1 187 4 view .LVU871
 3047 0054 0A9A     		ldr	r2, [sp, #40]
 3048 0056 0292     		str	r2, [sp, #8]
 3049 0058 0193     		str	r3, [sp, #4]
 3050 005a 0096     		str	r6, [sp]
 3051 005c 2B46     		mov	r3, r5
 3052              	.LVL202:
 187:Core/Src/hall_detection.c **** 			ticks++;
 3053              		.loc 1 187 4 is_stmt 0 view .LVU872
 3054 005e 0246     		mov	r2, r0
 3055 0060 1A49     		ldr	r1, .L210+8
 3056 0062 1848     		ldr	r0, .L210
 3057              	.LVL203:
 187:Core/Src/hall_detection.c **** 			ticks++;
ARM GAS  /tmp/ccJ2dceG.s 			page 78


 3058              		.loc 1 187 4 view .LVU873
 3059 0064 FFF7FEFF 		bl	adquisition
 3060              	.LVL204:
 188:Core/Src/hall_detection.c **** 			break;
 3061              		.loc 1 188 4 is_stmt 1 view .LVU874
 188:Core/Src/hall_detection.c **** 			break;
 3062              		.loc 1 188 9 is_stmt 0 view .LVU875
 3063 0068 174A     		ldr	r2, .L210+4
 3064 006a 1368     		ldr	r3, [r2]
 3065 006c 0133     		adds	r3, r3, #1
 3066 006e 1360     		str	r3, [r2]
 189:Core/Src/hall_detection.c **** 		case detection_INTERPRETATION:
 3067              		.loc 1 189 4 is_stmt 1 view .LVU876
 3068 0070 DFE7     		b	.L199
 3069              	.LVL205:
 3070              	.L205:
 191:Core/Src/hall_detection.c **** 			ticks++;
 3071              		.loc 1 191 4 view .LVU877
 3072 0072 1649     		ldr	r1, .L210+8
 3073 0074 1348     		ldr	r0, .L210
 3074              	.LVL206:
 191:Core/Src/hall_detection.c **** 			ticks++;
 3075              		.loc 1 191 4 is_stmt 0 view .LVU878
 3076 0076 FFF7FEFF 		bl	interpretation
 3077              	.LVL207:
 192:Core/Src/hall_detection.c **** 			break;
 3078              		.loc 1 192 4 is_stmt 1 view .LVU879
 192:Core/Src/hall_detection.c **** 			break;
 3079              		.loc 1 192 9 is_stmt 0 view .LVU880
 3080 007a 134A     		ldr	r2, .L210+4
 3081 007c 1368     		ldr	r3, [r2]
 3082 007e 0133     		adds	r3, r3, #1
 3083 0080 1360     		str	r3, [r2]
 193:Core/Src/hall_detection.c **** 		case detection_VALIDATION:
 3084              		.loc 1 193 4 is_stmt 1 view .LVU881
 3085 0082 D6E7     		b	.L199
 3086              	.LVL208:
 3087              	.L204:
 195:Core/Src/hall_detection.c **** 			ticks++;
 3088              		.loc 1 195 4 view .LVU882
 3089 0084 1149     		ldr	r1, .L210+8
 3090 0086 0F48     		ldr	r0, .L210
 3091              	.LVL209:
 195:Core/Src/hall_detection.c **** 			ticks++;
 3092              		.loc 1 195 4 is_stmt 0 view .LVU883
 3093 0088 FFF7FEFF 		bl	validation
 3094              	.LVL210:
 196:Core/Src/hall_detection.c **** 			break;
 3095              		.loc 1 196 4 is_stmt 1 view .LVU884
 196:Core/Src/hall_detection.c **** 			break;
 3096              		.loc 1 196 9 is_stmt 0 view .LVU885
 3097 008c 0E4A     		ldr	r2, .L210+4
 3098 008e 1368     		ldr	r3, [r2]
 3099 0090 0133     		adds	r3, r3, #1
 3100 0092 1360     		str	r3, [r2]
 197:Core/Src/hall_detection.c **** 		case detection_PRESENTATION_FINISH:
 3101              		.loc 1 197 4 is_stmt 1 view .LVU886
ARM GAS  /tmp/ccJ2dceG.s 			page 79


 3102 0094 CDE7     		b	.L199
 3103              	.LVL211:
 3104              	.L203:
 199:Core/Src/hall_detection.c **** 			swap_hall_gpios_with_detected_results(&general,H1_gpio, H2_gpio, H3_gpio);
 3105              		.loc 1 199 4 view .LVU887
 3106 0096 0D4F     		ldr	r7, .L210+8
 3107 0098 3946     		mov	r1, r7
 3108 009a 0A48     		ldr	r0, .L210
 3109              	.LVL212:
 199:Core/Src/hall_detection.c **** 			swap_hall_gpios_with_detected_results(&general,H1_gpio, H2_gpio, H3_gpio);
 3110              		.loc 1 199 4 is_stmt 0 view .LVU888
 3111 009c FFF7FEFF 		bl	present_and_finish
 3112              	.LVL213:
 200:Core/Src/hall_detection.c **** 			ticks++;
 3113              		.loc 1 200 4 is_stmt 1 view .LVU889
 3114 00a0 3346     		mov	r3, r6
 3115 00a2 2A46     		mov	r2, r5
 3116 00a4 2146     		mov	r1, r4
 3117 00a6 3846     		mov	r0, r7
 3118 00a8 FFF7FEFF 		bl	swap_hall_gpios_with_detected_results
 3119              	.LVL214:
 201:Core/Src/hall_detection.c **** 			break;
 3120              		.loc 1 201 4 view .LVU890
 201:Core/Src/hall_detection.c **** 			break;
 3121              		.loc 1 201 9 is_stmt 0 view .LVU891
 3122 00ac 064A     		ldr	r2, .L210+4
 3123 00ae 1368     		ldr	r3, [r2]
 3124 00b0 0133     		adds	r3, r3, #1
 3125 00b2 1360     		str	r3, [r2]
 202:Core/Src/hall_detection.c **** 		case detection_ERROR_OR_TIMEOUT:
 3126              		.loc 1 202 4 is_stmt 1 view .LVU892
 3127 00b4 BDE7     		b	.L199
 3128              	.LVL215:
 3129              	.L201:
 204:Core/Src/hall_detection.c **** 			detection_state=detection_DISABLED;
 3130              		.loc 1 204 4 view .LVU893
 3131 00b6 FFF7FEFF 		bl	error_handler
 3132              	.LVL216:
 205:Core/Src/hall_detection.c **** 		case detection_DISABLED://do nothing
 3133              		.loc 1 205 4 view .LVU894
 205:Core/Src/hall_detection.c **** 		case detection_DISABLED://do nothing
 3134              		.loc 1 205 19 is_stmt 0 view .LVU895
 3135 00ba 024B     		ldr	r3, .L210
 3136 00bc 0022     		movs	r2, #0
 3137 00be 1A70     		strb	r2, [r3]
 210:Core/Src/hall_detection.c **** 
 3138              		.loc 1 210 1 view .LVU896
 3139 00c0 B7E7     		b	.L199
 3140              	.L211:
 3141 00c2 00BF     		.align	2
 3142              	.L210:
 3143 00c4 00000000 		.word	.LANCHOR0
 3144 00c8 00000000 		.word	ticks
 3145 00cc 00000000 		.word	.LANCHOR1
 3146              		.cfi_endproc
 3147              	.LFE237:
 3149              		.global	empty_general
ARM GAS  /tmp/ccJ2dceG.s 			page 80


 3150              		.global	general
 3151              		.global	detection_state
 3152              		.comm	ticks,4,4
 3153              		.section	.rodata
 3154              		.align	2
 3155              		.set	.LANCHOR3,. + 0
 3156              	.LC0:
 3157 0000 FF000000 		.word	255
 3158 0004 FF000000 		.word	255
 3159 0008 FF000000 		.word	255
 3160              		.section	.bss.detection_state,"aw",%nobits
 3161              		.set	.LANCHOR0,. + 0
 3164              	detection_state:
 3165 0000 00       		.space	1
 3166              		.section	.bss.general,"aw",%nobits
 3167              		.align	2
 3168              		.set	.LANCHOR1,. + 0
 3171              	general:
 3172 0000 00000000 		.space	452
 3172      00000000 
 3172      00000000 
 3172      00000000 
 3172      00000000 
 3173              		.section	.rodata.empty_general,"a"
 3174              		.align	2
 3175              		.set	.LANCHOR2,. + 0
 3178              	empty_general:
 3179 0000 00000000 		.space	452
 3179      00000000 
 3179      00000000 
 3179      00000000 
 3179      00000000 
 3180              		.section	.rodata.error_handler.str1.4,"aMS",%progbits,1
 3181              		.align	2
 3182              	.LC1:
 3183 0000 6572726F 		.ascii	"error\000"
 3183      7200
 3184              		.text
 3185              	.Letext0:
 3186              		.file 2 "/usr/lib/gcc/arm-none-eabi/8.3.1/include/stdint.h"
 3187              		.file 3 "Drivers/CMSIS/Include/core_cm4.h"
 3188              		.file 4 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/system_stm32f4xx.h"
 3189              		.file 5 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f446xx.h"
 3190              		.file 6 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_def.h"
 3191              		.file 7 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_gpio.h"
 3192              		.file 8 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_dma.h"
 3193              		.file 9 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_uart.h"
 3194              		.file 10 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal.h"
 3195              		.file 11 "Core/Inc/main.h"
 3196              		.file 12 "Core/Inc/hall_detection.h"
 3197              		.file 13 "Core/Inc/usart.h"
ARM GAS  /tmp/ccJ2dceG.s 			page 81


DEFINED SYMBOLS
                            *ABS*:0000000000000000 hall_detection.c
     /tmp/ccJ2dceG.s:18     .text.Hall_start_detection:0000000000000000 $t
     /tmp/ccJ2dceG.s:26     .text.Hall_start_detection:0000000000000000 Hall_start_detection
     /tmp/ccJ2dceG.s:44     .text.Hall_start_detection:0000000000000008 $d
     /tmp/ccJ2dceG.s:49     .text.Hall_is_detection_finished:0000000000000000 $t
     /tmp/ccJ2dceG.s:56     .text.Hall_is_detection_finished:0000000000000000 Hall_is_detection_finished
     /tmp/ccJ2dceG.s:80     .text.Hall_is_detection_finished:0000000000000010 $d
     /tmp/ccJ2dceG.s:85     .text.present_and_finish:0000000000000000 $t
     /tmp/ccJ2dceG.s:92     .text.present_and_finish:0000000000000000 present_and_finish
     /tmp/ccJ2dceG.s:259    .text.present_and_finish:00000000000000b4 $d
     /tmp/ccJ2dceG.s:265    .text.fill_buffers:0000000000000000 $t
     /tmp/ccJ2dceG.s:272    .text.fill_buffers:0000000000000000 fill_buffers
     /tmp/ccJ2dceG.s:384    .text.detect_N_current_zerocrossings:0000000000000000 $t
     /tmp/ccJ2dceG.s:391    .text.detect_N_current_zerocrossings:0000000000000000 detect_N_current_zerocrossings
     /tmp/ccJ2dceG.s:522    .text.detect_N_hall_zerocrossings:0000000000000000 $t
     /tmp/ccJ2dceG.s:529    .text.detect_N_hall_zerocrossings:0000000000000000 detect_N_hall_zerocrossings
     /tmp/ccJ2dceG.s:596    .text.detect_N_zerocrossings:0000000000000000 $t
     /tmp/ccJ2dceG.s:603    .text.detect_N_zerocrossings:0000000000000000 detect_N_zerocrossings
     /tmp/ccJ2dceG.s:760    .text.detect_N_zerocrossings:00000000000000bc $d
                            *COM*:0000000000000004 ticks
     /tmp/ccJ2dceG.s:766    .text.calculateElectricPeriod_inTicks:0000000000000000 $t
     /tmp/ccJ2dceG.s:773    .text.calculateElectricPeriod_inTicks:0000000000000000 calculateElectricPeriod_inTicks
     /tmp/ccJ2dceG.s:910    .text.calculateElectricPeriod_inTicks:0000000000000098 $d
     /tmp/ccJ2dceG.s:915    .text.adquisition:0000000000000000 $t
     /tmp/ccJ2dceG.s:922    .text.adquisition:0000000000000000 adquisition
     /tmp/ccJ2dceG.s:1017   .text.adquisition:0000000000000054 $d
     /tmp/ccJ2dceG.s:1027   .text.is_deviation_from_period_acceptable:0000000000000000 $t
     /tmp/ccJ2dceG.s:1034   .text.is_deviation_from_period_acceptable:0000000000000000 is_deviation_from_period_acceptable
     /tmp/ccJ2dceG.s:1174   .text.is_deviation_from_period_acceptable:0000000000000080 $d
     /tmp/ccJ2dceG.s:1181   .text.are_all_periods_stable:0000000000000000 $t
     /tmp/ccJ2dceG.s:1188   .text.are_all_periods_stable:0000000000000000 are_all_periods_stable
     /tmp/ccJ2dceG.s:1222   .text.swap_hall_gpios_with_detected_results:0000000000000000 $t
     /tmp/ccJ2dceG.s:1229   .text.swap_hall_gpios_with_detected_results:0000000000000000 swap_hall_gpios_with_detected_results
     /tmp/ccJ2dceG.s:1416   .text.absolute:0000000000000000 $t
     /tmp/ccJ2dceG.s:1423   .text.absolute:0000000000000000 absolute
     /tmp/ccJ2dceG.s:1443   .text.assign_polarity:0000000000000000 $t
     /tmp/ccJ2dceG.s:1450   .text.assign_polarity:0000000000000000 assign_polarity
     /tmp/ccJ2dceG.s:1600   .text.resetVariables_adquisition:0000000000000000 $t
     /tmp/ccJ2dceG.s:1607   .text.resetVariables_adquisition:0000000000000000 resetVariables_adquisition
     /tmp/ccJ2dceG.s:1729   .text.resetVariables_adquisition:00000000000000bc $d
     /tmp/ccJ2dceG.s:1734   .text.resetVariables_diferences:0000000000000000 $t
     /tmp/ccJ2dceG.s:1741   .text.resetVariables_diferences:0000000000000000 resetVariables_diferences
     /tmp/ccJ2dceG.s:1783   .text.validation:0000000000000000 $t
     /tmp/ccJ2dceG.s:1790   .text.validation:0000000000000000 validation
     /tmp/ccJ2dceG.s:2114   .text.validation:000000000000015c $d
     /tmp/ccJ2dceG.s:2121   .text.assign_closest_phase_to_hall:0000000000000000 $t
     /tmp/ccJ2dceG.s:2128   .text.assign_closest_phase_to_hall:0000000000000000 assign_closest_phase_to_hall
     /tmp/ccJ2dceG.s:2558   .text.assign_closest_phase_to_hall:00000000000002a0 $d
     /tmp/ccJ2dceG.s:2566   .text.interpretation:0000000000000000 $t
     /tmp/ccJ2dceG.s:2573   .text.interpretation:0000000000000000 interpretation
     /tmp/ccJ2dceG.s:2639   .text.interpretation:0000000000000038 $d
     /tmp/ccJ2dceG.s:2645   .text.resetVariables_results:0000000000000000 $t
     /tmp/ccJ2dceG.s:2652   .text.resetVariables_results:0000000000000000 resetVariables_results
     /tmp/ccJ2dceG.s:2748   .text.resetVariables_results:0000000000000088 $d
     /tmp/ccJ2dceG.s:2753   .text.wait_for_the_current_stationary:0000000000000000 $t
     /tmp/ccJ2dceG.s:2760   .text.wait_for_the_current_stationary:0000000000000000 wait_for_the_current_stationary
ARM GAS  /tmp/ccJ2dceG.s 			page 82


     /tmp/ccJ2dceG.s:2886   .text.wait_for_the_current_stationary:000000000000007c $d
     /tmp/ccJ2dceG.s:2893   .text.error_handler:0000000000000000 $t
     /tmp/ccJ2dceG.s:2900   .text.error_handler:0000000000000000 error_handler
     /tmp/ccJ2dceG.s:2935   .text.error_handler:0000000000000024 $d
     /tmp/ccJ2dceG.s:2941   .text.Hall_Identification_Test_measurement:0000000000000000 $t
     /tmp/ccJ2dceG.s:2948   .text.Hall_Identification_Test_measurement:0000000000000000 Hall_Identification_Test_measurement
     /tmp/ccJ2dceG.s:2981   .text.Hall_Identification_Test_measurement:0000000000000018 $d
     /tmp/ccJ2dceG.s:3143   .text.Hall_Identification_Test_measurement:00000000000000c4 $d
     /tmp/ccJ2dceG.s:3178   .rodata.empty_general:0000000000000000 empty_general
     /tmp/ccJ2dceG.s:3171   .bss.general:0000000000000000 general
     /tmp/ccJ2dceG.s:3164   .bss.detection_state:0000000000000000 detection_state
     /tmp/ccJ2dceG.s:3154   .rodata:0000000000000000 $d
     /tmp/ccJ2dceG.s:3165   .bss.detection_state:0000000000000000 $d
     /tmp/ccJ2dceG.s:3167   .bss.general:0000000000000000 $d
     /tmp/ccJ2dceG.s:3174   .rodata.empty_general:0000000000000000 $d
     /tmp/ccJ2dceG.s:3181   .rodata.error_handler.str1.4:0000000000000000 $d
     /tmp/ccJ2dceG.s:2988   .text.Hall_Identification_Test_measurement:000000000000001f $d
     /tmp/ccJ2dceG.s:2988   .text.Hall_Identification_Test_measurement:0000000000000020 $t

UNDEFINED SYMBOLS
HAL_UART_Transmit
huart2
__aeabi_ui2d
__aeabi_dmul
__aeabi_d2f
__aeabi_d2iz
